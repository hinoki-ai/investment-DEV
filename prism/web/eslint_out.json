[{"filePath":"/home/hinoki/HinokiDEV/Investments/prism/web/functions/api/[[path]].ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'params' is assigned a value but never used.","line":8,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":26}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Cloudflare Pages Function - API Routes\n\nexport interface Env {\n  // Environment variables if needed\n}\n\nexport const onRequest: PagesFunction<Env> = async (context) => {\n  const { request, params } = context;\n  const url = new URL(request.url);\n  const path = url.pathname;\n  const method = request.method;\n\n  // CORS headers\n  const corsHeaders = {\n    \"Access-Control-Allow-Origin\": \"*\",\n    \"Access-Control-Allow-Methods\": \"GET, POST, PUT, DELETE, OPTIONS\",\n    \"Access-Control-Allow-Headers\": \"Content-Type, Authorization\",\n    \"Content-Type\": \"application/json\"\n  };\n\n  if (method === \"OPTIONS\") {\n    return new Response(null, { headers: corsHeaders });\n  }\n\n  // Health check\n  if (path === \"/api/health\" || path === \"/api/\") {\n    return new Response(JSON.stringify({\n      status: \"healthy\",\n      service: \"investment-api\",\n      version: \"1.0.0\",\n      timestamp: new Date().toISOString()\n    }), { headers: corsHeaders });\n  }\n\n  // Dashboard stats\n  if (path === \"/api/v1/dashboard/stats\" && method === \"GET\") {\n    return new Response(JSON.stringify({\n      total_investments: 3,\n      total_value: 250000,\n      categories: [\"land\", \"stocks\", \"gold\"],\n      last_updated: new Date().toISOString()\n    }), { headers: corsHeaders });\n  }\n\n  // List investments\n  if (path === \"/api/v1/investments\" && method === \"GET\") {\n    return new Response(JSON.stringify({\n      items: [\n        { id: \"1\", name: \"Beach House\", category: \"real_estate\", value: 150000, status: \"active\" },\n        { id: \"2\", name: \"Apple Stock\", category: \"stocks\", value: 50000, status: \"active\" },\n        { id: \"3\", name: \"Gold Coins\", category: \"gold\", value: 50000, status: \"active\" }\n      ],\n      total: 3\n    }), { headers: corsHeaders });\n  }\n\n  // Create investment\n  if (path === \"/api/v1/investments\" && method === \"POST\") {\n    const body = await request.json().catch(() => ({}));\n    return new Response(JSON.stringify({\n      id: crypto.randomUUID(),\n      name: body.name || \"New Investment\",\n      category: body.category || \"other\",\n      value: body.initial_value || 0,\n      created_at: new Date().toISOString()\n    }), { headers: corsHeaders, status: 201 });\n  }\n\n  // Files list\n  if (path === \"/api/v1/files\" && method === \"GET\") {\n    return new Response(JSON.stringify({\n      files: [],\n      total: 0\n    }), { headers: corsHeaders });\n  }\n\n  // Analysis results\n  if (path === \"/api/v1/analysis/results\" && method === \"GET\") {\n    return new Response(JSON.stringify({\n      results: [],\n      total: 0\n    }), { headers: corsHeaders });\n  }\n\n  // 404 for unmatched routes\n  return new Response(JSON.stringify({\n    error: \"Not found\",\n    path: path,\n    method: method\n  }), { headers: corsHeaders, status: 404 });\n};\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/hinoki/HinokiDEV/Investments/prism/web/src/App.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/hinoki/HinokiDEV/Investments/prism/web/src/components/CreditAnalysis.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/hinoki/HinokiDEV/Investments/prism/web/src/components/HelpTooltip.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":246,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":246,"endColumn":33}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useRef, useEffect } from 'react'\nimport { HelpCircle, X } from 'lucide-react'\n\n// ============================================================================\n// BEGINNER-FRIENDLY TOOLTIP SYSTEM - ESPAÑOL\n// ============================================================================\n// Explicaciones en español para noobs, manteniendo terminología técnica en inglés\n\ninterface HelpTooltipProps {\n  /** El término técnico que se explica */\n  title?: string\n  /** La explicación útil en español */\n  content: string\n  /** Opcional: ejemplo adicional */\n  example?: string\n  /** Posición del bubble */\n  position?: 'top' | 'bottom' | 'left' | 'right'\n  /** Tamaño */\n  size?: 'sm' | 'md' | 'lg'\n  /** Opcional: mostrar label junto al icono */\n  showLabel?: string\n  /** Opcional: elemento trigger personalizado */\n  children?: React.ReactNode\n  /** Hover (default) o click */\n  trigger?: 'hover' | 'click'\n  /** Opcional: link para aprender más */\n  learnMoreUrl?: string\n}\n\nexport function HelpTooltip({\n  title,\n  content,\n  example,\n  position = 'top',\n  size = 'md',\n  showLabel,\n  children,\n  trigger = 'hover',\n  learnMoreUrl,\n}: HelpTooltipProps) {\n  const [isVisible, setIsVisible] = useState(false)\n  const [isPinned, setIsPinned] = useState(false)\n  const timeoutRef = useRef<ReturnType<typeof setTimeout> | null>(null)\n  const containerRef = useRef<HTMLDivElement>(null)\n\n  // Cerrar al hacer click fuera\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (containerRef.current && !containerRef.current.contains(event.target as Node)) {\n        setIsPinned(false)\n        setIsVisible(false)\n      }\n    }\n\n    if (isPinned) {\n      document.addEventListener('mousedown', handleClickOutside)\n    }\n\n    return () => {\n      document.removeEventListener('mousedown', handleClickOutside)\n    }\n  }, [isPinned])\n\n  const showTooltip = () => {\n    if (!isPinned) {\n      if (timeoutRef.current) clearTimeout(timeoutRef.current)\n      setIsVisible(true)\n    }\n  }\n\n  const hideTooltip = () => {\n    if (!isPinned) {\n      timeoutRef.current = setTimeout(() => setIsVisible(false), 150)\n    }\n  }\n\n  const handleClick = () => {\n    if (trigger === 'click') {\n      setIsPinned(!isPinned)\n      setIsVisible(!isPinned)\n    }\n  }\n\n  const sizeClasses = {\n    sm: 'w-56 text-xs',\n    md: 'w-80 text-sm',\n    lg: 'w-[28rem] text-sm',\n  }\n\n  const positionClasses = {\n    top: 'bottom-full left-1/2 -translate-x-1/2 mb-2',\n    bottom: 'top-full left-1/2 -translate-x-1/2 mt-2',\n    left: 'right-full top-1/2 -translate-y-1/2 mr-2',\n    right: 'left-full top-1/2 -translate-y-1/2 ml-2',\n  }\n\n  const arrowClasses = {\n    top: 'top-full left-1/2 -translate-x-1/2 border-l-transparent border-r-transparent border-b-transparent border-t-surface-elevated',\n    bottom: 'bottom-full left-1/2 -translate-x-1/2 border-l-transparent border-r-transparent border-t-transparent border-b-surface-elevated',\n    left: 'left-full top-1/2 -translate-y-1/2 border-t-transparent border-b-transparent border-r-transparent border-l-surface-elevated',\n    right: 'right-full top-1/2 -translate-y-1/2 border-t-transparent border-b-transparent border-l-transparent border-r-surface-elevated',\n  }\n\n  return (\n    <div\n      ref={containerRef}\n      className=\"relative inline-flex items-center\"\n      onMouseEnter={trigger === 'hover' ? showTooltip : undefined}\n      onMouseLeave={trigger === 'hover' ? hideTooltip : undefined}\n    >\n      {children ? (\n        <div onClick={handleClick} className=\"cursor-help\">\n          {children}\n        </div>\n      ) : (\n        <button\n          type=\"button\"\n          onClick={handleClick}\n          onMouseEnter={trigger === 'hover' ? showTooltip : undefined}\n          onMouseLeave={trigger === 'hover' ? hideTooltip : undefined}\n          className=\"inline-flex items-center gap-1 text-cream-muted hover:text-cream transition-colors focus:outline-none group\"\n        >\n          {showLabel && (\n            <span className=\"text-xs text-cream-muted group-hover:text-cream transition-colors\">\n              {showLabel}\n            </span>\n          )}\n          <HelpCircle \n            className={`${isPinned ? 'text-cream' : ''} transition-colors`}\n            style={{ width: showLabel ? '14px' : '16px', height: showLabel ? '14px' : '16px' }} \n          />\n        </button>\n      )}\n\n      {/* Tooltip Bubble */}\n      {(isVisible || isPinned) && (\n        <div\n          className={`\n            absolute z-50 ${positionClasses[position]} ${sizeClasses[size]}\n            animate-in fade-in zoom-in-95 duration-200\n          `}\n        >\n          <div className=\"relative\">\n            {/* Bubble Content */}\n            <div className=\"bg-surface-elevated border border-cream/20 rounded-xl shadow-2xl shadow-black/50 overflow-hidden\">\n              {/* Header con gradient */}\n              <div className=\"bg-gradient-to-r from-cream/10 to-transparent px-4 py-2.5 border-b border-cream/10 flex items-center justify-between\">\n                {title && (\n                  <span className=\"font-semibold text-cream text-sm\">{title}</span>\n                )}\n                {isPinned && (\n                  <button\n                    onClick={() => {\n                      setIsPinned(false)\n                      setIsVisible(false)\n                    }}\n                    className=\"text-text-muted hover:text-text-primary transition-colors p-0.5\"\n                  >\n                    <X className=\"h-3.5 w-3.5\" />\n                  </button>\n                )}\n              </div>\n\n              {/* Content */}\n              <div className=\"p-4\">\n                <p className=\"text-text-secondary leading-relaxed\">{content}</p>\n                \n                {example && (\n                  <div className=\"mt-3 p-3 bg-surface rounded-lg border border-border\">\n                    <p className=\"text-xs text-cream-muted uppercase tracking-wider mb-1\">Ejemplo</p>\n                    <p className=\"text-sm text-text-secondary italic\">{example}</p>\n                  </div>\n                )}\n\n                {learnMoreUrl && (\n                  <a\n                    href={learnMoreUrl}\n                    target=\"_blank\"\n                    rel=\"noopener noreferrer\"\n                    className=\"mt-3 inline-flex items-center gap-1 text-xs text-cream hover:text-cream-light transition-colors\"\n                  >\n                    Aprender más →\n                  </a>\n                )}\n\n                {/* Tip para interacción */}\n                {!isPinned && trigger === 'hover' && (\n                  <p className=\"mt-3 text-[10px] text-text-muted\">\n                    Click para mantener abierto\n                  </p>\n                )}\n              </div>\n            </div>\n\n            {/* Arrow */}\n            <div\n              className={`absolute w-0 h-0 border-8 ${arrowClasses[position]}`}\n            />\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n\n// ============================================================================\n// LABEL WITH TOOLTIP - Para form labels\n// ============================================================================\n\ninterface LabelWithTooltipProps {\n  label: string\n  tooltipTitle?: string\n  tooltipContent: string\n  tooltipExample?: string | undefined\n  icon?: React.ElementType\n  required?: boolean\n}\n\nexport function LabelWithTooltip({\n  label,\n  tooltipTitle,\n  tooltipContent,\n  tooltipExample,\n  icon: Icon,\n  required,\n}: LabelWithTooltipProps) {\n  return (\n    <label className=\"flex items-center gap-2 text-xs font-semibold tracking-widest text-cream-muted uppercase group\">\n      {Icon && <Icon className=\"h-3.5 w-3.5\" />}\n      <span className=\"group-hover:text-cream/80 transition-colors\">{label}</span>\n      {required && <span className=\"text-error\">*</span>}\n      <HelpTooltip\n        title={tooltipTitle || label}\n        content={tooltipContent}\n        example={tooltipExample}\n        size=\"md\"\n      />\n    </label>\n  )\n}\n\n// ============================================================================\n// BASE DE DATOS DE TOOLTIPS - Términos de Inversión para Noobs (Español)\n// ============================================================================\n\nexport const INVESTMENT_TOOLTIPS = {\n  // Categorías\n  category: {\n    title: 'Category (Categoría)',\n    content: 'El tipo de activo en el que inviertes. Cada categoría tiene diferentes niveles de riesgo, retornos y tratamiento fiscal.',\n    example: 'Land (tierra) suele apreciar lento pero seguro. Crypto es volátil pero puede tener altos retornos.',\n  },\n  \n  // Info básica\n  name: {\n    title: 'Investment Name',\n    content: 'Un nombre descriptivo para identificar esta inversión en tu portfolio. Que sea claro para que recuerdes qué es.',\n    example: '\"Departamento Playa Floripa\" o \"Apple Stock - Broker X\"',\n  },\n  \n  status: {\n    title: 'Status (Estado)',\n    content: 'El estado actual de esta inversión. Ayuda a trackear qué activos están generando dinero activamente vs. los que están en transición.',\n    example: 'Active = lo tienes ahora. Sold = lo vendiste. Pending = lo estás comprando. Under Contract = papeleo en progreso.',\n  },\n  \n  description: {\n    title: 'Description (Descripción)',\n    content: 'Notas sobre esta inversión. Escribe cualquier cosa que te ayude a recordar detalles después - por qué lo compraste, características especiales, preocupaciones, etc.',\n    example: 'Gran ubicación cerca de futura estación de metro. Vendedor motivado. Necesita renovación.',\n  },\n  \n  tags: {\n    title: 'Tags (Etiquetas)',\n    content: 'Palabras clave para organizar y filtrar tus inversiones. Agrega cualquier label que te ayude a categorizar.',\n    example: 'riesgoso, jubilación, ingreso-renta, fixer-upper, diversificar',\n  },\n  \n  // Financiero\n  purchasePrice: {\n    title: 'Purchase Price (Precio de Compra)',\n    content: 'Cuánto pagaste realmente para adquirir esta inversión. Incluye todos los costos upfront como fees, impuestos y renovaciones.',\n    example: 'Si compraste tierra por $100k y pagaste $5k en fees, ingresa $105,000.',\n  },\n  \n  currentValue: {\n    title: 'Current Value (Valor Actual)',\n    content: 'Cuánto vale esta inversión hoy. Actualiza periódicamente para trackear tus ganancias/pérdidas. Es tu mejor estimación basada en research de mercado.',\n    example: 'Revisa ventas similares, valores de tasación, o precios de mercado para stocks/crypto.',\n  },\n  \n  purchaseDate: {\n    title: 'Purchase Date (Fecha de Compra)',\n    content: 'Cuándo adquiriste esta inversión. Ayuda a calcular cuánto tiempo la has tenido y los retornos anuales.',\n    example: 'Se usa para calcular: \"Compré esto hace 2 años y subió 20%\" = 10% por año.',\n  },\n  \n  ownershipPercentage: {\n    title: 'Ownership % (Porcentaje de Propiedad)',\n    content: 'Qué porcentaje de este activo posees realmente. Menos de 100% significa que eres co-dueño con alguien más.',\n    example: 'Si tú y tu cónyuge pusieron la mitad del dinero cada uno, cada uno posee 50%.',\n  },\n  \n  // Land específico\n  landArea: {\n    title: 'Land Area (Superficie en hectáreas)',\n    content: 'El tamaño del terreno en hectáreas. 1 hectárea = 10,000 metros cuadrados = aproximadamente 2.5 acres. Esto afecta el cálculo de precio por metro cuadrado.',\n    example: 'Una cancha de fútbol es aproximadamente 0.7 hectáreas.',\n  },\n  \n  zoningType: {\n    title: 'Zoning Type (Zonificación)',\n    content: 'Para qué está legalmente permitido usar el terreno. Lo establece la municipalidad/gobierno y afecta el valor y opciones de desarrollo.',\n    example: 'Residential = solo casas. Commercial = tiendas/negocios. Mixed = ambos.',\n  },\n  \n  // Ubicación\n  address: {\n    title: 'Address (Dirección)',\n    content: 'La dirección física donde está ubicada esta inversión. Ayuda con la organización y encontrarla después.',\n  },\n  \n  city: {\n    title: 'City (Ciudad)',\n    content: 'La ciudad o pueblo donde está ubicada esta inversión. Se usa para análisis regional y filtros.',\n  },\n  \n  state: {\n    title: 'State/Province (Estado/Región)',\n    content: 'El estado, provincia o región donde está ubicada esta inversión. Diferentes regiones tienen diferentes reglas fiscales y condiciones de mercado.',\n  },\n  \n  country: {\n    title: 'Country (País)',\n    content: 'El país donde está ubicada esta inversión. Importante para cambio de divisas, impuestos y consideraciones legales.',\n  },\n  \n  // Dashboard/Stats\n  totalValue: {\n    title: 'Total Portfolio Value (Valor Total del Portfolio)',\n    content: 'El valor actual combinado de todas tus inversiones ahora mismo. Este es tu net worth en inversiones.',\n    example: 'Si stocks valen $50k y tierra $100k, valor total = $150k.',\n  },\n  \n  returnPercentage: {\n    title: 'Return % (Retorno %)',\n    content: 'Cuánto ha ganado o perdido tu inversión como porcentaje. Positivo = ganancia, Negativo = pérdida.',\n    example: 'Compraste por $100, ahora vale $120 = 20% retorno.',\n  },\n  \n  // Crédito/Hipotecario\n  downPayment: {\n    title: 'Down Payment (Pie)',\n    content: 'El efectivo que debes pagar upfront al comprar con crédito. El resto lo pide prestado del banco.',\n    example: '10% de pie en una propiedad de $100k = $10k efectivo + $90k préstamo.',\n  },\n  \n  interestRate: {\n    title: 'Annual Interest Rate (Tasa de Interés Anual)',\n    content: 'El porcentaje que el banco te cobra por año por pedir dinero prestado. Menor es mejor. Esto se compone (compound) con el tiempo.',\n    example: '4% sobre $100k = $4,000 de interés en el año 1 (simplificado).',\n  },\n  \n  termYears: {\n    title: 'Loan Term (Años) (Plazo del Crédito)',\n    content: 'Cuántos años tienes para pagar el préstamo. Plazos más largos = pagos mensuales más bajos pero MUCHO más interés total pagado.',\n    example: '20 años vs 30 años: el pago mensual es menor con 30, pero pagas mucho más en total.',\n  },\n  \n  monthlyPayment: {\n    title: 'Monthly Payment (Dividendo Mensual)',\n    content: 'Lo que le pagas al banco cada mes. Incluye principal (devolviendo el préstamo) + interés (fee del banco) + seguros.',\n    example: 'Si el pago es $500/mes, después de 20 años habrás pagado $120,000 por un préstamo de $100k!',\n  },\n  \n  dfl2: {\n    title: 'DFL2 Benefit (Beneficio DFL2)',\n    content: 'Un beneficio tributario chileno para compradores de primera vivienda. Reduce el impuesto al mutuo del 0.8% al 0.2%, ahorrándote dinero.',\n    example: 'En un crédito de $100M CLP, el DFL2 te ahorra aproximadamente $600k CLP en impuestos.',\n  },\n  \n  effectiveCredit: {\n    title: 'Effective Credit (Crédito Efectivo)',\n    content: 'El dinero REAL que recibes del banco después de todos los fees y pie requerido. Los bancos anuncian números más altos de lo que realmente recibes.',\n    example: 'El banco dice \"crédito de $100k\" pero requiere $20k de pie + $5k en fees. Solo recibes $75k!',\n  },\n  \n  operationalExpenses: {\n    title: 'Operational Expenses (Gastos Operacionales)',\n    content: 'Todos los fees y costos extras para constituir una hipoteca: notaría, inscripción, tasación, seguros, impuestos. Estos suman rápido!',\n    example: 'Generalmente 2-5% del monto del préstamo en gastos.',\n  },\n  \n  // Métricas avanzadas\n  roi: {\n    title: 'ROI - Return on Investment',\n    content: 'Cuánta ganancia haces en relación a lo invertido. El número principal para comparar inversiones.',\n    example: 'Inviertes $100k, vendes por $120k = 20% ROI. Haces esto en 2 años = 10% por año.',\n  },\n  \n  irr: {\n    title: 'IRR - Internal Rate of Return (Tasa Interna de Retorno)',\n    content: 'Una forma sofisticada de calcular retorno anual que considera CUÁNDO recibes el dinero de vuelta. IRR más alto = mejor timing de inversión.',\n    example: 'Recibir ganancias más pronto es mejor que después, aunque el total sea el mismo.',\n  },\n  \n  ltv: {\n    title: 'LTV - Loan-to-Value Ratio',\n    content: 'Cuánto estás pidiendo prestado vs. lo que vale la propiedad. Más bajo = más seguro, pero requiere más efectivo upfront.',\n    example: 'Propiedad vale $100k, préstamo $80k = 80% LTV.',\n  },\n  \n  dscr: {\n    title: 'DSCR - Debt Service Coverage Ratio',\n    content: 'Puedes pagar el crédito? Compara tus ingresos contra los pagos de deuda. Los bancos quieren esto sobre 1.25x.',\n    example: 'DSCR de 1.5 = tus ingresos son 1.5x tus pagos de deuda. Seguro!',\n  },\n  \n  capRate: {\n    title: 'Cap Rate - Capitalization Rate (Tasa de Capitalización)',\n    content: 'Para propiedades de renta: ganancia anual como % del valor de la propiedad. Ayuda a comparar diferentes deals de real estate.',\n    example: 'Propiedad de $100k genera $5k/año en renta = 5% cap rate.',\n  },\n  \n  cashOnCash: {\n    title: 'Cash-on-Cash Return',\n    content: 'Tu ganancia anual como % del efectivo QUE TÚ pusiste (no el valor total). La mejor medida cuando usas créditos.',\n    example: 'Tú pusiste $20k efectivo, ganas $2k/año = 10% cash-on-cash.',\n  },\n  \n  // Análisis\n  confidenceScore: {\n    title: 'Confidence Score (Nivel de Confianza)',\n    content: 'Qué tan segura está la IA de su análisis. Más alto = más confiable. Basado en la calidad y claridad del documento.',\n    example: '80%+ = alta confianza. Bajo 50% = el documento era poco claro o incompleto.',\n  },\n  \n  score: {\n    title: 'Investment Score (Puntaje de Inversión)',\n    content: 'La calificación de nuestro algoritmo sobre esta oportunidad de inversión. Considera ROI, riesgo, efectivo necesario y condiciones de mercado.',\n    example: '70+ = strong buy (compra fuerte). 50-70 = decente. Bajo 50 = riesgoso o malos retornos.',\n  },\n  \n  breakEven: {\n    title: 'Break-Even Point (Punto de Equilibrio)',\n    content: 'Cuándo las ganancias de tu inversión cubren todos tus costos. Después de este punto, estás haciendo ganancia pura.',\n    example: 'Break-even en 3 años = recuperas tu dinero después de 3 años.',\n  },\n  \n  // Archivos\n  fileStatus: {\n    title: 'File Status (Estado del Archivo)',\n    content: 'Dónde está este archivo en nuestro pipeline de procesamiento. El análisis de IA ocurre automáticamente después del upload.',\n    example: 'Pending = recién subido. Processing = IA está leyéndolo. Completed = análisis listo.',\n  },\n  \n  // Campos de calculadora específicos\n  askingPrice: {\n    title: 'Asking Price (Precio de Venta)',\n    content: 'El precio que pide el vendedor por el terreno. Este es el punto de partida para negociar.',\n    example: 'Si el terreno está publicado en $50M CLP, ese es el asking price.',\n  },\n  \n  appraisalValue: {\n    title: 'Appraisal Value (Valor de Tasación)',\n    content: 'El valor profesional estimado de una propiedad, determinado por un tasador. Puede ser diferente del precio de venta.',\n    example: 'Si el banco lo tasa en $60M pero se vende en $50M, estás comprando bajo tasación.',\n  },\n  \n  pricePerSquareMeter: {\n    title: 'Price per m² (Precio por Metro Cuadrado)',\n    content: 'El precio dividido por los metros cuadrados. Permite comparar terrenos de diferentes tamaños.',\n    example: 'Terreno A: $50M / 1,000m² = $50,000/m². Terreno B: $80M / 2,000m² = $40,000/m². B tiene mejor precio por m².',\n  },\n  \n  expectedAppreciation: {\n    title: 'Expected Appreciation (Plusvalía Esperada)',\n    content: 'Cuánto esperas que suba el valor del terreno por año, en porcentaje. Basado en tendencias del mercado y desarrollo de la zona.',\n    example: 'Si una zona está creciendo rápido, podrías esperar 7-10% anual. Zona estable: 3-5%.',\n  },\n  \n  // Gastos operacionales\n  notaryFees: {\n    title: 'Notary Fees (Gastos Notariales)',\n    content: 'Costos de la escritura pública y firmas. En Chile, aproximadamente UF 2.5 (alrededor de $100k CLP).',\n  },\n  \n  registrationFees: {\n    title: 'Registration Fees (Inscripción CBR)',\n    content: 'Costos para inscribir la propiedad en el Conservador de Bienes Raíces. Generalmente similar a los gastos notariales.',\n  },\n  \n  appraisalFee: {\n    title: 'Appraisal Fee (Tasación)',\n    content: 'Costo de la tasación profesional que el banco requiere. Generalmente UF 2.5 o aproximadamente $100k CLP.',\n  },\n  \n  insuranceFees: {\n    title: 'Insurance Fees (Seguros)',\n    content: 'Seguros requeridos por el banco: desgravamen (por si mueres) y/o incendio/sismo. Mensuales pero a veces hay costos upfront.',\n  },\n  \n  stampTax: {\n    title: 'Stamp Tax - Impuesto al Mutuo',\n    content: 'Impuesto estampilla del 0.8% normalmente, o 0.2% con beneficio DFL2. Se paga sobre el monto del crédito.',\n    example: 'En crédito de $100M: normal = $800k impuesto. Con DFL2 = $200k. Ahorro de $600k!',\n  },\n  \n  // Métricas de análisis land+credit\n  cashRequired: {\n    title: 'Cash Required (Efectivo Requerido)',\n    content: 'Todo el dinero en efectivo que necesitas para cerrar el trato: pie + gastos operacionales + diferencia si el crédito no cubre todo.',\n    example: 'Pie $20M + Gastos $5M = $25M efectivo necesario.',\n  },\n  \n  trueCost: {\n    title: 'True Cost (Costo Real)',\n    content: 'Cuánto pagarás en total durante la vida del préstamo: principal + intereses + seguros. Siempre es más del doble del préstamo!',\n    example: 'Crédito de $100M a 20 años al 4%: pagas aproximadamente $145M en total.',\n  },\n  \n  equityMultiple: {\n    title: 'Equity Multiple',\n    content: 'Cuántas veces recuperas tu dinero invertido al final. 2.0x = duplicaste tu plata. 1.5x = 50% ganancia total.',\n    example: 'Inviertes $20k, recuperas $40k total = 2.0x equity multiple.',\n  },\n  \n  paybackPeriod: {\n    title: 'Payback Period (Período de Recuperación)',\n    content: 'Cuántos años tarda tu inversión en devolverte todo el dinero que pusiste. Después de esto es pura ganancia.',\n    example: 'Payback de 5 años = después del año 5, todo lo que ganes es ganancia neta.',\n  },\n  \n  taxBenefit: {\n    title: 'Tax Benefit (Beneficio Tributario)',\n    content: 'Ahorro en impuestos que obtienes por tener una hipoteca. En Chile, puedes deducir el interés pagado de tu renta tributaria.',\n    example: 'Si pagas $2M al año en intereses y tu tasa es 35%, ahorras $700k en impuestos.',\n  },\n}\n\nexport default HelpTooltip\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/hinoki/HinokiDEV/Investments/prism/web/src/components/InvestmentForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/hinoki/HinokiDEV/Investments/prism/web/src/components/Layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/hinoki/HinokiDEV/Investments/prism/web/src/components/MarketDataTicker.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'totalReturnPct' is assigned a value but never used.","line":41,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":41,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react'\nimport { Clock, DollarSign, CircleDollarSign, TrendingUp, Circle, Bitcoin, ArrowUpRight, ArrowDownRight } from 'lucide-react'\nimport { useQuery } from '@tanstack/react-query'\nimport { dashboardApi } from '../lib/api'\n\ninterface MarketData {\n  usd: number | null\n  uf: number | null\n  eur: number | null\n  utm: number | null\n  nasdaq: number | null\n  nasdaqChange: number | null\n  oil: number | null\n  gold: number | null\n  silver: number | null\n  copper: number | null\n  copperKg: number | null\n  lithium: number | null\n  bitcoin: number | null\n  ethereum: number | null\n  lastUpdate: Date | null\n}\n\ninterface MarketDataTickerProps {\n  collapsed: boolean\n  showTime?: boolean\n}\n\nexport default function MarketDataTicker({ collapsed, showTime = true }: MarketDataTickerProps) {\n  // showTime is reserved for future use\n  void showTime\n  const [currentTime, setCurrentTime] = useState<Date>(new Date())\n\n  // Fetch portfolio stats\n  const { data: portfolioStats } = useQuery({\n    queryKey: ['dashboard-stats'],\n    queryFn: dashboardApi.getStats,\n  })\n\n  const totalReturn = portfolioStats?.total_return || 0\n  const totalReturnPct = portfolioStats?.total_return_pct || 0\n  const [marketData, setMarketData] = useState<MarketData>({\n    usd: null,\n    uf: null,\n    eur: null,\n    utm: null,\n    nasdaq: null,\n    nasdaqChange: null,\n    oil: null,\n    gold: null,\n    silver: null,\n    copper: null,\n    copperKg: null,\n    lithium: null,\n    bitcoin: null,\n    ethereum: null,\n    lastUpdate: null,\n  })\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState<string | null>(null)\n\n  // Update clock every second\n  useEffect(() => {\n    const timer = setInterval(() => {\n      setCurrentTime(new Date())\n    }, 1000)\n    return () => clearInterval(timer)\n  }, [])\n\n  // Fetch market data\n  const fetchMarketData = useCallback(async () => {\n    try {\n      setLoading(true)\n      setError(null)\n\n      // Fetch USD, UF, EUR, UTM from Mindicador.cl API\n      const [usdRes, ufRes, eurRes, utmRes] = await Promise.all([\n        fetch('https://mindicador.cl/api/dolar'),\n        fetch('https://mindicador.cl/api/uf'),\n        fetch('https://mindicador.cl/api/euro'),\n        fetch('https://mindicador.cl/api/utm'),\n      ])\n\n      if (!usdRes.ok || !ufRes.ok) {\n        throw new Error('Failed to fetch market data')\n      }\n\n      const usdData = await usdRes.json()\n      const ufData = await ufRes.json()\n      const eurData = eurRes.ok ? await eurRes.json() : null\n      const utmData = utmRes.ok ? await utmRes.json() : null\n\n      // Get latest values (API returns array with most recent first)\n      const latestUsd = usdData.serie?.[0]?.valor || null\n      const latestUf = ufData.serie?.[0]?.valor || null\n      const latestEur = eurData?.serie?.[0]?.valor || null\n      const latestUtm = utmData?.serie?.[0]?.valor || null\n\n      // Fetch metals, NASDAQ, oil, copper, lithium from backend (avoids CORS with Yahoo)\n      let goldPriceClpPerGram: number | null = null\n      let silverPriceClpPerGram: number | null = null\n      let nasdaqPrice: number | null = null\n      let nasdaqChange: number | null = null\n      let oilPrice: number | null = null\n      let copperPriceLb: number | null = null\n      let copperPriceKg: number | null = null\n      let lithiumPrice: number | null = null\n\n      try {\n        const apiUrl = import.meta.env.VITE_API_URL || 'http://localhost:8000'\n        const marketRes = await fetch(`${apiUrl}/api/v1/dashboard/market-data`, {\n          signal: AbortSignal.timeout(8000)\n        })\n        const contentType = marketRes.headers.get('content-type')\n        if (marketRes.ok && contentType?.includes('application/json')) {\n          const md = await marketRes.json()\n          goldPriceClpPerGram = md.gold_clp_per_gram ?? null\n          silverPriceClpPerGram = md.silver_clp_per_gram ?? null\n          nasdaqPrice = md.nasdaq_price ?? null\n          nasdaqChange = md.nasdaq_change_pct ?? null\n          oilPrice = md.oil_usd_bbl ?? null\n          copperPriceLb = md.copper_usd_lb ?? null\n          copperPriceKg = md.copper_usd_kg ?? null\n          lithiumPrice = md.lithium_proxy_usd ?? null\n          console.log('[MarketData] Backend response:', md)\n        }\n      } catch (err) {\n        console.warn('[MarketData] Backend unavailable, trying Yahoo fallback:', err)\n      }\n\n      // If backend didn't return Yahoo data, log it — direct Yahoo calls from\n      // the browser are blocked by CORS, so the backend is required.\n      if (goldPriceClpPerGram === null && nasdaqPrice === null) {\n        console.warn('[MarketData] Backend returned no Yahoo data. Ensure the API server is running.')\n      }\n\n      // Fetch crypto prices (Bitcoin & Ethereum in USD)\n      let bitcoinPriceUsd: number | null = null\n      let ethereumPriceUsd: number | null = null\n\n      try {\n        const cryptoRes = await fetch(\n          'https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum&vs_currencies=usd',\n          { signal: AbortSignal.timeout(5000) }\n        )\n        if (cryptoRes.ok) {\n          const cryptoData = await cryptoRes.json()\n          bitcoinPriceUsd = cryptoData.bitcoin?.usd || null\n          ethereumPriceUsd = cryptoData.ethereum?.usd || null\n        }\n      } catch {\n        // Crypto prices not critical, continue without them\n      }\n\n      // Convert crypto to CLP\n      const bitcoinPriceClp = bitcoinPriceUsd && latestUsd\n        ? bitcoinPriceUsd * latestUsd\n        : null\n      const ethereumPriceClp = ethereumPriceUsd && latestUsd\n        ? ethereumPriceUsd * latestUsd\n        : null\n\n      setMarketData({\n        usd: latestUsd,\n        uf: latestUf,\n        eur: latestEur,\n        utm: latestUtm,\n        nasdaq: nasdaqPrice,\n        nasdaqChange,\n        oil: oilPrice,\n        gold: goldPriceClpPerGram,\n        silver: silverPriceClpPerGram,\n        copper: copperPriceLb,\n        copperKg: copperPriceKg,\n        lithium: lithiumPrice,\n        bitcoin: bitcoinPriceClp,\n        ethereum: ethereumPriceClp,\n        lastUpdate: new Date(),\n      })\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Error fetching data')\n    } finally {\n      setLoading(false)\n    }\n  }, [])\n\n  // Initial fetch and periodic refresh\n  useEffect(() => {\n    fetchMarketData()\n    // Refresh every 5 minutes\n    const interval = setInterval(fetchMarketData, 5 * 60 * 1000)\n    return () => clearInterval(interval)\n  }, [fetchMarketData])\n\n  // Format Chilean date and time\n  const formatChileanDateTime = (date: Date): string => {\n    return date.toLocaleString('es-CL', {\n      timeZone: 'America/Santiago',\n      day: '2-digit',\n      month: '2-digit',\n      year: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit',\n      second: '2-digit',\n      hour12: false,\n    })\n  }\n\n\n  // Format currency\n  const formatCurrency = (value: number | null, decimals: number = 0): string => {\n    if (value === null || value === undefined) return '—'\n    return value.toLocaleString('es-CL', {\n      minimumFractionDigits: decimals,\n      maximumFractionDigits: decimals,\n    })\n  }\n\n  // Compact format for large numbers (e.g., 58.032.080 -> 58,03M)\n  const formatCompact = (value: number | null): string => {\n    if (value === null || value === undefined) return '—'\n    if (value >= 1_000_000_000) {\n      return (value / 1_000_000_000).toFixed(2).replace('.', ',') + 'M'\n    }\n    if (value >= 1_000_000) {\n      return (value / 1_000_000).toFixed(2).replace('.', ',') + 'M'\n    }\n    if (value >= 1_000) {\n      return (value / 1_000).toFixed(2).replace('.', ',') + 'k'\n    }\n    return value.toLocaleString('es-CL')\n  }\n\n  // Collapsed view - 2-column icon grid with tooltips\n  // Icon helper to avoid repetition\n  const ColIcon = ({\n    color, tooltip, children\n  }: { color: string; tooltip: React.ReactNode; children: React.ReactNode }) => (\n    <div className=\"group relative flex justify-center\">\n      <div className={`w-7 h-7 flex items-center justify-center rounded-lg bg-surface/50 text-text-muted transition-colors hover:bg-surface ${color}`}>\n        {children}\n      </div>\n      <div className=\"absolute left-full ml-3 px-3 py-2 bg-surface-elevated border border-border rounded-lg text-sm text-text-primary whitespace-nowrap opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50 shadow-xl\">\n        {tooltip}\n        <div className=\"absolute left-0 top-1/2 -translate-x-1 -translate-y-1/2 w-2 h-2 bg-surface-elevated border-l border-b border-border rotate-45\" />\n      </div>\n    </div>\n  )\n\n  if (collapsed) {\n    return (\n      <div className=\"px-1.5 pt-2 pb-1\">\n        <div className=\"grid grid-cols-2 gap-1.5\">\n\n          {/* Row 1: UF | UTM */}\n          <ColIcon color=\"hover:text-warning\" tooltip={<><div className=\"text-xs text-text-muted mb-1\">Unidad de Fomento</div><div className=\"font-mono text-warning\">${loading ? '...' : formatCurrency(marketData.uf, 2)}</div></>}>\n            <span className=\"text-[10px] font-bold\">UF</span>\n          </ColIcon>\n          <ColIcon color=\"hover:text-purple-400\" tooltip={<><div className=\"text-xs text-text-muted mb-1\">Unidad Trib. Mensual</div><div className=\"font-mono text-purple-400\">${loading ? '...' : formatCurrency(marketData.utm)}</div></>}>\n            <span className=\"text-[8px] font-bold\">UTM</span>\n          </ColIcon>\n\n          {/* Row 2: EUR | USD */}\n          <ColIcon color=\"hover:text-sky-400\" tooltip={<><div className=\"text-xs text-text-muted mb-1\">EUR/CLP</div><div className=\"font-mono text-sky-400\">${loading ? '...' : formatCurrency(marketData.eur)}</div></>}>\n            <span className=\"text-[11px] font-bold\">€</span>\n          </ColIcon>\n          <ColIcon color=\"hover:text-success\" tooltip={<><div className=\"text-xs text-text-muted mb-1\">USD/CLP</div><div className=\"font-mono text-success\">${loading ? '...' : formatCurrency(marketData.usd)}</div></>}>\n            <DollarSign className=\"h-3.5 w-3.5\" />\n          </ColIcon>\n\n          {/* Row 3: NASDAQ | OIL */}\n          <ColIcon color=\"hover:text-emerald-400\" tooltip={<><div className=\"text-xs text-text-muted mb-1\">NASDAQ Composite</div><div className=\"font-mono text-emerald-400\">{marketData.nasdaq ? marketData.nasdaq.toLocaleString('en-US', { maximumFractionDigits: 0 }) : '—'}</div>{marketData.nasdaqChange !== null && <div className={`text-xs mt-0.5 ${marketData.nasdaqChange >= 0 ? 'text-emerald-400' : 'text-red-400'}`}>{marketData.nasdaqChange >= 0 ? '+' : ''}{marketData.nasdaqChange.toFixed(2)}%</div>}</>}>\n            <span className=\"text-[8px] font-bold tracking-tight\">NDQ</span>\n          </ColIcon>\n          <ColIcon color=\"hover:text-amber-500\" tooltip={<><div className=\"text-xs text-text-muted mb-1\">WTI Crude (USD/bbl)</div><div className=\"font-mono text-amber-500\">{marketData.oil ? `$${marketData.oil.toFixed(2)}` : '—'}</div></>}>\n            <span className=\"text-[8px] font-bold\">OIL</span>\n          </ColIcon>\n\n          {/* Row 4: Gold | Silver */}\n          <ColIcon color=\"hover:text-warning\" tooltip={<><div className=\"text-xs text-text-muted mb-1\">Oro (CLP/g)</div><div className=\"font-mono text-warning\">{marketData.gold ? `$${formatCurrency(marketData.gold)}` : '—'}</div></>}>\n            <TrendingUp className=\"h-3.5 w-3.5\" />\n          </ColIcon>\n          <ColIcon color=\"hover:text-blue-400\" tooltip={<><div className=\"text-xs text-text-muted mb-1\">Plata (CLP/g)</div><div className=\"font-mono text-blue-400\">{marketData.silver ? `$${formatCurrency(marketData.silver)}` : '—'}</div></>}>\n            <Circle className=\"h-3.5 w-3.5\" />\n          </ColIcon>\n\n          {/* Row 5: Copper | Lithium */}\n          <ColIcon color=\"hover:text-orange-400\" tooltip={<><div className=\"text-xs text-text-muted mb-1\">Cobre (USD/lb)</div><div className=\"font-mono text-orange-400\">{marketData.copper ? `$${marketData.copper.toFixed(2)}` : '—'}</div>{marketData.copperKg && <div className=\"text-[10px] text-text-muted mt-0.5\">${marketData.copperKg.toFixed(0)}/kg</div>}</>}>\n            <span className=\"text-[8px] font-bold\">CU</span>\n          </ColIcon>\n          <ColIcon color=\"hover:text-teal-400\" tooltip={<><div className=\"text-xs text-text-muted mb-1\">Litio – ALB (USD)</div><div className=\"font-mono text-teal-400\">{marketData.lithium ? `$${marketData.lithium.toFixed(2)}` : '—'}</div></>}>\n            <span className=\"text-[8px] font-bold\">Li</span>\n          </ColIcon>\n\n          {/* Row 6: BTC | ETH */}\n          <ColIcon color=\"hover:text-orange-500\" tooltip={<><div className=\"text-xs text-text-muted mb-1\">Bitcoin (CLP)</div><div className=\"font-mono text-orange-500\">{marketData.bitcoin ? `$${formatCurrency(marketData.bitcoin)}` : '—'}</div></>}>\n            <Bitcoin className=\"h-3.5 w-3.5\" />\n          </ColIcon>\n          <ColIcon color=\"hover:text-indigo-400\" tooltip={<><div className=\"text-xs text-text-muted mb-1\">Ethereum (CLP)</div><div className=\"font-mono text-indigo-400\">{marketData.ethereum ? `$${formatCurrency(marketData.ethereum)}` : '—'}</div></>}>\n            <span className=\"text-[10px] font-bold\">Ξ</span>\n          </ColIcon>\n\n          {/* Row 7: Ganancia | Pérdida */}\n          <ColIcon color=\"hover:text-success\" tooltip={<><div className=\"text-xs text-text-muted mb-1\">Ganancia</div><div className=\"font-mono text-success\">{totalReturn >= 0 ? `$${formatCurrency(totalReturn)}` : '—'}</div></>}>\n            <ArrowUpRight className=\"h-3.5 w-3.5\" />\n          </ColIcon>\n          <ColIcon color=\"hover:text-error\" tooltip={<><div className=\"text-xs text-text-muted mb-1\">Pérdida</div><div className=\"font-mono text-error\">{totalReturn < 0 ? `$${formatCurrency(Math.abs(totalReturn))}` : '—'}</div></>}>\n            <ArrowDownRight className=\"h-3.5 w-3.5\" />\n          </ColIcon>\n\n        </div>\n      </div>\n    )\n  }\n\n  // Expanded view - full display\n  return (\n    <div className=\"px-4 py-3 space-y-3\">\n      {/* Date & Time - only show if showTime is true */}\n      {showTime && (\n        <div className=\"p-2.5 rounded-xl bg-surface/40 border border-border/50\">\n          <div className=\"flex items-center gap-2 mb-1.5\">\n            <Clock className=\"h-3.5 w-3.5 text-text-muted\" />\n            <span className=\"text-[10px] font-medium text-text-muted uppercase tracking-wider\">Chile</span>\n          </div>\n          <div className=\"font-mono text-sm text-text-primary truncate\" title={formatChileanDateTime(currentTime)}>\n            {formatChileanDateTime(currentTime)}\n          </div>\n        </div>\n      )}\n\n      {/* Portfolio Metrics Grid */}\n      <div className=\"grid grid-cols-2 gap-2\">\n        {/* Profit */}\n        <div className=\"p-2.5 rounded-xl bg-surface/40 border border-border/50 hover:border-success/30 transition-colors\">\n          <div className=\"flex items-center gap-1.5 mb-1\">\n            <ArrowUpRight className=\"h-3 w-3 text-success\" />\n            <span className=\"text-[10px] font-medium text-text-muted uppercase\">Ganancia</span>\n          </div>\n          <div\n            className=\"font-mono text-success truncate text-sm\"\n            title={totalReturn >= 0 ? `$${formatCurrency(totalReturn)}` : '—'}\n          >\n            {totalReturn >= 0 ? `$${formatCurrency(totalReturn)}` : '—'}\n          </div>\n        </div>\n\n        {/* Loss */}\n        <div className=\"p-2.5 rounded-xl bg-surface/40 border border-border/50 hover:border-error/30 transition-colors\">\n          <div className=\"flex items-center gap-1.5 mb-1\">\n            <ArrowDownRight className=\"h-3 w-3 text-error\" />\n            <span className=\"text-[10px] font-medium text-text-muted uppercase\">Pérdida</span>\n          </div>\n          <div\n            className=\"font-mono text-error truncate text-sm\"\n            title={totalReturn < 0 ? `$${formatCurrency(Math.abs(totalReturn))}` : '—'}\n          >\n            {totalReturn < 0 ? `$${formatCurrency(Math.abs(totalReturn))}` : '—'}\n          </div>\n        </div>\n      </div>\n\n      {/* UF & UTM Grid (Chilean indexed units) */}\n      <div className=\"grid grid-cols-2 gap-2\">\n        {/* UF */}\n        <div className=\"p-2.5 rounded-xl bg-surface/40 border border-border/50 hover:border-warning/30 transition-colors\">\n          <div className=\"flex items-center gap-1.5 mb-1\">\n            <CircleDollarSign className=\"h-3 w-3 text-warning\" />\n            <span className=\"text-[10px] font-medium text-text-muted uppercase\">UF</span>\n          </div>\n          <div\n            className=\"font-mono text-warning truncate text-sm\"\n            title={marketData.uf ? `$${formatCurrency(marketData.uf, 2)}` : '—'}\n          >\n            {loading ? (\n              <span className=\"text-text-muted\">...</span>\n            ) : (\n              `$${formatCurrency(marketData.uf, 2)}`\n            )}\n          </div>\n        </div>\n\n        {/* UTM */}\n        <div className=\"p-2.5 rounded-xl bg-surface/40 border border-border/50 hover:border-purple-400/30 transition-colors\">\n          <div className=\"flex items-center gap-1.5 mb-1\">\n            <span className=\"text-[9px] font-bold text-purple-400 leading-none\">UTM</span>\n            <span className=\"text-[10px] font-medium text-text-muted uppercase\">CLP</span>\n          </div>\n          <div\n            className=\"font-mono text-purple-400 truncate text-sm\"\n            title={marketData.utm ? `$${formatCurrency(marketData.utm)}` : '—'}\n          >\n            {loading ? (\n              <span className=\"text-text-muted\">...</span>\n            ) : (\n              `$${formatCurrency(marketData.utm)}`\n            )}\n          </div>\n        </div>\n      </div>\n\n      {/* EUR & USD Grid (foreign currencies) */}\n      <div className=\"grid grid-cols-2 gap-2\">\n        {/* EUR */}\n        <div className=\"p-2.5 rounded-xl bg-surface/40 border border-border/50 hover:border-sky-400/30 transition-colors\">\n          <div className=\"flex items-center gap-1.5 mb-1\">\n            <span className=\"text-[11px] font-bold text-sky-400\">€</span>\n            <span className=\"text-[10px] font-medium text-text-muted uppercase\">EUR</span>\n          </div>\n          <div\n            className=\"font-mono text-sky-400 truncate text-sm\"\n            title={marketData.eur ? `$${formatCurrency(marketData.eur)}` : '—'}\n          >\n            {loading ? (\n              <span className=\"text-text-muted\">...</span>\n            ) : (\n              `$${formatCurrency(marketData.eur)}`\n            )}\n          </div>\n        </div>\n\n        {/* USD */}\n        <div className=\"p-2.5 rounded-xl bg-surface/40 border border-border/50 hover:border-success/30 transition-colors\">\n          <div className=\"flex items-center gap-1.5 mb-1\">\n            <DollarSign className=\"h-3 w-3 text-success\" />\n            <span className=\"text-[10px] font-medium text-text-muted uppercase\">USD</span>\n          </div>\n          <div\n            className=\"font-mono text-success truncate text-sm\"\n            title={marketData.usd ? `$${formatCurrency(marketData.usd)}` : '—'}\n          >\n            {loading ? (\n              <span className=\"text-text-muted\">...</span>\n            ) : (\n              `$${formatCurrency(marketData.usd)}`\n            )}\n          </div>\n        </div>\n      </div>\n\n      {/* NASDAQ & Oil Grid */}\n      <div className=\"grid grid-cols-2 gap-2\">\n        {/* NASDAQ */}\n        <div className=\"p-2.5 rounded-xl bg-surface/40 border border-border/50 hover:border-emerald-400/30 transition-colors\">\n          <div className=\"flex items-center justify-between mb-1\">\n            <div className=\"flex items-center gap-1.5\">\n              <span className=\"text-[8px] font-bold text-emerald-400 tracking-tight\">NDQ</span>\n              <span className=\"text-[10px] font-medium text-text-muted uppercase\">Nasdaq</span>\n            </div>\n            {marketData.nasdaqChange !== null && (\n              <span className={`text-[9px] font-semibold ${marketData.nasdaqChange >= 0 ? 'text-emerald-400' : 'text-red-400'\n                }`}>\n                {marketData.nasdaqChange >= 0 ? '+' : ''}{marketData.nasdaqChange.toFixed(2)}%\n              </span>\n            )}\n          </div>\n          <div\n            className=\"font-mono text-emerald-400 truncate text-sm\"\n            title={marketData.nasdaq ? marketData.nasdaq.toLocaleString('en-US', { maximumFractionDigits: 0 }) : '—'}\n          >\n            {loading ? (\n              <span className=\"text-text-muted\">...</span>\n            ) : marketData.nasdaq ? (\n              marketData.nasdaq.toLocaleString('en-US', { maximumFractionDigits: 0 })\n            ) : (\n              <span className=\"text-text-muted text-xs\">—</span>\n            )}\n          </div>\n        </div>\n\n        {/* WTI Oil */}\n        <div className=\"p-2.5 rounded-xl bg-surface/40 border border-border/50 hover:border-amber-500/30 transition-colors\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-1.5\">\n              <span className=\"text-[9px] font-bold text-amber-500\">OIL</span>\n              <span className=\"text-[10px] font-medium text-text-muted uppercase\">WTI</span>\n            </div>\n            <span className=\"text-[9px] text-text-muted\">/bbl</span>\n          </div>\n          <div\n            className=\"font-mono text-amber-500 mt-1 truncate text-sm\"\n            title={marketData.oil ? `$${marketData.oil.toFixed(2)}` : '—'}\n          >\n            {loading ? (\n              <span className=\"text-text-muted\">...</span>\n            ) : marketData.oil ? (\n              `$${marketData.oil.toFixed(2)}`\n            ) : (\n              <span className=\"text-text-muted text-xs\">—</span>\n            )}\n          </div>\n        </div>\n      </div>\n\n      {/* Gold & Silver Grid */}\n      <div className=\"grid grid-cols-2 gap-2\">\n        {/* Gold */}\n        <div className=\"p-2.5 rounded-xl bg-surface/40 border border-border/50 hover:border-warning/30 transition-colors\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-1.5\">\n              <TrendingUp className=\"h-3 w-3 text-warning\" />\n              <span className=\"text-[10px] font-medium text-text-muted uppercase\">Oro</span>\n            </div>\n            <span className=\"text-[9px] text-text-muted\">/g</span>\n          </div>\n          <div\n            className=\"font-mono text-warning mt-1 truncate text-sm\"\n            title={marketData.gold ? `$${formatCurrency(marketData.gold)}` : '—'}\n          >\n            {loading ? (\n              <span className=\"text-text-muted\">...</span>\n            ) : marketData.gold ? (\n              `$${formatCurrency(marketData.gold)}`\n            ) : (\n              <span className=\"text-text-muted text-xs\">—</span>\n            )}\n          </div>\n        </div>\n\n        {/* Silver */}\n        <div className=\"p-2.5 rounded-xl bg-surface/40 border border-border/50 hover:border-blue-400/30 transition-colors\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-1.5\">\n              <Circle className=\"h-3 w-3 text-blue-400\" />\n              <span className=\"text-[10px] font-medium text-text-muted uppercase\">Plata</span>\n            </div>\n            <span className=\"text-[9px] text-text-muted\">/g</span>\n          </div>\n          <div\n            className=\"font-mono text-blue-400 mt-1 truncate text-sm\"\n            title={marketData.silver ? `$${formatCurrency(marketData.silver)}` : '—'}\n          >\n            {loading ? (\n              <span className=\"text-text-muted\">...</span>\n            ) : marketData.silver ? (\n              `$${formatCurrency(marketData.silver)}`\n            ) : (\n              <span className=\"text-text-muted text-xs\">—</span>\n            )}\n          </div>\n        </div>\n      </div>\n\n      {/* Copper & Lithium Grid */}\n      <div className=\"grid grid-cols-2 gap-2\">\n        {/* Copper */}\n        <div className=\"p-2.5 rounded-xl bg-surface/40 border border-border/50 hover:border-orange-400/30 transition-colors\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-1.5\">\n              <span className=\"text-[9px] font-bold text-orange-400\">CU</span>\n              <span className=\"text-[10px] font-medium text-text-muted uppercase\">Cobre</span>\n            </div>\n            <span className=\"text-[9px] text-text-muted\">/lb</span>\n          </div>\n          <div\n            className=\"font-mono text-orange-400 mt-1 truncate text-sm\"\n            title={marketData.copper ? `$${marketData.copper.toFixed(2)} /lb — $${marketData.copperKg?.toFixed(2) ?? '—'} /kg` : '—'}\n          >\n            {loading ? (\n              <span className=\"text-text-muted\">...</span>\n            ) : marketData.copper ? (\n              `$${marketData.copper.toFixed(2)}`\n            ) : (\n              <span className=\"text-text-muted text-xs\">—</span>\n            )}\n          </div>\n          {marketData.copperKg && !loading && (\n            <div className=\"text-[10px] text-text-muted font-mono mt-0.5\">${marketData.copperKg.toFixed(0)}/kg</div>\n          )}\n        </div>\n\n        {/* Lithium (ALB proxy) */}\n        <div className=\"p-2.5 rounded-xl bg-surface/40 border border-border/50 hover:border-teal-400/30 transition-colors\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-1.5\">\n              <span className=\"text-[9px] font-bold text-teal-400\">Li</span>\n              <span className=\"text-[10px] font-medium text-text-muted uppercase\">Litio</span>\n            </div>\n            <span className=\"text-[9px] text-text-muted\">ALB</span>\n          </div>\n          <div\n            className=\"font-mono text-teal-400 mt-1 truncate text-sm\"\n            title={marketData.lithium ? `$${marketData.lithium.toFixed(2)} (ALB)` : '—'}\n          >\n            {loading ? (\n              <span className=\"text-text-muted\">...</span>\n            ) : marketData.lithium ? (\n              `$${marketData.lithium.toFixed(2)}`\n            ) : (\n              <span className=\"text-text-muted text-xs\">—</span>\n            )}\n          </div>\n        </div>\n      </div>\n\n      {/* Crypto Grid */}\n      <div className=\"grid grid-cols-2 gap-2\">\n        {/* Bitcoin */}\n        <div className=\"p-2.5 rounded-xl bg-surface/40 border border-border/50 hover:border-orange-500/30 transition-colors group relative\">\n          <div className=\"flex items-center gap-1.5 mb-1\">\n            <Bitcoin className=\"h-3 w-3 text-orange-500\" />\n            <span className=\"text-[10px] font-medium text-text-muted uppercase\">BTC</span>\n          </div>\n          <div\n            className=\"font-mono text-orange-500 truncate text-sm\"\n            title={marketData.bitcoin ? `$${formatCurrency(marketData.bitcoin)}` : '—'}\n          >\n            {loading ? (\n              <span className=\"text-text-muted\">...</span>\n            ) : marketData.bitcoin ? (\n              marketData.bitcoin >= 1_000_000 ? (\n                <span>${formatCompact(marketData.bitcoin)}</span>\n              ) : (\n                `$${formatCurrency(marketData.bitcoin)}`\n              )\n            ) : (\n              <span className=\"text-text-muted text-xs\">—</span>\n            )}\n          </div>\n          {/* Tooltip for full value */}\n          {marketData.bitcoin && marketData.bitcoin >= 1_000_000 && (\n            <div className=\"absolute left-1/2 -translate-x-1/2 bottom-full mb-1 px-2 py-1 bg-surface-elevated border border-border rounded text-xs text-text-primary whitespace-nowrap opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all z-10 shadow-lg\">\n              ${formatCurrency(marketData.bitcoin)}\n              <div className=\"absolute left-1/2 -translate-x-1/2 top-full w-1.5 h-1.5 bg-surface-elevated border-r border-b border-border rotate-45 -mt-0.5\" />\n            </div>\n          )}\n        </div>\n\n        {/* Ethereum */}\n        <div className=\"p-2.5 rounded-xl bg-surface/40 border border-border/50 hover:border-indigo-400/30 transition-colors group relative\">\n          <div className=\"flex items-center gap-1.5 mb-1\">\n            <span className=\"text-[10px] font-bold text-indigo-400\">Ξ</span>\n            <span className=\"text-[10px] font-medium text-text-muted uppercase\">ETH</span>\n          </div>\n          <div\n            className=\"font-mono text-indigo-400 truncate text-sm\"\n            title={marketData.ethereum ? `$${formatCurrency(marketData.ethereum)}` : '—'}\n          >\n            {loading ? (\n              <span className=\"text-text-muted\">...</span>\n            ) : marketData.ethereum ? (\n              marketData.ethereum >= 1_000_000 ? (\n                <span>${formatCompact(marketData.ethereum)}</span>\n              ) : (\n                `$${formatCurrency(marketData.ethereum)}`\n              )\n            ) : (\n              <span className=\"text-text-muted text-xs\">—</span>\n            )}\n          </div>\n          {/* Tooltip for full value */}\n          {marketData.ethereum && marketData.ethereum >= 1_000_000 && (\n            <div className=\"absolute left-1/2 -translate-x-1/2 bottom-full mb-1 px-2 py-1 bg-surface-elevated border border-border rounded text-xs text-text-primary whitespace-nowrap opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all z-10 shadow-lg\">\n              ${formatCurrency(marketData.ethereum)}\n              <div className=\"absolute left-1/2 -translate-x-1/2 top-full w-1.5 h-1.5 bg-surface-elevated border-r border-b border-border rotate-45 -mt-0.5\" />\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Error message */}\n      {error && (\n        <div className=\"text-[9px] text-error px-1\">\n          Error al cargar datos\n        </div>\n      )}\n    </div>\n  )\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/hinoki/HinokiDEV/Investments/prism/web/src/components/MoneyCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/hinoki/HinokiDEV/Investments/prism/web/src/components/StatCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/hinoki/HinokiDEV/Investments/prism/web/src/lib/api.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":115,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3499,3502],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3499,3502],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":259,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":259,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6837,6840],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6837,6840],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":314,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":314,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9102,9105],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9102,9105],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import axios from 'axios'\n\nconst API_URL = import.meta.env.VITE_API_URL || 'http://localhost:8000'\n\nexport const api = axios.create({\n  baseURL: `${API_URL}/api/v1`,\n  headers: {\n    'Content-Type': 'application/json',\n  },\n})\n\n// Types\nexport interface Investment {\n  id: string\n  name: string\n  category: 'land' | 'stocks' | 'gold' | 'crypto' | 'real_estate' | 'bonds' | 'other'\n  description?: string\n  address?: string\n  city?: string\n  state?: string\n  country: string\n  purchase_price?: number\n  purchase_date?: string\n  current_value?: number\n  last_valuation_date?: string\n  land_area_hectares?: number\n  zoning_type?: string\n  ownership_percentage?: number\n  status: 'active' | 'sold' | 'pending' | 'under_contract'\n  tags: string[]\n  created_at: string\n  updated_at: string\n  document_count?: number\n  file_count?: number\n  return_percentage?: number\n}\n\nexport interface FileItem {\n  id: string\n  original_filename: string\n  storage_key: string\n  file_size_bytes?: number\n  mime_type?: string\n  status: 'pending' | 'processing' | 'completed' | 'failed'\n  uploaded_at: string\n  investment_id?: string\n  tags: string[]\n}\n\nexport interface AnalysisResult {\n  id: string\n  analysis_type: string\n  confidence_score?: number\n  summary?: string\n  raw_text?: string\n  created_at: string\n}\n\nexport interface DashboardStats {\n  total_investments: number\n  total_value: number\n  total_invested?: number\n  total_return?: number\n  total_return_pct?: number\n  total_files: number\n  pending_analyses: number\n  completed_analyses: number\n  investments_by_category: Record<string, number>\n  recent_uploads: FileItem[]\n  recent_analyses: AnalysisResult[]\n}\n\n// API Functions\nexport const dashboardApi = {\n  getStats: () => api.get<DashboardStats>('/dashboard/stats').then(r => r.data),\n  getCategoryBreakdown: () => api.get('/dashboard/category-breakdown').then(r => r.data),\n}\n\nexport const investmentsApi = {\n  list: () => api.get<Investment[]>('/investments').then(r => r.data),\n  get: (id: string) => api.get<Investment>(`/investments/${id}`).then(r => r.data),\n  create: (data: Partial<Investment>) => api.post<Investment>('/investments', data).then(r => r.data),\n  update: (id: string, data: Partial<Investment>) => api.put<Investment>(`/investments/${id}`, data).then(r => r.data),\n  delete: (id: string) => api.delete(`/investments/${id}`),\n}\n\nexport const filesApi = {\n  list: () => api.get<FileItem[]>('/files').then(r => r.data),\n  get: (id: string) => api.get<FileItem>(`/files/${id}`).then(r => r.data),\n  getDownloadUrl: (id: string) => api.get(`/files/${id}/download-url`).then(r => r.data),\n  delete: (id: string) => api.delete(`/files/${id}`),\n}\n\nexport const uploadsApi = {\n  requestUrl: (data: { filename: string; content_type: string; investment_id?: string; source_device?: string }) =>\n    api.post('/uploads/request-url', data).then(r => r.data),\n  confirm: (data: { file_id: string; investment_id?: string; document_type?: string; request_analysis?: boolean }) =>\n    api.post('/uploads/confirm', data).then(r => r.data),\n}\n\nexport const analysisApi = {\n  listResults: () => api.get<AnalysisResult[]>('/analysis/results').then(r => r.data),\n  listJobs: () => api.get('/analysis/jobs').then(r => r.data),\n  getQueueStats: () => api.get('/analysis/queue/stats').then(r => r.data),\n}\n\n// Chat Types\nexport interface ChatMessage {\n  role: 'user' | 'assistant' | 'system'\n  content: string\n  attachments?: Array<{\n    id: string\n    type: 'investment' | 'file'\n    name: string\n    data: any\n  }>\n}\n\nexport interface ChatRequest {\n  messages: ChatMessage[]\n  investment_id?: string\n  file_ids?: string[]\n  stream?: boolean\n  model?: string\n  api_key?: string\n}\n\nexport interface ChatResponse {\n  message: ChatMessage\n  usage?: {\n    prompt_tokens: number\n    completion_tokens: number\n    total_tokens: number\n  }\n  model: string\n}\n\n// Analytics Types\nexport interface InvestmentMetrics {\n  investment_id: string\n  name: string\n  category: string\n  basic: {\n    total_invested: number\n    current_value: number\n    absolute_return: number\n    simple_roi: number\n  }\n  time_weighted: {\n    annualized_roi: number | null\n    cagr: number | null\n    years_held: number\n  }\n  advanced: {\n    irr: number | null\n    npv: number | null\n    payback_period_months: number | null\n  }\n  risk: {\n    sharpe_ratio: number | null\n    volatility: number | null\n    max_drawdown: number | null\n    var_95: number | null\n  }\n  comparative: {\n    vs_inflation: number | null\n    vs_cdi: number | null\n    vs_sp500: number | null\n  }\n}\n\nexport interface PortfolioSummary {\n  summary: {\n    total_value: number\n    total_invested: number\n    total_absolute_return: number\n    total_roi: number\n    weighted_cagr: number | null\n  }\n  risk: {\n    portfolio_volatility: number | null\n    portfolio_sharpe: number | null\n  }\n  allocation: Record<string, number>\n  best_performer: { id: string; name: string; roi: number } | null\n  worst_performer: { id: string; name: string; roi: number } | null\n  investment_count: number\n  investments: InvestmentMetrics[]\n}\n\nexport interface ComparisonResult {\n  winner: {\n    id: string\n    name: string\n    score: number\n  }\n  rankings: Array<{\n    investment_id: string\n    name: string\n    category: string\n    metrics: Record<string, number | null>\n    scores: {\n      composite: number\n      risk_adjusted: number | null\n    }\n    rankings: {\n      composite: number\n      roi: number\n      cagr: number\n      sharpe: number\n    }\n  }>\n  portfolio_summary: {\n    total_value: number\n    total_invested: number\n    total_return_pct: number\n    avg_roi: number\n    avg_cagr: number\n  }\n  risk_analysis: {\n    concentration: Record<string, number>\n    distribution: Record<string, number>\n  }\n  recommendations: string[]\n  warnings: string[]\n  opportunities: string[]\n}\n\nexport interface ScenarioResult {\n  scenario: string\n  impact_pct: number\n  portfolio_impact: number\n  total_current: number\n  total_projected: number\n  projections: Array<{\n    investment_id: string\n    name: string\n    category: string\n    current_value: number\n    projected_value: number\n    value_change: number\n    current_roi: number\n    projected_roi: number\n  }>\n}\n\n// Analytics API\nexport const analyticsApi = {\n  getInvestmentMetrics: (id: string) => \n    api.get<{ success: boolean; data: InvestmentMetrics }>(`/analytics/investments/${id}/metrics`).then(r => r.data),\n  \n  getBatchMetrics: (ids: string[]) =>\n    api.post<{ success: boolean; count: number; data: InvestmentMetrics[] }>('/analytics/investments/batch-metrics', ids).then(r => r.data),\n  \n  getPortfolioSummary: (params?: { category?: string; status?: string }) =>\n    api.get<{ success: boolean; data: PortfolioSummary }>('/analytics/portfolio/summary', { params }).then(r => r.data),\n  \n  getPortfolioOptimization: () =>\n    api.get<{ success: boolean; data: any; error?: string }>('/analytics/portfolio/optimization').then(r => r.data),\n  \n  compareInvestments: (ids: string[], riskProfile: string = 'balanced', includeScenarios: boolean = true) =>\n    api.post<{ success: boolean; data: ComparisonResult }>('/analytics/compare', ids, { \n      params: { risk_profile: riskProfile, include_scenarios: includeScenarios } \n    }).then(r => r.data),\n  \n  compareAll: (params?: { category?: string; limit?: number }) =>\n    api.get<{ success: boolean; data: ComparisonResult }>('/analytics/compare/all', { params }).then(r => r.data),\n  \n  runScenarioAnalysis: (ids: string[], scenarioType: string = 'market_crash', customImpact?: number) =>\n    api.post<{ success: boolean; data: ScenarioResult }>('/analytics/scenario-analysis', ids, {\n      params: { scenario_type: scenarioType, custom_impact: customImpact }\n    }).then(r => r.data),\n  \n  getBenchmarks: () =>\n    api.get<{ success: boolean; data: { rates: Record<string, string>; values: Record<string, number>; description: Record<string, string> } }>('/analytics/benchmarks').then(r => r.data),\n}\n\n// Chat API\nexport const chatApi = {\n  sendMessage: (data: ChatRequest) => \n    api.post<ChatResponse>('/chat', data).then(r => r.data),\n  \n  sendMessageStream: async (data: Omit<ChatRequest, 'stream'>): Promise<ReadableStreamDefaultReader<string>> => {\n    const response = await fetch(`${API_URL}/api/v1/chat/stream`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({ ...data, stream: true }),\n    })\n    \n    if (!response.ok) {\n      throw new Error('Failed to send message')\n    }\n    \n    // Create a reader that yields strings\n    const reader = response.body?.getReader()\n    const decoder = new TextDecoder()\n    \n    if (!reader) {\n      throw new Error('No response body')\n    }\n    \n    // Return a custom async iterator\n    return {\n      async read(): Promise<{ done: boolean; value: string }> {\n        const result = await reader.read()\n        if (result.done) {\n          return { done: true, value: '' }\n        }\n        return { done: false, value: decoder.decode(result.value, { stream: true }) }\n      },\n      releaseLock: () => reader.releaseLock(),\n      cancel: (reason?: any) => reader.cancel(reason),\n      closed: reader.closed,\n    } as ReadableStreamDefaultReader<string>\n  },\n  \n  getInvestmentsForContext: () => \n    api.get<Array<{\n      id: string\n      name: string\n      category: string\n      city?: string\n      status?: string\n    }>>('/chat/context/investments').then(r => r.data),\n  \n  getFilesForContext: (investment_id?: string) => \n    api.get<Array<{\n      id: string\n      filename: string\n      mime_type?: string\n      size_bytes?: number\n      status?: string\n      investment_id?: string\n    }>>('/chat/context/files', { params: investment_id ? { investment_id } : undefined }).then(r => r.data),\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/hinoki/HinokiDEV/Investments/prism/web/src/lib/landCredit.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/hinoki/HinokiDEV/Investments/prism/web/src/lib/utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/hinoki/HinokiDEV/Investments/prism/web/src/main.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/hinoki/HinokiDEV/Investments/prism/web/src/pages/Analysis.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":141,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":141,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4698,4701],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4698,4701],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":143,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":143,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4785,4788],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4785,4788],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":143,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":143,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4814,4817],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4814,4817],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":203,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":203,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7804,7807],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7804,7807],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":205,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":205,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7893,7896],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7893,7896],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":205,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":205,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7913,7916],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7913,7916],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useQuery } from '@tanstack/react-query'\nimport { \n  Brain, \n  Clock, \n  CheckCircle,\n  XCircle,\n  Loader2,\n  AlertCircle,\n  Cpu,\n  Sparkles,\n  Activity\n} from 'lucide-react'\nimport { analysisApi } from '../lib/api'\nimport { formatDate } from '../lib/utils'\nimport StatCard from '../components/StatCard'\n\nconst jobStatusConfig: Record<string, { icon: React.ReactNode; className: string }> = {\n  queued: { \n    icon: <Clock className=\"h-4 w-4\" />, \n    className: 'bg-warning-dim text-warning border-warning/20' \n  },\n  running: { \n    icon: <Loader2 className=\"h-4 w-4 animate-spin\" />, \n    className: 'bg-info-dim text-info border-info/20' \n  },\n  completed: { \n    icon: <CheckCircle className=\"h-4 w-4\" />, \n    className: 'bg-success-dim text-success border-success/20' \n  },\n  failed: { \n    icon: <XCircle className=\"h-4 w-4\" />, \n    className: 'bg-error-dim text-error border-error/20' \n  },\n}\n\nexport default function Analysis() {\n  const { data: jobs, isLoading: jobsLoading } = useQuery({\n    queryKey: ['analysis-jobs'],\n    queryFn: analysisApi.listJobs,\n  })\n\n  const { data: results, isLoading: resultsLoading } = useQuery({\n    queryKey: ['analysis-results'],\n    queryFn: analysisApi.listResults,\n  })\n\n  const { data: queueStats } = useQuery({\n    queryKey: ['queue-stats'],\n    queryFn: analysisApi.getQueueStats,\n  })\n\n  const totalJobs = queueStats?.total || 0\n  const queuedJobs = queueStats?.by_status?.queued || 0\n  const runningJobs = queueStats?.by_status?.running || 0\n  const completedJobs = queueStats?.by_status?.completed || 0\n\n  return (\n    <div className=\"space-y-8 fade-in\">\n      {/* Header */}\n      <div className=\"flex flex-col sm:flex-row sm:items-end sm:justify-between gap-4\">\n        <div>\n          <div className=\"flex items-center gap-2 mb-2\">\n            <Sparkles className=\"h-4 w-4 text-cream-muted\" />\n            <span className=\"text-xs font-semibold tracking-widest text-cream-muted uppercase\">Prism</span>\n          </div>\n          <h1 className=\"text-3xl font-bold text-text-primary tracking-tight\">Análisis</h1>\n          <p className=\"text-text-secondary mt-1\">\n            Análisis automático de documentos del portafolio\n          </p>\n        </div>\n        \n        <div className=\"flex items-center gap-2 text-xs text-text-muted\">\n          <Cpu className=\"h-4 w-4 text-cream\" />\n          <span className=\"text-cream\">Prism</span>\n        </div>\n      </div>\n\n      {/* Queue Stats */}\n      {queueStats && (\n        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 stagger-children\">\n          <StatCard\n            title=\"Total Jobs\"\n            value={totalJobs}\n            description=\"Análisis históricos\"\n            icon={Brain}\n            variant=\"default\"\n            delay={0}\n          />\n          <StatCard\n            title=\"En Cola\"\n            value={queuedJobs}\n            description=\"Esperando procesamiento\"\n            icon={Clock}\n            variant={queuedJobs > 0 ? 'accent' : 'default'}\n            delay={50}\n          />\n          <StatCard\n            title=\"Procesando\"\n            value={runningJobs}\n            description=\"En proceso actualmente\"\n            icon={Activity}\n            variant={runningJobs > 0 ? 'accent' : 'default'}\n            delay={100}\n          />\n          <StatCard\n            title=\"Completados\"\n            value={completedJobs}\n            description=\"Analizados exitosamente\"\n            icon={CheckCircle}\n            variant=\"default\"\n            delay={150}\n          />\n        </div>\n      )}\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        {/* Processing Jobs */}\n        <section className=\"glass-card-elevated\">\n          <div className=\"flex items-center justify-between p-5 border-b border-border\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-2 rounded-lg bg-surface-elevated\">\n                <Activity className=\"h-4 w-4 text-cream-muted\" />\n              </div>\n              <span className=\"text-sm font-semibold text-text-primary\">Cola de Procesamiento</span>\n            </div>\n            {runningJobs > 0 && (\n              <span className=\"flex items-center gap-1.5 text-xs text-info\">\n                <span className=\"w-1.5 h-1.5 rounded-full bg-info animate-pulse\" />\n                Procesando\n              </span>\n            )}\n          </div>\n          \n          <div className=\"p-2\">\n            {jobsLoading ? (\n              <div className=\"space-y-2\">\n                {[...Array(3)].map((_, i) => (\n                  <div key={i} className=\"h-16 bg-surface rounded-xl animate-pulse\" />\n                ))}\n              </div>\n            ) : (jobs as any[])?.length ? (\n              <div className=\"space-y-2\">\n                {(jobs as any[]).slice(0, 8).map((job: any, index: number) => {\n                  const config = jobStatusConfig[job.status] || jobStatusConfig.queued\n                  return (\n                    <div \n                      key={job.id}\n                      className=\"flex items-center gap-3 p-3 rounded-xl bg-surface border border-border-subtle hover:border-border transition-colors\"\n                      style={{ animationDelay: `${index * 50}ms` }}\n                    >\n                      <div className={`p-2 rounded-lg ${config.className}`}>\n                        {config.icon}\n                      </div>\n                      <div className=\"flex-1 min-w-0\">\n                        <p className=\"text-sm font-medium text-text-primary truncate\">\n                          {job.filename || 'Unknown file'}\n                        </p>\n                        <p className=\"text-xs text-text-muted\">\n                          {job.job_type} • Reintento {job.retry_count} • {formatDate(job.created_at)}\n                        </p>\n                      </div>\n                      {job.error_message && (\n                        <div className=\"group relative\">\n                          <AlertCircle className=\"h-4 w-4 text-error flex-shrink-0 cursor-help\" />\n                          <div className=\"absolute right-0 top-full mt-2 w-64 p-3 bg-surface-elevated text-text-primary text-xs rounded-xl border border-border shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all z-10\">\n                            {job.error_message}\n                          </div>\n                        </div>\n                      )}\n                    </div>\n                  )\n                })}\n              </div>\n            ) : (\n              <div className=\"p-8 text-center\">\n                <div className=\"w-12 h-12 mx-auto mb-3 rounded-full bg-surface flex items-center justify-center\">\n                  <CheckCircle className=\"h-5 w-5 text-success\" />\n                </div>\n                <p className=\"text-sm text-text-muted\">No hay jobs en cola</p>\n              </div>\n            )}\n          </div>\n        </section>\n\n        {/* Analysis Results */}\n        <section className=\"glass-card-elevated\">\n          <div className=\"flex items-center justify-between p-5 border-b border-border\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-2 rounded-lg bg-surface-elevated\">\n                <Sparkles className=\"h-4 w-4 text-cream-muted\" />\n              </div>\n              <span className=\"text-sm font-semibold text-text-primary\">Resultados Recientes</span>\n            </div>\n          </div>\n          \n          <div className=\"p-2\">\n            {resultsLoading ? (\n              <div className=\"space-y-2\">\n                {[...Array(3)].map((_, i) => (\n                  <div key={i} className=\"h-24 bg-surface rounded-xl animate-pulse\" />\n                ))}\n              </div>\n            ) : results && (results as any[]).length ? (\n              <div className=\"space-y-3\">\n                {(results as any[]).map((result: any, index: number) => (\n                  <div \n                    key={result.id} \n                    className=\"p-4 rounded-xl bg-surface border border-border-subtle hover:border-border transition-colors\"\n                    style={{ animationDelay: `${index * 50}ms` }}\n                  >\n                    <div className=\"flex items-start justify-between gap-4\">\n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"flex items-center gap-2 mb-2\">\n                          <span className=\"text-xs font-medium text-cream capitalize\">\n                            {result.analysis_type}\n                          </span>\n                          <span className=\"text-border-strong\">•</span>\n                          <span className=\"text-xs text-text-muted\">\n                            {formatDate(result.created_at)}\n                          </span>\n                        </div>\n                        {result.summary && (\n                          <p className=\"text-sm text-text-secondary line-clamp-2\">\n                            {result.summary}\n                          </p>\n                        )}\n                        {result.raw_text && !result.summary && (\n                          <p className=\"text-sm text-text-secondary line-clamp-2\">\n                            {result.raw_text.substring(0, 150)}...\n                          </p>\n                        )}\n                      </div>\n                      {result.confidence_score !== undefined && (\n                        <div className=\"flex-shrink-0 text-right\">\n                          <div className={`text-sm font-mono font-semibold ${\n                            result.confidence_score >= 0.8 ? 'text-success' :\n                            result.confidence_score >= 0.5 ? 'text-warning' :\n                            'text-error'\n                          }`}>\n                            {Math.round(result.confidence_score * 100)}%\n                          </div>\n                          <div className=\"text-[10px] text-text-muted uppercase tracking-wider\">confianza</div>\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                ))}\n              </div>\n            ) : (\n              <div className=\"p-8 text-center\">\n                <div className=\"w-12 h-12 mx-auto mb-3 rounded-full bg-surface flex items-center justify-center\">\n                  <Brain className=\"h-5 w-5 text-text-muted\" />\n                </div>\n                <p className=\"text-sm text-text-muted\">\n                  Aún no hay resultados de análisis\n                </p>\n                <p className=\"text-xs text-text-muted mt-1\">\n                  Sube documentos y se analizarán automáticamente\n                </p>\n              </div>\n            )}\n          </div>\n        </section>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/hinoki/HinokiDEV/Investments/prism/web/src/pages/Analytics.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":426,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":426,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17080,17083],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17080,17083],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/*\n===============================================================================\nANALYTICS PAGE - Financial Math Dashboard\n===============================================================================\nComprehensive investment analysis with ROI, CAGR, IRR, NPV, and portfolio\noptimization using Modern Portfolio Theory.\n*/\nimport { useState } from 'react'\nimport { useQuery } from '@tanstack/react-query'\nimport { \n  TrendingUp, \n  TrendingDown, \n  BarChart3, \n  PieChart, \n  Activity,\n  AlertTriangle,\n  Target,\n  Zap,\n  Award,\n  Percent,\n  Calendar,\n  DollarSign,\n  Shield,\n  BrainCircuit\n} from 'lucide-react'\nimport { analyticsApi, type InvestmentMetrics, type ComparisonResult } from '../lib/api'\n\n// =============================================================================\n// TYPES\n// =============================================================================\n\ninterface MetricCardProps {\n  title: string\n  value: string | number\n  subtitle?: string\n  trend?: 'up' | 'down' | 'neutral'\n  icon: React.ReactNode\n  highlight?: boolean\n}\n\ninterface SectionProps {\n  title: string\n  icon: React.ReactNode\n  children: React.ReactNode\n}\n\n// =============================================================================\n// UTILITY COMPONENTS\n// =============================================================================\n\nfunction MetricCard({ title, value, subtitle, trend, icon, highlight }: MetricCardProps) {\n  const trendColor = trend === 'up' ? 'text-success' : trend === 'down' ? 'text-error' : 'text-text-secondary'\n  \n  return (\n    <div className={`p-4 rounded-lg border ${highlight ? 'border-cream/30 bg-cream/5' : 'border-border bg-surface'} transition-all hover:border-cream/20`}>\n      <div className=\"flex items-start justify-between\">\n        <div className=\"p-2 rounded-md bg-void-deep text-cream\">{icon}</div>\n        {trend && (\n          <span className={trendColor}>\n            {trend === 'up' ? <TrendingUp className=\"w-4 h-4\" /> : trend === 'down' ? <TrendingDown className=\"w-4 h-4\" /> : null}\n          </span>\n        )}\n      </div>\n      <div className=\"mt-3\">\n        <p className=\"text-xs text-text-muted uppercase tracking-wider\">{title}</p>\n        <p className=\"text-xl font-display font-semibold text-text-primary mt-1\">{value}</p>\n        {subtitle && <p className=\"text-xs text-text-secondary mt-1\">{subtitle}</p>}\n      </div>\n    </div>\n  )\n}\n\nfunction Section({ title, icon, children }: SectionProps) {\n  return (\n    <section className=\"mb-8\">\n      <div className=\"flex items-center gap-2 mb-4\">\n        <div className=\"text-cream\">{icon}</div>\n        <h2 className=\"text-lg font-display font-semibold text-text-primary\">{title}</h2>\n      </div>\n      {children}\n    </section>\n  )\n}\n\nfunction LoadingState() {\n  return (\n    <div className=\"min-h-[60vh] flex flex-col items-center justify-center\">\n      <div className=\"relative\">\n        <div className=\"w-12 h-12 border-2 border-border rounded-full\" />\n        <div className=\"absolute inset-0 w-12 h-12 border-2 border-cream border-t-transparent rounded-full animate-spin\" />\n      </div>\n      <p className=\"mt-4 text-sm text-text-secondary\">Calculating metrics...</p>\n    </div>\n  )\n}\n\nfunction ErrorState({ message }: { message: string }) {\n  return (\n    <div className=\"min-h-[60vh] flex flex-col items-center justify-center text-center p-8\">\n      <AlertTriangle className=\"w-12 h-12 text-error mb-4\" />\n      <h2 className=\"text-lg font-display font-semibold text-text-primary mb-2\">Analysis Error</h2>\n      <p className=\"text-sm text-text-secondary max-w-md\">{message}</p>\n    </div>\n  )\n}\n\n// =============================================================================\n// METRIC DISPLAY COMPONENTS\n// =============================================================================\n\nfunction BasicMetrics({ metrics }: { metrics: InvestmentMetrics['basic'] }) {\n  return (\n    <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n      <MetricCard\n        title=\"Total Invested\"\n        value={`R$ ${metrics.total_invested.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`}\n        icon={<DollarSign className=\"w-4 h-4\" />}\n      />\n      <MetricCard\n        title=\"Current Value\"\n        value={`R$ ${metrics.current_value.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`}\n        icon={<DollarSign className=\"w-4 h-4\" />}\n        highlight\n      />\n      <MetricCard\n        title=\"Absolute Return\"\n        value={`R$ ${metrics.absolute_return.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`}\n        subtitle={metrics.absolute_return >= 0 ? 'Profit' : 'Loss'}\n        trend={metrics.absolute_return >= 0 ? 'up' : 'down'}\n        icon={<Activity className=\"w-4 h-4\" />}\n        highlight={metrics.absolute_return >= 0}\n      />\n      <MetricCard\n        title=\"Simple ROI\"\n        value={`${metrics.simple_roi.toFixed(2)}%`}\n        trend={metrics.simple_roi >= 0 ? 'up' : 'down'}\n        icon={<Percent className=\"w-4 h-4\" />}\n        highlight={metrics.simple_roi >= 0}\n      />\n    </div>\n  )\n}\n\nfunction TimeWeightedMetrics({ metrics }: { metrics: InvestmentMetrics['time_weighted'] }) {\n  return (\n    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n      <MetricCard\n        title=\"CAGR\"\n        value={metrics.cagr !== null ? `${metrics.cagr.toFixed(2)}%` : 'N/A'}\n        subtitle=\"Compound Annual Growth Rate\"\n        icon={<TrendingUp className=\"w-4 h-4\" />}\n        trend={metrics.cagr && metrics.cagr >= 0 ? 'up' : 'down'}\n      />\n      <MetricCard\n        title=\"Annualized ROI\"\n        value={metrics.annualized_roi !== null ? `${metrics.annualized_roi.toFixed(2)}%` : 'N/A'}\n        subtitle=\"Return per year\"\n        icon={<Calendar className=\"w-4 h-4\" />}\n        trend={metrics.annualized_roi && metrics.annualized_roi >= 0 ? 'up' : 'down'}\n      />\n      <MetricCard\n        title=\"Holding Period\"\n        value={`${metrics.years_held.toFixed(1)} years`}\n        subtitle=\"Time since purchase\"\n        icon={<Calendar className=\"w-4 h-4\" />}\n      />\n    </div>\n  )\n}\n\nfunction AdvancedMetrics({ metrics }: { metrics: InvestmentMetrics['advanced'] }) {\n  return (\n    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n      <MetricCard\n        title=\"IRR\"\n        value={metrics.irr !== null ? `${metrics.irr.toFixed(2)}%` : 'N/A'}\n        subtitle=\"Internal Rate of Return\"\n        icon={<BrainCircuit className=\"w-4 h-4\" />}\n      />\n      <MetricCard\n        title=\"NPV\"\n        value={metrics.npv !== null ? `R$ ${metrics.npv.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}` : 'N/A'}\n        subtitle=\"Net Present Value\"\n        icon={<DollarSign className=\"w-4 h-4\" />}\n      />\n      <MetricCard\n        title=\"Payback Period\"\n        value={metrics.payback_period_months !== null ? `${metrics.payback_period_months.toFixed(1)} months` : 'N/A'}\n        subtitle=\"Time to recover investment\"\n        icon={<Target className=\"w-4 h-4\" />}\n      />\n    </div>\n  )\n}\n\nfunction RiskMetrics({ metrics }: { metrics: InvestmentMetrics['risk'] }) {\n  return (\n    <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n      <MetricCard\n        title=\"Sharpe Ratio\"\n        value={metrics.sharpe_ratio !== null ? metrics.sharpe_ratio.toFixed(2) : 'N/A'}\n        subtitle=\"Risk-adjusted return\"\n        icon={<Award className=\"w-4 h-4\" />}\n        highlight={metrics.sharpe_ratio !== null && metrics.sharpe_ratio > 1}\n      />\n      <MetricCard\n        title=\"Volatility\"\n        value={metrics.volatility !== null ? `${metrics.volatility.toFixed(2)}%` : 'N/A'}\n        subtitle=\"Annualized std deviation\"\n        icon={<Activity className=\"w-4 h-4\" />}\n      />\n      <MetricCard\n        title=\"Max Drawdown\"\n        value={metrics.max_drawdown !== null ? `${metrics.max_drawdown.toFixed(2)}%` : 'N/A'}\n        subtitle=\"Largest peak-to-trough decline\"\n        icon={<TrendingDown className=\"w-4 h-4\" />}\n      />\n      <MetricCard\n        title=\"VaR 95%\"\n        value={metrics.var_95 !== null ? `${metrics.var_95.toFixed(2)}%` : 'N/A'}\n        subtitle=\"Value at Risk\"\n        icon={<Shield className=\"w-4 h-4\" />}\n      />\n    </div>\n  )\n}\n\nfunction ComparativeMetrics({ metrics }: { metrics: InvestmentMetrics['comparative'] }) {\n  return (\n    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n      <div className={`p-4 rounded-lg border ${metrics.vs_inflation !== null && metrics.vs_inflation > 0 ? 'border-success/30 bg-success/5' : 'border-border bg-surface'}`}>\n        <p className=\"text-xs text-text-muted uppercase tracking-wider\">vs Inflation</p>\n        <p className={`text-xl font-display font-semibold mt-1 ${metrics.vs_inflation !== null && metrics.vs_inflation > 0 ? 'text-success' : 'text-text-primary'}`}>\n          {metrics.vs_inflation !== null ? `${metrics.vs_inflation.toFixed(2)}%` : 'N/A'}\n        </p>\n        <p className=\"text-xs text-text-secondary mt-1\">Real return after inflation</p>\n      </div>\n      \n      <div className={`p-4 rounded-lg border ${metrics.vs_cdi !== null && metrics.vs_cdi > 0 ? 'border-success/30 bg-success/5' : 'border-border bg-surface'}`}>\n        <p className=\"text-xs text-text-muted uppercase tracking-wider\">vs CDI</p>\n        <p className={`text-xl font-display font-semibold mt-1 ${metrics.vs_cdi !== null && metrics.vs_cdi > 0 ? 'text-success' : 'text-text-primary'}`}>\n          {metrics.vs_cdi !== null ? `${metrics.vs_cdi.toFixed(2)}%` : 'N/A'}\n        </p>\n        <p className=\"text-xs text-text-secondary mt-1\">vs Brazil risk-free rate</p>\n      </div>\n      \n      <div className={`p-4 rounded-lg border ${metrics.vs_sp500 !== null && metrics.vs_sp500 > 0 ? 'border-success/30 bg-success/5' : 'border-border bg-surface'}`}>\n        <p className=\"text-xs text-text-muted uppercase tracking-wider\">vs S&P 500</p>\n        <p className={`text-xl font-display font-semibold mt-1 ${metrics.vs_sp500 !== null && metrics.vs_sp500 > 0 ? 'text-success' : 'text-text-primary'}`}>\n          {metrics.vs_sp500 !== null ? `${metrics.vs_sp500.toFixed(2)}%` : 'N/A'}\n        </p>\n        <p className=\"text-xs text-text-secondary mt-1\">vs US stock market</p>\n      </div>\n    </div>\n  )\n}\n\n// =============================================================================\n// RECOMMENDATIONS COMPONENT\n// =============================================================================\n\nfunction Recommendations({ comparison }: { comparison: ComparisonResult }) {\n  return (\n    <div className=\"space-y-4\">\n      {/* Winner */}\n      {comparison.winner && (\n        <div className=\"p-4 rounded-lg border border-success/30 bg-success/5\">\n          <div className=\"flex items-center gap-2 mb-2\">\n            <Award className=\"w-5 h-5 text-success\" />\n            <span className=\"font-display font-semibold text-success\">Top Performer</span>\n          </div>\n          <p className=\"text-text-primary\">{comparison.winner.name}</p>\n          <p className=\"text-sm text-text-secondary\">Composite Score: {comparison.winner.score.toFixed(1)}</p>\n        </div>\n      )}\n      \n      {/* Recommendations */}\n      {comparison.recommendations.length > 0 && (\n        <div className=\"space-y-2\">\n          <h3 className=\"text-sm font-medium text-text-secondary\">Recommendations</h3>\n          {comparison.recommendations.map((rec, i) => (\n            <div key={i} className=\"flex items-start gap-2 text-sm text-text-primary\">\n              <span className=\"text-success mt-0.5\">✓</span>\n              <span>{rec}</span>\n            </div>\n          ))}\n        </div>\n      )}\n      \n      {/* Warnings */}\n      {comparison.warnings.length > 0 && (\n        <div className=\"space-y-2\">\n          <h3 className=\"text-sm font-medium text-text-secondary\">Warnings</h3>\n          {comparison.warnings.map((warning, i) => (\n            <div key={i} className=\"flex items-start gap-2 text-sm text-warning\">\n              <AlertTriangle className=\"w-4 h-4 mt-0.5 flex-shrink-0\" />\n              <span>{warning}</span>\n            </div>\n          ))}\n        </div>\n      )}\n      \n      {/* Opportunities */}\n      {comparison.opportunities.length > 0 && (\n        <div className=\"space-y-2\">\n          <h3 className=\"text-sm font-medium text-text-secondary\">Opportunities</h3>\n          {comparison.opportunities.map((opp, i) => (\n            <div key={i} className=\"flex items-start gap-2 text-sm text-info\">\n              <Zap className=\"w-4 h-4 mt-0.5 flex-shrink-0\" />\n              <span>{opp}</span>\n            </div>\n          ))}\n        </div>\n      )}\n    </div>\n  )\n}\n\n// =============================================================================\n// MAIN ANALYTICS PAGE\n// =============================================================================\n\nexport default function Analytics() {\n  const [selectedInvestment, setSelectedInvestment] = useState<string | null>(null)\n  const [riskProfile, setRiskProfile] = useState<'conservative' | 'balanced' | 'aggressive'>('balanced')\n  \n  // Fetch portfolio summary\n  const { data: portfolioData, isLoading: portfolioLoading, error: portfolioError } = useQuery({\n    queryKey: ['portfolio-summary'],\n    queryFn: () => analyticsApi.getPortfolioSummary(),\n  })\n  \n  // Fetch comparison data\n  const { data: comparisonData, isLoading: comparisonLoading } = useQuery({\n    queryKey: ['comparison-all', riskProfile],\n    queryFn: () => analyticsApi.compareAll({ limit: 20 }),\n  })\n  \n  // Fetch individual metrics if selected\n  const { data: metricsData } = useQuery({\n    queryKey: ['investment-metrics', selectedInvestment],\n    queryFn: () => selectedInvestment ? analyticsApi.getInvestmentMetrics(selectedInvestment) : null,\n    enabled: !!selectedInvestment,\n  })\n  \n  // Fetch benchmarks\n  const { data: benchmarksData } = useQuery({\n    queryKey: ['benchmarks'],\n    queryFn: () => analyticsApi.getBenchmarks(),\n  })\n  \n  const isLoading = portfolioLoading || comparisonLoading\n  \n  if (isLoading) return <LoadingState />\n  if (portfolioError) return <ErrorState message=\"Failed to load analytics data\" />\n  \n  const portfolio = portfolioData?.data\n  const comparison = comparisonData?.data\n  const metrics = metricsData?.data\n  const benchmarks = benchmarksData?.data\n  \n  return (\n    <div className=\"max-w-7xl mx-auto p-4 sm:p-6 lg:p-8\">\n      {/* Header */}\n      <div className=\"mb-8\">\n        <h1 className=\"text-2xl font-display font-bold text-text-primary flex items-center gap-3\">\n          <BarChart3 className=\"w-7 h-7 text-cream\" />\n          Analytics\n        </h1>\n        <p className=\"text-text-secondary mt-2\">\n          Comprehensive financial analysis and portfolio optimization\n        </p>\n      </div>\n      \n      {/* Portfolio Summary */}\n      {portfolio && (\n        <Section title=\"Portfolio Summary\" icon={<PieChart className=\"w-5 h-5\" />}>\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6\">\n            <MetricCard\n              title=\"Total Value\"\n              value={`R$ ${portfolio.summary.total_value.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`}\n              icon={<DollarSign className=\"w-4 h-4\" />}\n              highlight\n            />\n            <MetricCard\n              title=\"Total Invested\"\n              value={`R$ ${portfolio.summary.total_invested.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`}\n              icon={<DollarSign className=\"w-4 h-4\" />}\n            />\n            <MetricCard\n              title=\"Total Return\"\n              value={`${portfolio.summary.total_roi.toFixed(2)}%`}\n              trend={portfolio.summary.total_roi >= 0 ? 'up' : 'down'}\n              icon={<Percent className=\"w-4 h-4\" />}\n              highlight={portfolio.summary.total_roi >= 0}\n            />\n            <MetricCard\n              title=\"Weighted CAGR\"\n              value={portfolio.summary.weighted_cagr !== null ? `${portfolio.summary.weighted_cagr.toFixed(2)}%` : 'N/A'}\n              icon={<TrendingUp className=\"w-4 h-4\" />}\n            />\n          </div>\n          \n          {/* Category Allocation */}\n          <div className=\"p-4 rounded-lg border border-border bg-surface\">\n            <h3 className=\"text-sm font-medium text-text-secondary mb-3\">Category Allocation</h3>\n            <div className=\"flex flex-wrap gap-2\">\n              {Object.entries(portfolio.allocation).map(([category, percentage]) => (\n                <div key={category} className=\"px-3 py-1.5 rounded-full bg-void-deep border border-border\">\n                  <span className=\"text-sm text-text-primary capitalize\">{category}</span>\n                  <span className=\"text-sm text-cream ml-2\">{percentage.toFixed(1)}%</span>\n                </div>\n              ))}\n            </div>\n          </div>\n        </Section>\n      )}\n      \n      {/* Investment Comparison */}\n      {comparison && (\n        <Section title=\"Investment Rankings\" icon={<Award className=\"w-5 h-5\" />}>\n          <div className=\"mb-4\">\n            <label className=\"text-sm text-text-secondary mr-3\">Risk Profile:</label>\n            <select\n              value={riskProfile}\n              onChange={(e) => setRiskProfile(e.target.value as any)}\n              className=\"px-3 py-1.5 rounded-md bg-void-deep border border-border text-text-primary text-sm focus:border-cream focus:outline-none\"\n            >\n              <option value=\"conservative\">Conservative</option>\n              <option value=\"balanced\">Balanced</option>\n              <option value=\"aggressive\">Aggressive</option>\n            </select>\n          </div>\n          \n          {/* Rankings Table */}\n          <div className=\"overflow-x-auto rounded-lg border border-border\">\n            <table className=\"w-full text-sm\">\n              <thead className=\"bg-void-deep\">\n                <tr>\n                  <th className=\"px-4 py-3 text-left text-text-secondary font-medium\">Rank</th>\n                  <th className=\"px-4 py-3 text-left text-text-secondary font-medium\">Investment</th>\n                  <th className=\"px-4 py-3 text-left text-text-secondary font-medium\">Category</th>\n                  <th className=\"px-4 py-3 text-right text-text-secondary font-medium\">ROI</th>\n                  <th className=\"px-4 py-3 text-right text-text-secondary font-medium\">CAGR</th>\n                  <th className=\"px-4 py-3 text-right text-text-secondary font-medium\">Score</th>\n                </tr>\n              </thead>\n              <tbody className=\"divide-y divide-border\">\n                {comparison.rankings.map((inv) => (\n                  <tr \n                    key={inv.investment_id}\n                    className=\"hover:bg-surface/50 cursor-pointer transition-colors\"\n                    onClick={() => setSelectedInvestment(inv.investment_id)}\n                  >\n                    <td className=\"px-4 py-3\">\n                      <span className={`inline-flex items-center justify-center w-6 h-6 rounded-full text-xs font-medium ${\n                        inv.rankings.composite === 1 ? 'bg-success/20 text-success' :\n                        inv.rankings.composite === 2 ? 'bg-cream/20 text-cream' :\n                        inv.rankings.composite === 3 ? 'bg-warning/20 text-warning' :\n                        'bg-void-deep text-text-secondary'\n                      }`}>\n                        {inv.rankings.composite}\n                      </span>\n                    </td>\n                    <td className=\"px-4 py-3 text-text-primary font-medium\">{inv.name}</td>\n                    <td className=\"px-4 py-3 text-text-secondary capitalize\">{inv.category}</td>\n                    <td className=\"px-4 py-3 text-right\">\n                      <span className={(inv.metrics.simple_roi ?? 0) >= 0 ? 'text-success' : 'text-error'}>\n                        {inv.metrics.simple_roi?.toFixed(2)}%\n                      </span>\n                    </td>\n                    <td className=\"px-4 py-3 text-right\">\n                      <span className={inv.metrics.cagr && inv.metrics.cagr >= 0 ? 'text-success' : 'text-error'}>\n                        {inv.metrics.cagr?.toFixed(2) ?? 'N/A'}%\n                      </span>\n                    </td>\n                    <td className=\"px-4 py-3 text-right\">\n                      <span className=\"text-cream font-medium\">{inv.scores.composite.toFixed(1)}</span>\n                    </td>\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n          </div>\n          \n          {/* Recommendations */}\n          <div className=\"mt-6\">\n            <Recommendations comparison={comparison} />\n          </div>\n        </Section>\n      )}\n      \n      {/* Individual Investment Detail */}\n      {selectedInvestment && metrics && (\n        <div className=\"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\n          <div className=\"bg-surface border border-border rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto\">\n            <div className=\"sticky top-0 bg-surface border-b border-border p-4 flex items-center justify-between\">\n              <div>\n                <h2 className=\"text-lg font-display font-semibold text-text-primary\">{metrics.name}</h2>\n                <p className=\"text-sm text-text-secondary capitalize\">{metrics.category}</p>\n              </div>\n              <button\n                onClick={() => setSelectedInvestment(null)}\n                className=\"p-2 rounded-lg hover:bg-void-deep text-text-secondary hover:text-text-primary transition-colors\"\n              >\n                ✕\n              </button>\n            </div>\n            \n            <div className=\"p-6 space-y-8\">\n              <Section title=\"Basic Metrics\" icon={<DollarSign className=\"w-5 h-5\" />}>\n                <BasicMetrics metrics={metrics.basic} />\n              </Section>\n              \n              <Section title=\"Time-Weighted Returns\" icon={<Calendar className=\"w-5 h-5\" />}>\n                <TimeWeightedMetrics metrics={metrics.time_weighted} />\n              </Section>\n              \n              <Section title=\"Advanced Metrics\" icon={<BrainCircuit className=\"w-5 h-5\" />}>\n                <AdvancedMetrics metrics={metrics.advanced} />\n              </Section>\n              \n              <Section title=\"Risk Analysis\" icon={<Shield className=\"w-5 h-5\" />}>\n                <RiskMetrics metrics={metrics.risk} />\n              </Section>\n              \n              <Section title=\"Benchmark Comparison\" icon={<BarChart3 className=\"w-5 h-5\" />}>\n                <ComparativeMetrics metrics={metrics.comparative} />\n              </Section>\n            </div>\n          </div>\n        </div>\n      )}\n      \n      {/* Benchmark Rates */}\n      {benchmarks && (\n        <Section title=\"Benchmark Rates\" icon={<Target className=\"w-5 h-5\" />}>\n          <div className=\"grid grid-cols-2 md:grid-cols-5 gap-4\">\n            {Object.entries(benchmarks.values).map(([key, value]) => (\n              <div key={key} className=\"p-3 rounded-lg border border-border bg-surface\">\n                <p className=\"text-xs text-text-muted uppercase tracking-wider\">{key.replace('_', ' ')}</p>\n                <p className=\"text-lg font-display font-semibold text-text-primary\">{value.toFixed(2)}%</p>\n                <p className=\"text-xs text-text-secondary\">{benchmarks.description[key]}</p>\n              </div>\n            ))}\n          </div>\n        </Section>\n      )}\n    </div>\n  )\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/hinoki/HinokiDEV/Investments/prism/web/src/pages/Chat.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":34,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[569,572],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[569,572],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_investments' is assigned a value but never used.","line":84,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":84,"endColumn":29},{"ruleId":"no-constant-condition","severity":2,"message":"Unexpected constant condition.","line":230,"column":14,"nodeType":"Literal","messageId":"unexpected","endLine":230,"endColumn":18}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useRef, useEffect, useCallback } from 'react'\nimport { useQuery } from '@tanstack/react-query'\nimport { \n  Send,\n  Bot,\n  User,\n  X,\n  FileText,\n  Trees,\n  Loader2,\n  Trash2,\n  Copy,\n  Check,\n  Upload,\n  Key,\n  Cpu\n} from 'lucide-react'\nimport { chatApi, uploadsApi } from '../lib/api'\n\n// Types\ninterface Message {\n  id: string\n  role: 'user' | 'assistant' | 'system'\n  content: string\n  timestamp: Date\n  attachments?: Attachment[]\n  isStreaming?: boolean\n}\n\ninterface Attachment {\n  id: string\n  type: 'investment' | 'file'\n  name: string\n  data: any\n}\n\ninterface InvestmentOption {\n  id: string\n  name: string\n  category: string\n  city?: string\n}\n\ninterface FileOption {\n  id: string\n  filename: string\n  mime_type?: string\n  size_bytes?: number\n}\n\nexport default function Chat() {\n  // State\n  const [messages, setMessages] = useState<Message[]>([])\n  const [inputValue, setInputValue] = useState('')\n  const [isLoading, setIsLoading] = useState(false)\n  const [selectedInvestment, setSelectedInvestment] = useState<InvestmentOption | null>(null)\n  const [selectedFiles, setSelectedFiles] = useState<FileOption[]>([])\n\n  const [copiedId, setCopiedId] = useState<string | null>(null)\n  \n  const messagesEndRef = useRef<HTMLDivElement>(null)\n  const textareaRef = useRef<HTMLTextAreaElement>(null)\n  const chatContainerRef = useRef<HTMLDivElement>(null)\n\n  // File input ref for direct upload\n  const fileInputRef = useRef<HTMLInputElement>(null)\n  const [uploadingFiles, setUploadingFiles] = useState<Set<string>>(new Set())\n\n  // Model settings\n  const [showModelSettings, setShowModelSettings] = useState(false)\n  const [apiKey, setApiKey] = useState(() => localStorage.getItem('chat_api_key') || '')\n  const [modelName, setModelName] = useState(() => localStorage.getItem('chat_model_name') || 'gpt-4o')\n\n  // Save settings to localStorage\n  useEffect(() => {\n    localStorage.setItem('chat_api_key', apiKey)\n  }, [apiKey])\n\n  useEffect(() => {\n    localStorage.setItem('chat_model_name', modelName)\n  }, [modelName])\n\n  // Fetch data for context selection\n  const { data: _investments } = useQuery({\n    queryKey: ['chat-investments'],\n    queryFn: chatApi.getInvestmentsForContext,\n  })\n\n  // Handle direct file upload\n  const handleFileSelect = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const files = e.target.files\n    if (!files || files.length === 0) return\n\n    for (const file of Array.from(files)) {\n      const fileId = Date.now().toString() + Math.random().toString(36).substr(2, 9)\n      setUploadingFiles(prev => new Set(prev).add(fileId))\n\n      try {\n        // 1. Request upload URL\n        const uploadRequest = await uploadsApi.requestUrl({\n          filename: file.name,\n          content_type: file.type || 'application/octet-stream',\n        })\n\n        // 2. Upload directly to storage\n        const uploadResponse = await fetch(uploadRequest.upload_url, {\n          method: 'PUT',\n          body: file,\n          headers: {\n            'Content-Type': file.type || 'application/octet-stream',\n          },\n        })\n\n        if (!uploadResponse.ok) {\n          throw new Error('Upload failed')\n        }\n\n        // 3. Confirm upload\n        await uploadsApi.confirm({\n          file_id: uploadRequest.file_id,\n          request_analysis: true,\n        })\n\n        // 4. Add to selected files\n        setSelectedFiles(prev => [...prev, {\n          id: uploadRequest.file_id,\n          filename: file.name,\n          mime_type: file.type,\n          size_bytes: file.size,\n        }])\n      } catch (error) {\n        console.error('Upload error:', error)\n      } finally {\n        setUploadingFiles(prev => {\n          const next = new Set(prev)\n          next.delete(fileId)\n          return next\n        })\n      }\n    }\n\n    // Reset input\n    if (fileInputRef.current) {\n      fileInputRef.current.value = ''\n    }\n  }\n\n  // Auto-scroll to bottom\n  const scrollToBottom = useCallback(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' })\n  }, [])\n\n  useEffect(() => {\n    scrollToBottom()\n  }, [messages, scrollToBottom])\n\n  // Auto-resize textarea\n  useEffect(() => {\n    if (textareaRef.current) {\n      textareaRef.current.style.height = 'auto'\n      textareaRef.current.style.height = `${Math.min(textareaRef.current.scrollHeight, 200)}px`\n    }\n  }, [inputValue])\n\n  // Send message\n  const sendMessage = async () => {\n    if (!inputValue.trim() || isLoading) return\n\n    const userMessage: Message = {\n      id: Date.now().toString(),\n      role: 'user',\n      content: inputValue.trim(),\n      timestamp: new Date(),\n      attachments: [\n        ...(selectedInvestment ? [{\n          id: selectedInvestment.id,\n          type: 'investment' as const,\n          name: selectedInvestment.name,\n          data: selectedInvestment\n        }] : []),\n        ...selectedFiles.map(f => ({\n          id: f.id,\n          type: 'file' as const,\n          name: f.filename,\n          data: f\n        }))\n      ]\n    }\n\n    setMessages(prev => [...prev, userMessage])\n    setInputValue('')\n    setIsLoading(true)\n\n    // Add assistant message placeholder\n    const assistantMessageId = (Date.now() + 1).toString()\n    setMessages(prev => [...prev, {\n      id: assistantMessageId,\n      role: 'assistant',\n      content: '',\n      timestamp: new Date(),\n      isStreaming: true\n    }])\n\n    try {\n      // Build message history for API\n      const apiMessages = messages\n        .filter(m => m.role !== 'system')\n        .map(m => ({\n          role: m.role,\n          content: m.content\n        }))\n\n      apiMessages.push({\n        role: 'user',\n        content: userMessage.content\n      })\n\n      // Use streaming API\n      const stream = await chatApi.sendMessageStream({\n        messages: apiMessages,\n        investment_id: selectedInvestment?.id,\n        file_ids: selectedFiles.map(f => f.id),\n        model: modelName,\n        api_key: apiKey || undefined,\n      })\n\n      const reader = stream\n      let fullContent = ''\n\n      while (true) {\n        const { done, value } = await reader.read()\n        if (done) break\n\n        // Parse SSE data\n        const lines = value.split('\\n\\n')\n        for (const line of lines) {\n          if (line.startsWith('data: ')) {\n            try {\n              const data = JSON.parse(line.slice(6))\n              if (data.type === 'content') {\n                fullContent += data.content\n                setMessages(prev => prev.map(m => \n                  m.id === assistantMessageId \n                    ? { ...m, content: fullContent }\n                    : m\n                ))\n              } else if (data.type === 'done') {\n                setMessages(prev => prev.map(m => \n                  m.id === assistantMessageId \n                    ? { ...m, isStreaming: false }\n                    : m\n                ))\n              } else if (data.type === 'error') {\n                console.error('Stream error:', data.error)\n              }\n            } catch (e) {\n              // Ignore parse errors\n            }\n          }\n        }\n      }\n\n      setMessages(prev => prev.map(m => \n        m.id === assistantMessageId \n          ? { ...m, isStreaming: false }\n          : m\n      ))\n\n    } catch (error) {\n      console.error('Chat error:', error)\n      setMessages(prev => prev.map(m => \n        m.id === assistantMessageId \n          ? { \n              ...m, \n              content: 'Lo siento, hubo un error al procesar tu mensaje. Por favor intenta de nuevo.',\n              isStreaming: false \n            }\n          : m\n      ))\n    } finally {\n      setIsLoading(false)\n    }\n  }\n\n  // Handle key press\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault()\n      sendMessage()\n    }\n  }\n\n  // Clear chat\n  const clearChat = () => {\n    setMessages([])\n    setSelectedInvestment(null)\n    setSelectedFiles([])\n  }\n\n  // Copy message\n  const copyMessage = async (content: string, id: string) => {\n    await navigator.clipboard.writeText(content)\n    setCopiedId(id)\n    setTimeout(() => setCopiedId(null), 2000)\n  }\n\n  // Suggested prompts\n  const suggestedPrompts = [\n    \"Resume mis inversiones de tierra\",\n    \"¿Cuál es el valor total de mi portafolio?\",\n    \"Analiza el último documento que subí\",\n    \"¿Qué inversiones están activas?\",\n    \"Compara el rendimiento de mis propiedades\",\n  ]\n\n  return (\n    <div className=\"h-[calc(100vh-8rem)] flex flex-col fade-in\">\n      {/* Header */}\n      <div className=\"flex items-center justify-end mb-4\">\n        {/* Clear Chat */}\n        {messages.length > 0 && (\n          <button\n            onClick={clearChat}\n            className=\"p-2 text-text-muted hover:text-error hover:bg-error/10 rounded-xl transition-colors\"\n            title=\"Limpiar chat\"\n          >\n            <Trash2 className=\"h-4 w-4\" />\n          </button>\n        )}\n      </div>\n\n      {/* Messages Area */}\n      <div \n        ref={chatContainerRef}\n        className=\"flex-1 overflow-y-auto custom-scrollbar mb-4 space-y-4\"\n      >\n        {messages.length === 0 ? (\n          /* Empty State */\n          <div className=\"h-full flex flex-col items-center justify-center text-center px-4\">\n            <div className=\"relative w-20 h-20 mb-6\">\n              <div className=\"absolute inset-0 bg-cream/10 rounded-3xl border border-cream/20 animate-pulse\" />\n              <div className=\"absolute inset-0 flex items-center justify-center\">\n                <Bot className=\"h-10 w-10 text-cream\" />\n              </div>\n            </div>\n            <h2 className=\"text-xl font-semibold text-text-primary mb-2\">\n              ¿En qué puedo ayudarte?\n            </h2>\n            <p className=\"text-text-secondary max-w-md mb-8\">\n              Soy Prism Chat, tu asistente para gestionar el portafolio de inversiones familiar. \n              Puedo responder preguntas sobre tus inversiones, analizar documentos y más.\n            </p>\n            \n            {/* Suggested Prompts */}\n            <div className=\"flex flex-wrap justify-center gap-2 max-w-lg\">\n              {suggestedPrompts.map((prompt, idx) => (\n                <button\n                  key={idx}\n                  onClick={() => setInputValue(prompt)}\n                  className=\"px-4 py-2 text-sm text-text-secondary bg-surface border border-border rounded-full hover:border-cream/30 hover:text-cream transition-colors\"\n                >\n                  {prompt}\n                </button>\n              ))}\n            </div>\n          </div>\n        ) : (\n          /* Messages */\n          messages.map((message) => (\n            <div\n              key={message.id}\n              className={`flex gap-4 ${message.role === 'user' ? 'flex-row-reverse' : ''}`}\n            >\n              {/* Avatar */}\n              <div className={`flex-shrink-0 w-8 h-8 rounded-xl flex items-center justify-center ${\n                message.role === 'user'\n                  ? 'bg-cream text-void'\n                  : 'bg-surface border border-border'\n              }`}>\n                {message.role === 'user' ? (\n                  <User className=\"h-4 w-4\" />\n                ) : (\n                  <Bot className=\"h-4 w-4 text-cream\" />\n                )}\n              </div>\n\n              {/* Content */}\n              <div className={`flex-1 max-w-[85%] ${message.role === 'user' ? 'text-right' : ''}`}>\n                {/* Attachments */}\n                {message.attachments && message.attachments.length > 0 && message.role === 'user' && (\n                  <div className=\"flex flex-wrap gap-2 justify-end mb-2\">\n                    {message.attachments.map(att => (\n                      <span\n                        key={att.id}\n                        className=\"inline-flex items-center gap-1.5 px-2 py-1 text-xs bg-cream/10 text-cream rounded-lg border border-cream/20\"\n                      >\n                        {att.type === 'investment' ? <Trees className=\"h-3 w-3\" /> : <FileText className=\"h-3 w-3\" />}\n                        {att.name}\n                      </span>\n                    ))}\n                  </div>\n                )}\n\n                {/* Message Bubble */}\n                <div\n                  className={`inline-block text-left px-4 py-3 rounded-2xl ${\n                    message.role === 'user'\n                      ? 'bg-cream text-void'\n                      : 'bg-surface border border-border text-text-primary'\n                  }`}\n                >\n                  <div className=\"whitespace-pre-wrap text-sm leading-relaxed\">\n                    {message.content || (message.isStreaming ? (\n                      <span className=\"flex items-center gap-2 text-text-muted\">\n                        <Loader2 className=\"h-4 w-4 animate-spin\" />\n                        Pensando...\n                      </span>\n                    ) : '')}\n                  </div>\n                  \n                  {/* Streaming indicator */}\n                  {message.isStreaming && message.content && (\n                    <span className=\"inline-block w-2 h-4 ml-1 bg-cream animate-pulse\" />\n                  )}\n                </div>\n\n                {/* Actions */}\n                {message.role === 'assistant' && !message.isStreaming && message.content && (\n                  <div className=\"flex items-center gap-2 mt-1 ml-1\">\n                    <button\n                      onClick={() => copyMessage(message.content, message.id)}\n                      className=\"p-1.5 text-text-muted hover:text-cream hover:bg-surface rounded-lg transition-colors\"\n                      title=\"Copiar\"\n                    >\n                      {copiedId === message.id ? (\n                        <Check className=\"h-3.5 w-3.5 text-success\" />\n                      ) : (\n                        <Copy className=\"h-3.5 w-3.5\" />\n                      )}\n                    </button>\n                    <span className=\"text-[10px] text-text-muted\">\n                      {message.timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\n                    </span>\n                  </div>\n                )}\n              </div>\n            </div>\n          ))\n        )}\n        <div ref={messagesEndRef} />\n      </div>\n\n      {/* Input Area */}\n      <div className=\"relative\">\n        {/* Context badges above input */}\n        {(selectedInvestment || selectedFiles.length > 0) && (\n          <div className=\"flex flex-wrap gap-2 mb-2 px-1\">\n            {selectedInvestment && (\n              <span className=\"inline-flex items-center gap-1.5 px-2 py-1 text-xs bg-cream/10 text-cream rounded-lg border border-cream/20\">\n                <Trees className=\"h-3 w-3\" />\n                {selectedInvestment.name}\n                <button \n                  onClick={() => setSelectedInvestment(null)}\n                  className=\"ml-1 hover:text-white\"\n                >\n                  <X className=\"h-3 w-3\" />\n                </button>\n              </span>\n            )}\n            {selectedFiles.map(file => (\n              <span key={file.id} className=\"inline-flex items-center gap-1.5 px-2 py-1 text-xs bg-surface text-text-secondary rounded-lg border border-border\">\n                <FileText className=\"h-3 w-3\" />\n                {file.filename}\n                <button \n                  onClick={() => setSelectedFiles(prev => prev.filter(f => f.id !== file.id))}\n                  className=\"ml-1 hover:text-error\"\n                >\n                  <X className=\"h-3 w-3\" />\n                </button>\n              </span>\n            ))}\n          </div>\n        )}\n\n        <div className=\"relative flex items-end gap-2 bg-surface border border-border rounded-2xl p-3 focus-within:border-cream/30 focus-within:ring-1 focus-within:ring-cream/20 transition-all\">\n          {/* Hidden file input */}\n          <input\n            ref={fileInputRef}\n            type=\"file\"\n            multiple\n            onChange={handleFileSelect}\n            className=\"hidden\"\n          />\n\n          {/* Textarea container with buttons inside */}\n          <div className=\"flex-1 relative flex items-start\">\n            {/* Left buttons: Upload and Model Settings */}\n            <div className=\"absolute left-0 bottom-1 flex items-center gap-1 z-10\">\n              {/* Upload button */}\n              <button\n                onClick={() => fileInputRef.current?.click()}\n                disabled={isLoading || uploadingFiles.size > 0}\n                className=\"p-2 rounded-lg text-text-muted hover:text-cream hover:bg-surface-elevated transition-colors disabled:opacity-50\"\n                title=\"Adjuntar archivo\"\n              >\n                {uploadingFiles.size > 0 ? (\n                  <Loader2 className=\"h-4 w-4 animate-spin\" />\n                ) : (\n                  <Upload className=\"h-4 w-4\" />\n                )}\n              </button>\n\n              {/* Model Settings button */}\n              <button\n                onClick={() => setShowModelSettings(!showModelSettings)}\n                disabled={isLoading}\n                className={`p-2 rounded-lg transition-colors disabled:opacity-50 ${\n                  showModelSettings || apiKey \n                    ? 'text-cream bg-cream/10' \n                    : 'text-text-muted hover:text-cream hover:bg-surface-elevated'\n                }`}\n                title=\"Configurar modelo\"\n              >\n                <Cpu className=\"h-4 w-4\" />\n              </button>\n\n              {/* Model Settings Dropdown */}\n              {showModelSettings && (\n                <div className=\"absolute left-0 bottom-full mb-2 w-72 bg-surface-elevated border border-border rounded-xl shadow-2xl p-4 space-y-4 z-40\">\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"text-sm font-medium text-text-primary\">Modelo</span>\n                    <button \n                      onClick={() => setShowModelSettings(false)}\n                      className=\"text-text-muted hover:text-text-primary\"\n                    >\n                      <X className=\"h-4 w-4\" />\n                    </button>\n                  </div>\n                  \n                  {/* Model Name Input */}\n                  <div className=\"space-y-2\">\n                    <label className=\"text-xs text-text-muted uppercase tracking-wider\">Nombre del Modelo</label>\n                    <input\n                      type=\"text\"\n                      value={modelName}\n                      onChange={(e) => setModelName(e.target.value)}\n                      placeholder=\"gpt-4o, claude-3-5-sonnet, etc.\"\n                      className=\"w-full px-3 py-2 bg-surface border border-border rounded-lg text-sm text-text-primary placeholder:text-text-muted outline-none focus:border-cream/30\"\n                    />\n                    <p className=\"text-[10px] text-text-muted\">\n                      Ej: gpt-4o, claude-3-5-sonnet, gemini-1.5-flash\n                    </p>\n                  </div>\n\n                  {/* API Key Input */}\n                  <div className=\"space-y-2\">\n                    <label className=\"text-xs text-text-muted uppercase tracking-wider\">API Key</label>\n                    <div className=\"relative\">\n                      <Key className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted\" />\n                      <input\n                        type=\"password\"\n                        value={apiKey}\n                        onChange={(e) => setApiKey(e.target.value)}\n                        placeholder=\"sk-...\"\n                        className=\"w-full pl-9 pr-3 py-2 bg-surface border border-border rounded-lg text-sm text-text-primary placeholder:text-text-muted outline-none focus:border-cream/30\"\n                      />\n                    </div>\n                    <p className=\"text-[10px] text-text-muted\">\n                      Se guarda localmente en tu navegador\n                    </p>\n                  </div>\n\n                  {/* Current Model Display */}\n                  <div className=\"pt-2 border-t border-border\">\n                    <div className=\"flex items-center gap-2 text-xs text-text-muted\">\n                      <div className={`w-2 h-2 rounded-full ${apiKey ? 'bg-success' : 'bg-warning'}`} />\n                      {apiKey ? `Usando: ${modelName}` : 'Usando modelo por defecto del servidor'}\n                    </div>\n                  </div>\n                </div>\n              )}\n            </div>\n\n            <textarea\n              ref={textareaRef}\n              value={inputValue}\n              onChange={(e) => setInputValue(e.target.value)}\n              onKeyDown={handleKeyDown}\n              placeholder=\"Escribe tu mensaje...\"\n              rows={1}\n              className=\"w-full bg-transparent text-text-primary placeholder:text-text-muted resize-none outline-none text-sm min-h-[24px] max-h-[200px] py-2 pl-20 pr-2\"\n              disabled={isLoading}\n            />\n          </div>\n          \n          <button\n            onClick={sendMessage}\n            disabled={!inputValue.trim() || isLoading}\n            className={`flex-shrink-0 p-2.5 rounded-xl transition-all ${\n              inputValue.trim() && !isLoading\n                ? 'bg-cream text-void hover:bg-cream-light'\n                : 'bg-surface-elevated text-text-muted cursor-not-allowed'\n            }`}\n          >\n            {isLoading ? (\n              <Loader2 className=\"h-4 w-4 animate-spin\" />\n            ) : (\n              <Send className=\"h-4 w-4\" />\n            )}\n          </button>\n        </div>\n      </div>\n\n      {/* Click outside to close model settings */}\n      {showModelSettings && (\n        <div \n          className=\"fixed inset-0 z-30\" \n          onClick={() => setShowModelSettings(false)}\n        />\n      )}\n    </div>\n  )\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/hinoki/HinokiDEV/Investments/prism/web/src/pages/Dashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Brain' is defined but never used.","line":6,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":8},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'completedAnalyses' is assigned a value but never used.","line":79,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":79,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'pendingAnalyses' is assigned a value but never used.","line":80,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":80,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useQuery } from '@tanstack/react-query'\nimport { \n  Trees, \n  DollarSign, \n  FileText, \n  Brain,\n  TrendingUp,\n  Clock,\n  ChevronRight,\n  ArrowUpRight,\n  ArrowDownRight,\n  Percent\n} from 'lucide-react'\nimport StatCard, { FeaturedStat } from '../components/StatCard'\nimport { dashboardApi, investmentsApi } from '../lib/api'\nimport { formatCurrency, formatNumber } from '../lib/utils'\nimport { Link } from 'react-router-dom'\n\n// Category icon mapping\nconst categoryIcons: Record<string, string> = {\n  land: '🏞️',\n  stocks: '📈',\n  gold: '🪙',\n  crypto: '₿',\n  real_estate: '🏢',\n  bonds: '📜',\n  other: '📦'\n}\n\n// Category labels\nconst categoryLabels: Record<string, string> = {\n  land: 'Terrenos',\n  stocks: 'Acciones',\n  gold: 'Oro',\n  crypto: 'Crypto',\n  real_estate: 'Inmuebles',\n  bonds: 'Bonos',\n  other: 'Otros'\n}\n\n// Skeleton loader component\nfunction DashboardSkeleton() {\n  return (\n    <div className=\"space-y-8 animate-pulse\">\n      {/* Featured stat skeleton */}\n      <div className=\"h-48 bg-surface-elevated rounded-3xl\" />\n      \n      {/* Stats grid skeleton */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n        {[...Array(4)].map((_, i) => (\n          <div key={i} className=\"h-32 bg-surface rounded-2xl\" />\n        ))}\n      </div>\n    </div>\n  )\n}\n\nexport default function Dashboard() {\n  const { data: stats, isLoading } = useQuery({\n    queryKey: ['dashboard-stats'],\n    queryFn: dashboardApi.getStats,\n  })\n\n  const { data: investments } = useQuery({\n    queryKey: ['investments'],\n    queryFn: investmentsApi.list,\n  })\n\n  if (isLoading) {\n    return <DashboardSkeleton />\n  }\n\n  const totalValue = stats?.total_value || 0\n  const totalInvested = stats?.total_invested || 0\n  const totalReturn = stats?.total_return || 0\n  const totalReturnPct = stats?.total_return_pct || 0\n  const totalInvestments = stats?.total_investments || 0\n  const totalFiles = stats?.total_files || 0\n  const completedAnalyses = stats?.completed_analyses || 0\n  const pendingAnalyses = stats?.pending_analyses || 0\n\n  return (\n    <div className=\"space-y-8 fade-in\">\n      {/* Featured Total Value */}\n      <FeaturedStat\n        label=\"Valor Total del Portafolio\"\n        value={formatCurrency(totalValue)}\n        sublabel=\"Valor combinado de todas las categorías de inversión\"\n        icon={DollarSign}\n      />\n\n      {/* Stats Grid */}\n      <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 stagger-children\">\n        <StatCard\n          title=\"Retorno Total\"\n          value={formatCurrency(totalReturn)}\n          description={totalInvested > 0 ? `Invertido: ${formatCurrency(totalInvested)}` : \"Sin datos de compra\"}\n          icon={totalReturn >= 0 ? ArrowUpRight : ArrowDownRight}\n          variant={totalReturn >= 0 ? \"accent\" : \"default\"}\n          delay={0}\n        />\n        <StatCard\n          title=\"Retorno %\"\n          value={`${totalReturnPct >= 0 ? '+' : ''}${totalReturnPct.toFixed(2)}%`}\n          description=\"Rendimiento del portafolio\"\n          icon={Percent}\n          variant={totalReturnPct >= 0 ? \"accent\" : \"default\"}\n          delay={50}\n        />\n        <StatCard\n          title=\"Inversiones\"\n          value={formatNumber(totalInvestments)}\n          description=\"Activos monitoreados\"\n          icon={Trees}\n          variant=\"default\"\n          delay={100}\n        />\n        <StatCard\n          title=\"Archivos\"\n          value={formatNumber(totalFiles)}\n          description=\"Documentos y media\"\n          icon={FileText}\n          variant=\"default\"\n          delay={150}\n        />\n      </div>\n\n      {/* Category Breakdown */}\n      <section>\n        <div className=\"flex items-center justify-between mb-4\">\n          <div className=\"flex items-center gap-2\">\n            <span className=\"text-xs font-semibold tracking-widest text-cream-muted uppercase\">Categorías</span>\n          </div>\n          <Link \n            to=\"/investments\" \n            className=\"text-xs text-cream-muted hover:text-cream transition-colors flex items-center gap-1\"\n          >\n            Ver Todo <ChevronRight className=\"h-3 w-3\" />\n          </Link>\n        </div>\n        \n        <div className=\"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-3\">\n          {Object.entries(stats?.investments_by_category || {}).map(([category, count], index) => (\n            <div \n              key={category}\n              className=\"group relative overflow-hidden rounded-xl border border-border bg-surface p-4 transition-all duration-300 hover:border-border-strong hover:-translate-y-0.5\"\n              style={{ animationDelay: `${index * 50}ms` }}\n            >\n              {/* Hover glow */}\n              <div className=\"absolute inset-0 bg-gradient-to-br from-cream/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity\" />\n              \n              <div className=\"relative\">\n                <div className=\"flex items-center justify-between mb-3\">\n                  <span className=\"text-2xl\">{categoryIcons[category] || '📦'}</span>\n                  <span className=\"font-mono text-lg font-semibold text-cream\">{count}</span>\n                </div>\n                <p className=\"text-xs text-text-secondary capitalize\">{categoryLabels[category] || category}</p>\n              </div>\n            </div>\n          ))}\n        </div>\n      </section>\n\n      {/* Recent Activity Grid */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        {/* Recent Uploads */}\n        <section className=\"glass-card-elevated\">\n          <div className=\"flex items-center justify-between p-5 border-b border-border\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-2 rounded-lg bg-surface-elevated\">\n                <Clock className=\"h-4 w-4 text-cream-muted\" />\n              </div>\n              <span className=\"text-sm font-semibold text-text-primary\">Subidas Recientes</span>\n            </div>\n            <Link \n              to=\"/files\"\n              className=\"glyph-btn glyph-btn-ghost py-1.5 px-3 text-xs\"\n            >\n              Ver Todo\n            </Link>\n          </div>\n          \n          <div className=\"p-2\">\n            {stats?.recent_uploads?.length ? (\n              <div className=\"space-y-1\">\n                {stats.recent_uploads.slice(0, 5).map((file, index) => (\n                  <div \n                    key={file.id}\n                    className=\"flex items-center justify-between p-3 rounded-lg hover:bg-surface transition-colors group\"\n                    style={{ animationDelay: `${index * 50}ms` }}\n                  >\n                    <div className=\"flex items-center gap-3 min-w-0\">\n                      <div className=\"p-2 rounded-lg bg-surface-elevated group-hover:bg-cream/10 transition-colors\">\n                        <FileText className=\"h-4 w-4 text-text-muted group-hover:text-cream transition-colors\" />\n                      </div>\n                      <span className=\"text-sm text-text-secondary truncate group-hover:text-text-primary transition-colors\">\n                        {file.original_filename}\n                      </span>\n                    </div>\n                    <span className={`text-[10px] font-medium tracking-wider uppercase px-2 py-1 rounded-full ${\n                      file.status === 'completed' \n                        ? 'bg-success-dim text-success' \n                        : file.status === 'processing'\n                        ? 'bg-info-dim text-info'\n                        : 'bg-warning-dim text-warning'\n                    }`}>\n                      {file.status}\n                    </span>\n                  </div>\n                ))}\n              </div>\n            ) : (\n              <div className=\"p-8 text-center\">\n                <div className=\"w-12 h-12 mx-auto mb-3 rounded-full bg-surface-elevated flex items-center justify-center\">\n                  <FileText className=\"h-5 w-5 text-text-muted\" />\n                </div>\n                <p className=\"text-sm text-text-muted\">No hay subidas recientes</p>\n              </div>\n            )}\n          </div>\n        </section>\n\n        {/* Recent Investments */}\n        <section className=\"glass-card-elevated\">\n          <div className=\"flex items-center justify-between p-5 border-b border-border\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-2 rounded-lg bg-surface-elevated\">\n                <TrendingUp className=\"h-4 w-4 text-cream-muted\" />\n              </div>\n              <span className=\"text-sm font-semibold text-text-primary\">Inversiones Recientes</span>\n            </div>\n            <Link \n              to=\"/investments\"\n              className=\"glyph-btn glyph-btn-ghost py-1.5 px-3 text-xs\"\n            >\n              Ver Todo\n            </Link>\n          </div>\n          \n          <div className=\"p-2\">\n            {Array.isArray(investments) && investments.length > 0 ? (\n              <div className=\"space-y-1\">\n                {investments.slice(0, 5).map((inv, index) => (\n                  <Link\n                    key={inv.id}\n                    to={`/investments/${inv.id}`}\n                    className=\"flex items-center justify-between p-3 rounded-lg hover:bg-surface transition-colors group\"\n                    style={{ animationDelay: `${index * 50}ms` }}\n                  >\n                    <div className=\"min-w-0 flex-1\">\n                      <p className=\"text-sm font-medium text-text-primary truncate group-hover:text-cream transition-colors\">\n                        {inv.name}\n                      </p>\n                      <p className=\"text-xs text-text-muted capitalize flex items-center gap-1 mt-0.5\">\n                        <span>{categoryIcons[inv.category] || '📦'}</span>\n                        <span>{categoryLabels[inv.category] || inv.category}</span>\n                        <span className=\"text-border-strong\">•</span>\n                        <span>{inv.city || 'Sin ubicación'}</span>\n                      </p>\n                    </div>\n                    <span className=\"font-mono text-sm text-cream ml-4\">\n                      {inv.current_value ? formatCurrency(inv.current_value) : '—'}\n                    </span>\n                  </Link>\n                ))}\n              </div>\n            ) : (\n              <div className=\"p-8 text-center\">\n                <div className=\"w-12 h-12 mx-auto mb-3 rounded-full bg-surface-elevated flex items-center justify-center\">\n                  <Trees className=\"h-5 w-5 text-text-muted\" />\n                </div>\n                <p className=\"text-sm text-text-muted\">Aún no hay inversiones</p>\n              </div>\n            )}\n          </div>\n        </section>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/hinoki/HinokiDEV/Investments/prism/web/src/pages/Download.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/hinoki/HinokiDEV/Investments/prism/web/src/pages/Files.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FolderOpen' is defined but never used.","line":12,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'HardDrive' is defined but never used.","line":13,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":82,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2503,2506],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2503,2506],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'totalSize' is assigned a value but never used.","line":88,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":88,"endColumn":18},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":88,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":88,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2765,2768],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2765,2768],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":170,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":170,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6152,6155],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6152,6155],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":226,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":226,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9214,9217],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9214,9217],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react'\nimport { useQuery } from '@tanstack/react-query'\nimport { \n  FileText, \n  Search, \n  Download,\n  Filter,\n  Image,\n  FileVideo,\n  FileAudio,\n  File,\n  FolderOpen,\n  HardDrive\n} from 'lucide-react'\nimport { filesApi } from '../lib/api'\nimport { formatDate, formatFileSize } from '../lib/utils'\n\nconst statusConfig: Record<string, { label: string; className: string }> = {\n  pending: { \n    label: 'Pendiente', \n    className: 'bg-warning-dim text-warning border-warning/20' \n  },\n  processing: { \n    label: 'Procesando', \n    className: 'bg-info-dim text-info border-info/20' \n  },\n  completed: { \n    label: 'Completado', \n    className: 'bg-success-dim text-success border-success/20' \n  },\n  failed: { \n    label: 'Fallido', \n    className: 'bg-error-dim text-error border-error/20' \n  },\n}\n\nconst getFileIcon = (mimeType?: string) => {\n  if (mimeType?.startsWith('image/')) return Image\n  if (mimeType?.startsWith('video/')) return FileVideo\n  if (mimeType?.startsWith('audio/')) return FileAudio\n  return File\n}\n\nconst getFileIconColor = (mimeType?: string) => {\n  if (mimeType?.startsWith('image/')) return 'text-purple-400 bg-purple-400/10'\n  if (mimeType?.startsWith('video/')) return 'text-rose-400 bg-rose-400/10'\n  if (mimeType?.startsWith('audio/')) return 'text-amber-400 bg-amber-400/10'\n  if (mimeType?.startsWith('application/pdf')) return 'text-red-400 bg-red-400/10'\n  return 'text-cream-muted bg-surface-elevated'\n}\n\nexport default function Files() {\n  const [search, setSearch] = useState('')\n  const [status, setStatus] = useState('')\n\n  const { data: files, isLoading } = useQuery({\n    queryKey: ['files'],\n    queryFn: () => filesApi.list(),\n  })\n\n  // Ensure files is an array - API might return non-array on error\n  const filesArray = Array.isArray(files) ? files : []\n\n  const handleDownload = async (fileId: string, filename: string) => {\n    try {\n      const { download_url } = await filesApi.getDownloadUrl(fileId)\n      \n      // Create a hidden anchor element to trigger download\n      const link = document.createElement('a')\n      link.href = download_url\n      link.download = filename // This sets the filename for the download\n      link.style.display = 'none'\n      document.body.appendChild(link)\n      link.click()\n      document.body.removeChild(link)\n    } catch (error) {\n      console.error('Download error:', error)\n      alert('Error al generar el link de descarga')\n    }\n  }\n\n  const filteredFiles = filesArray.filter((f: any) => {\n    const matchesSearch = f.original_filename?.toLowerCase().includes(search.toLowerCase())\n    const matchesStatus = !status || f.status === status\n    return matchesSearch && matchesStatus\n  })\n\n  const totalSize = filesArray.reduce((acc: number, f: any) => acc + (f.file_size_bytes || 0), 0)\n\n  return (\n    <div className=\"space-y-6 fade-in\">\n      {/* Filters */}\n      <div className=\"glass-card p-4\">\n        <div className=\"flex flex-col sm:flex-row gap-4\">\n          <div className=\"flex-1 relative\">\n            <Search className=\"absolute left-4 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted\" />\n            <input\n              type=\"text\"\n              placeholder=\"Buscar archivos...\"\n              value={search}\n              onChange={(e) => setSearch(e.target.value)}\n              className=\"input-field pl-11\"\n            />\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Filter className=\"h-4 w-4 text-text-muted\" />\n            <select\n              value={status}\n              onChange={(e) => setStatus(e.target.value)}\n              className=\"input-field py-2.5 pr-10\"\n            >\n              <option value=\"\">Todos los Estados</option>\n              <option value=\"pending\">Pendiente</option>\n              <option value=\"processing\">Procesando</option>\n              <option value=\"completed\">Completado</option>\n              <option value=\"failed\">Fallido</option>\n            </select>\n          </div>\n        </div>\n      </div>\n\n      {/* Results Count */}\n      <div className=\"flex items-center justify-between text-xs text-text-muted\">\n        <span>\n          {filteredFiles?.length || 0} archivo{filteredFiles?.length !== 1 ? 's' : ''}\n        </span>\n        {(search || status) && (\n          <button \n            onClick={() => { setSearch(''); setStatus('') }}\n            className=\"text-cream-muted hover:text-cream transition-colors\"\n          >\n            Limpiar filtros\n          </button>\n        )}\n      </div>\n\n      {/* File List */}\n      {isLoading ? (\n        <div className=\"space-y-3\">\n          {[...Array(5)].map((_, i) => (\n            <div key={i} className=\"h-20 sm:h-16 bg-surface rounded-xl animate-pulse\" />\n          ))}\n        </div>\n      ) : filteredFiles?.length ? (\n        <>\n          {/* Desktop Table View */}\n          <div className=\"hidden sm:block glass-card overflow-hidden\">\n            <div className=\"overflow-x-auto\">\n              <table className=\"min-w-full\">\n                <thead>\n                  <tr className=\"border-b border-border\">\n                    <th className=\"px-6 py-4 text-left text-[10px] font-semibold tracking-widest text-text-muted uppercase\">\n                      Archivo\n                    </th>\n                    <th className=\"px-6 py-4 text-left text-[10px] font-semibold tracking-widest text-text-muted uppercase\">\n                      Tamaño\n                    </th>\n                    <th className=\"px-6 py-4 text-left text-[10px] font-semibold tracking-widest text-text-muted uppercase\">\n                      Subido\n                    </th>\n                    <th className=\"px-6 py-4 text-left text-[10px] font-semibold tracking-widest text-text-muted uppercase\">\n                      Estado\n                    </th>\n                    <th className=\"px-6 py-4 text-right text-[10px] font-semibold tracking-widest text-text-muted uppercase\">\n                      Acciones\n                    </th>\n                  </tr>\n                </thead>\n                <tbody className=\"divide-y divide-border-subtle\">\n                  {filteredFiles.map((file: any) => {\n                    const Icon = getFileIcon(file.mime_type)\n                    const iconColorClass = getFileIconColor(file.mime_type)\n                    return (\n                      <tr key={file.id} className=\"group hover:bg-surface-elevated/50 transition-colors\">\n                        <td className=\"px-6 py-4\">\n                          <div className=\"flex items-center gap-4\">\n                            <div className={`flex-shrink-0 h-10 w-10 flex items-center justify-center rounded-xl ${iconColorClass}`}>\n                              <Icon className=\"h-5 w-5\" />\n                            </div>\n                            <div className=\"min-w-0\">\n                              <div className=\"text-sm font-medium text-text-primary truncate max-w-[200px] lg:max-w-xs\">\n                                {file.original_filename}\n                              </div>\n                              <div className=\"text-xs text-text-muted\">\n                                {file.mime_type?.split('/')[1]?.toUpperCase() || 'FILE'}\n                              </div>\n                            </div>\n                          </div>\n                        </td>\n                        <td className=\"px-6 py-4 whitespace-nowrap\">\n                          <span className=\"text-sm font-mono text-text-secondary\">\n                            {file.file_size_bytes ? formatFileSize(file.file_size_bytes) : '—'}\n                          </span>\n                        </td>\n                        <td className=\"px-6 py-4 whitespace-nowrap\">\n                          <span className=\"text-sm text-text-secondary\">\n                            {formatDate(file.uploaded_at)}\n                          </span>\n                        </td>\n                        <td className=\"px-6 py-4 whitespace-nowrap\">\n                          <span className={`inline-flex px-2.5 py-1 text-[10px] font-semibold tracking-wider uppercase rounded-full border ${\n                            statusConfig[file.status]?.className || statusConfig.pending.className\n                          }`}>\n                            {statusConfig[file.status]?.label || file.status}\n                          </span>\n                        </td>\n                        <td className=\"px-6 py-4 whitespace-nowrap text-right\">\n                          <button\n                            onClick={() => handleDownload(file.id, file.original_filename)}\n                            className=\"p-2 rounded-lg text-text-muted hover:text-cream hover:bg-cream/10 transition-colors\"\n                            title=\"Download\"\n                          >\n                            <Download className=\"h-4 w-4\" />\n                          </button>\n                        </td>\n                      </tr>\n                    )\n                  })}\n                </tbody>\n              </table>\n            </div>\n          </div>\n\n          {/* Mobile Card View */}\n          <div className=\"sm:hidden space-y-3\">\n            {filteredFiles.map((file: any) => {\n              const Icon = getFileIcon(file.mime_type)\n              const iconColorClass = getFileIconColor(file.mime_type)\n              return (\n                <div \n                  key={file.id} \n                  className=\"glass-card p-4 flex items-center gap-3\"\n                >\n                  <div className={`flex-shrink-0 h-12 w-12 flex items-center justify-center rounded-xl ${iconColorClass}`}>\n                    <Icon className=\"h-6 w-6\" />\n                  </div>\n                  <div className=\"flex-1 min-w-0\">\n                    <p className=\"text-sm font-medium text-text-primary truncate\">\n                      {file.original_filename}\n                    </p>\n                    <div className=\"flex items-center gap-2 mt-1\">\n                      <span className=\"text-xs text-text-muted\">\n                        {file.file_size_bytes ? formatFileSize(file.file_size_bytes) : '—'}\n                      </span>\n                      <span className=\"text-border-strong\">•</span>\n                      <span className={`text-[10px] font-semibold tracking-wider uppercase px-2 py-0.5 rounded-full border ${\n                        statusConfig[file.status]?.className || statusConfig.pending.className\n                      }`}>\n                        {statusConfig[file.status]?.label || file.status}\n                      </span>\n                    </div>\n                  </div>\n                  <button\n                    onClick={() => handleDownload(file.id, file.original_filename)}\n                    className=\"flex-shrink-0 p-3 rounded-xl text-text-muted hover:text-cream hover:bg-cream/10 transition-colors\"\n                    title=\"Download\"\n                  >\n                    <Download className=\"h-5 w-5\" />\n                  </button>\n                </div>\n              )\n            })}\n          </div>\n        </>\n      ) : (\n        <div className=\"text-center py-16 border border-dashed border-border rounded-3xl\">\n          <div className=\"w-16 h-16 mx-auto mb-4 rounded-2xl bg-surface flex items-center justify-center\">\n            <FileText className=\"h-8 w-8 text-text-muted\" />\n          </div>\n          <h3 className=\"text-lg font-medium text-text-primary mb-1\">\n            {search || status ? 'No se encontraron coincidencias' : 'Aún no hay archivos'}\n          </h3>\n          <p className=\"text-sm text-text-muted\">\n            {search || status \n              ? 'Intenta ajustar tu búsqueda o filtros'\n              : 'Sube archivos desde la página de inversiones'\n            }\n          </p>\n        </div>\n      )}\n    </div>\n  )\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/hinoki/HinokiDEV/Investments/prism/web/src/pages/InvestmentDetail.tsx","messages":[{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":177,"column":47,"nodeType":"Identifier","endLine":177,"endColumn":55},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useMemo\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":180,"column":51,"nodeType":"Identifier","endLine":180,"endColumn":58},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":199,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":199,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5623,5626],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5623,5626],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useMemo\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":211,"column":26,"nodeType":"Identifier","endLine":211,"endColumn":33},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useMemo\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":217,"column":29,"nodeType":"Identifier","endLine":217,"endColumn":36},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":515,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":515,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21575,21578],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21575,21578],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":515,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":515,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21608,21611],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21608,21611],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":523,"column":77,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":523,"endColumn":80,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22172,22175],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22172,22175],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":528,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":528,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22369,22372],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22369,22372],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":528,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":528,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22394,22397],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22394,22397],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useRef, useMemo } from 'react'\nimport { useParams, useNavigate, Link } from 'react-router-dom'\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\nimport { \n  ArrowLeft, \n  MapPin, \n  Upload,\n  Trash2,\n  Edit,\n  FileText,\n  TrendingUp,\n  TrendingDown,\n  DollarSign,\n  Calendar,\n  Tag,\n  ChevronRight,\n  ExternalLink,\n  Calculator,\n  Building2,\n  AlertTriangle,\n  CheckCircle\n} from 'lucide-react'\nimport { investmentsApi, uploadsApi } from '../lib/api'\nimport { formatCurrency, formatDate } from '../lib/utils'\nimport { \n  SAMPLE_CREDITS,\n  CreditScenario,\n  LandOpportunity,\n  analyzeLandCreditCombo,\n  formatPercent,\n  CURRENT_UF_VALUE\n} from '../lib/landCredit'\nimport { \n  CreditTruthRevealer,\n  AmortizationChart,\n  PaymentBreakdownChart\n} from '../components/CreditAnalysis'\nimport { HelpTooltip, INVESTMENT_TOOLTIPS } from '../components/HelpTooltip'\n\nconst categoryIcons: Record<string, string> = {\n  land: '🏞️',\n  stocks: '📈',\n  gold: '🪙',\n  crypto: '₿',\n  real_estate: '🏢',\n  bonds: '📜',\n  other: '📦'\n}\n\nconst statusConfig: Record<string, { label: string; className: string }> = {\n  active: { \n    label: 'Activo', \n    className: 'bg-success-dim text-success border-success/20' \n  },\n  sold: { \n    label: 'Vendido', \n    className: 'bg-surface text-text-muted border-border' \n  },\n  pending: { \n    label: 'Pendiente', \n    className: 'bg-warning-dim text-warning border-warning/20' \n  },\n  under_contract: { \n    label: 'En Contrato', \n    className: 'bg-info-dim text-info border-info/20' \n  },\n}\n\nexport default function InvestmentDetail() {\n  const { id } = useParams<{ id: string }>()\n  const navigate = useNavigate()\n  const queryClient = useQueryClient()\n  const [isUploading, setIsUploading] = useState(false)\n  const [isDragging, setIsDragging] = useState(false)\n  const fileInputRef = useRef<HTMLInputElement>(null)\n\n  const { data: investment, isLoading } = useQuery({\n    queryKey: ['investment', id],\n    queryFn: () => investmentsApi.get(id!),\n    enabled: !!id,\n  })\n\n  const deleteMutation = useMutation({\n    mutationFn: () => investmentsApi.delete(id!),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['investments'] })\n      navigate('/investments')\n    },\n  })\n\n  const processFile = async (file: File) => {\n    if (!id) return\n\n    setIsUploading(true)\n    try {\n      const { upload_url, file_id } = await uploadsApi.requestUrl({\n        filename: file.name,\n        content_type: file.type,\n        investment_id: id,\n        source_device: 'web',\n      })\n\n      const response = await fetch(upload_url, {\n        method: 'PUT',\n        body: file,\n        headers: { 'Content-Type': file.type },\n      })\n\n      if (!response.ok) throw new Error('Upload failed')\n\n      await uploadsApi.confirm({\n        file_id,\n        investment_id: id,\n        document_type: 'other',\n        request_analysis: true,\n      })\n\n      queryClient.invalidateQueries({ queryKey: ['investment', id] })\n    } catch (error) {\n      console.error('Upload error:', error)\n      alert('Error al subir. Intenta nuevamente.')\n    } finally {\n      setIsUploading(false)\n      // Reset input so same file can be selected again\n      if (fileInputRef.current) {\n        fileInputRef.current.value = ''\n      }\n    }\n  }\n\n  const handleFileUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0]\n    if (!file) return\n    await processFile(file)\n  }\n\n  const handleDragOver = (e: React.DragEvent) => {\n    e.preventDefault()\n    setIsDragging(true)\n  }\n\n  const handleDragLeave = (e: React.DragEvent) => {\n    e.preventDefault()\n    setIsDragging(false)\n  }\n\n  const handleDrop = async (e: React.DragEvent) => {\n    e.preventDefault()\n    setIsDragging(false)\n    \n    const file = e.dataTransfer.files?.[0]\n    if (!file) return\n    await processFile(file)\n  }\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-6 fade-in\">\n        <div className=\"h-8 w-48 bg-surface rounded-lg animate-pulse\" />\n        <div className=\"h-64 bg-surface rounded-2xl animate-pulse\" />\n      </div>\n    )\n  }\n\n  if (!investment) {\n    return (\n      <div className=\"text-center py-16\">\n        <p className=\"text-text-muted\">Inversión no encontrada</p>\n      </div>\n    )\n  }\n\n  const returnPositive = (investment.return_percentage || 0) >= 0\n  const status = statusConfig[investment.status] || statusConfig.active\n\n  // Credit Analysis State (for land investments)\n  const [selectedCredit, setSelectedCredit] = useState<CreditScenario>(SAMPLE_CREDITS[0])\n  \n  // Build land opportunity from investment data\n  const landOpportunity: LandOpportunity | null = useMemo(() => {\n    if (investment.category !== 'land') return null\n    return {\n      id: investment.id,\n      name: investment.name,\n      location: {\n        region: investment.state || 'Unknown',\n        city: investment.city || 'Unknown',\n        commune: investment.city || 'Unknown'\n      },\n      askingPrice: investment.purchase_price || investment.current_value || 0,\n      landAreaSquareMeters: (investment.land_area_hectares || 0) * 10000,\n      pricePerSquareMeter: investment.purchase_price && investment.land_area_hectares \n        ? investment.purchase_price / (investment.land_area_hectares * 10000)\n        : 0,\n      appraisalValue: investment.current_value || investment.purchase_price || 0,\n      belowAppraisalBy: investment.purchase_price && investment.current_value\n        ? ((investment.current_value - investment.purchase_price) / investment.current_value) * 100\n        : 0,\n      zoning: (investment.zoning_type as any) || 'residential',\n      hasBasicServices: true,\n      hasRoadAccess: true,\n      topography: 'flat',\n      expectedAppreciationAnnual: 5,\n      status: 'available',\n      listingDate: investment.purchase_date || new Date().toISOString(),\n      notes: investment.description || ''\n    }\n  }, [investment])\n\n  // Calculate analysis when we have land data\n  const creditAnalysis = useMemo(() => {\n    if (!landOpportunity || !selectedCredit) return null\n    return analyzeLandCreditCombo(landOpportunity, selectedCredit)\n  }, [landOpportunity, selectedCredit])\n\n  // Get applicable credits based on land price\n  const applicableCredits = useMemo(() => {\n    if (!landOpportunity) return []\n    return SAMPLE_CREDITS.filter(c => c.effectiveCreditAmount <= (landOpportunity.askingPrice * 0.9))\n  }, [landOpportunity])\n\n  return (\n    <div className=\"space-y-6 fade-in\">\n      {/* Header */}\n      <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4\">\n        <div className=\"flex items-start gap-4\">\n          <button \n            onClick={() => navigate('/investments')}\n            className=\"p-2 rounded-xl bg-surface border border-border hover:border-border-strong transition-colors\"\n          >\n            <ArrowLeft className=\"h-5 w-5 text-text-secondary\" />\n          </button>\n          <div>\n            <div className=\"flex items-center gap-3 flex-wrap mb-1\">\n              <span className=\"text-2xl\">{categoryIcons[investment.category] || '📦'}</span>\n              <h1 className=\"text-2xl sm:text-3xl font-bold text-text-primary tracking-tight\">\n                {investment.name}\n              </h1>\n            </div>\n            <div className=\"flex items-center gap-2 flex-wrap\">\n              <span className={`text-[10px] font-semibold tracking-wider uppercase px-2.5 py-1 rounded-full border ${status.className}`}>\n                {status.label}\n              </span>\n              {investment.city && (\n                <span className=\"flex items-center gap-1 text-sm text-text-muted\">\n                  <MapPin className=\"h-3.5 w-3.5\" />\n                  {investment.city}{investment.state ? `, ${investment.state}` : ''}\n                </span>\n              )}\n            </div>\n          </div>\n        </div>\n        \n        <div className=\"flex items-center gap-2\">\n          <button className=\"glyph-btn glyph-btn-ghost\">\n            <Edit className=\"h-4 w-4\" />\n            Editar\n          </button>\n          <button \n            onClick={() => {\n              if (confirm('¿Estás seguro de eliminar esta inversión?')) {\n                deleteMutation.mutate()\n              }\n            }}\n            className=\"glyph-btn border-error/30 text-error hover:bg-error-dim\"\n          >\n            <Trash2 className=\"h-4 w-4\" />\n          </button>\n        </div>\n      </div>\n\n      {/* Details Grid */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6\">\n        {/* Main Info */}\n        <div className=\"lg:col-span-2 space-y-4 sm:space-y-6\">\n          {/* Financial Overview */}\n          <section className=\"glass-card-elevated\">\n            <div className=\"p-4 sm:p-5 border-b border-border\">\n              <div className=\"flex items-center gap-2\">\n                <DollarSign className=\"h-4 w-4 text-cream-muted\" />\n                <span className=\"text-xs font-semibold tracking-widest text-cream-muted uppercase\">Resumen Financiero</span>\n              </div>\n            </div>\n            <div className=\"p-4 sm:p-5\">\n              <div className=\"grid grid-cols-2 gap-4 sm:gap-6\">\n                <div>\n                  <p className=\"text-xs text-text-muted uppercase tracking-wider mb-1 flex items-center gap-1\">\n                    Precio de Compra\n                    <HelpTooltip title=\"Purchase Price\" content={INVESTMENT_TOOLTIPS.purchasePrice.content} example={INVESTMENT_TOOLTIPS.purchasePrice.example} size=\"sm\" />\n                  </p>\n                  <p className=\"font-mono text-lg sm:text-xl font-semibold text-text-primary break-all\">\n                    {investment.purchase_price \n                      ? formatCurrency(investment.purchase_price)\n                      : '—'\n                    }\n                  </p>\n                </div>\n                <div>\n                  <p className=\"text-xs text-text-muted uppercase tracking-wider mb-1 flex items-center gap-1\">\n                    Valor Actual\n                    <HelpTooltip title=\"Current Value\" content={INVESTMENT_TOOLTIPS.currentValue.content} example={INVESTMENT_TOOLTIPS.currentValue.example} size=\"sm\" />\n                  </p>\n                  <p className=\"font-mono text-lg sm:text-xl font-semibold text-cream break-all\">\n                    {investment.current_value \n                      ? formatCurrency(investment.current_value)\n                      : '—'\n                    }\n                  </p>\n                </div>\n                <div>\n                  <p className=\"text-xs text-text-muted uppercase tracking-wider mb-1 flex items-center gap-1\">\n                    Retorno\n                    <HelpTooltip title=\"Return %\" content={INVESTMENT_TOOLTIPS.returnPercentage.content} example={INVESTMENT_TOOLTIPS.returnPercentage.example} size=\"sm\" />\n                  </p>\n                  <p className={`font-mono text-lg sm:text-xl font-semibold flex items-center gap-1 ${\n                    returnPositive ? 'text-success' : 'text-error'\n                  }`}>\n                    {returnPositive ? <TrendingUp className=\"h-4 w-4 flex-shrink-0\" /> : <TrendingDown className=\"h-4 w-4 flex-shrink-0\" />}\n                    {investment.return_percentage !== undefined\n                      ? `${returnPositive ? '+' : ''}${investment.return_percentage.toFixed(1)}%`\n                      : '—'\n                    }\n                  </p>\n                </div>\n                <div>\n                  <p className=\"text-xs text-text-muted uppercase tracking-wider mb-1\">Documentos</p>\n                  <p className=\"font-mono text-lg sm:text-xl font-semibold text-text-primary\">\n                    {investment.document_count || 0}\n                  </p>\n                </div>\n              </div>\n            </div>\n          </section>\n\n          {/* Description */}\n          {investment.description && (\n            <section className=\"glass-card\">\n              <div className=\"p-5\">\n                <h2 className=\"text-xs font-semibold tracking-widest text-cream-muted uppercase mb-3\">Descripción</h2>\n                <p className=\"text-sm text-text-secondary leading-relaxed\">{investment.description}</p>\n              </div>\n            </section>\n          )}\n\n          {/* Land Specific with Credit Analysis */}\n          {investment.category === 'land' && landOpportunity && (\n            <>\n              {/* Land Details */}\n              <section className=\"glass-card-elevated\">\n                <div className=\"p-4 sm:p-5 border-b border-border\">\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"text-lg\">🏞️</span>\n                    <span className=\"text-xs font-semibold tracking-widest text-cream-muted uppercase\">Detalles del Terreno</span>\n                  </div>\n                </div>\n                <div className=\"p-4 sm:p-5\">\n                  <div className=\"grid grid-cols-2 sm:grid-cols-3 gap-4 sm:gap-6\">\n                    <div>\n                      <p className=\"text-xs text-text-muted uppercase tracking-wider mb-1\">Área</p>\n                      <p className=\"font-mono text-base sm:text-lg font-semibold text-text-primary\">\n                        {investment.land_area_hectares \n                          ? `${investment.land_area_hectares} ha`\n                          : '—'\n                        }\n                      </p>\n                    </div>\n                    <div>\n                      <p className=\"text-xs text-text-muted uppercase tracking-wider mb-1\">Zonificación</p>\n                      <p className=\"font-mono text-base sm:text-lg font-semibold text-text-primary capitalize\">\n                        {investment.zoning_type || '—'}\n                      </p>\n                    </div>\n                    <div>\n                      <p className=\"text-xs text-text-muted uppercase tracking-wider mb-1\">Propiedad</p>\n                      <p className=\"font-mono text-base sm:text-lg font-semibold text-text-primary\">\n                        {investment.ownership_percentage}%\n                      </p>\n                    </div>\n                  </div>\n                </div>\n              </section>\n\n              {/* Credit Analysis Section */}\n              <section className=\"glass-card-elevated border border-cream/10\">\n                <div className=\"p-4 sm:p-5 border-b border-border\">\n                  <div className=\"flex items-center justify-between flex-wrap gap-2\">\n                    <div className=\"flex items-center gap-2\">\n                      <Calculator className=\"h-5 w-5 text-cream\" />\n                      <span className=\"text-sm font-semibold tracking-widest text-cream uppercase\">Análisis de Crédito</span>\n                    </div>\n                    <span className=\"text-xs text-text-muted\">Valor UF: {formatCurrency(CURRENT_UF_VALUE)}</span>\n                  </div>\n                </div>\n\n                <div className=\"p-4 sm:p-5 space-y-6\">\n                  {/* Warning Banner */}\n                  <div className=\"rounded-xl border border-warning/20 bg-warning-dim p-4\">\n                    <div className=\"flex items-start gap-3\">\n                      <AlertTriangle className=\"h-5 w-5 text-warning flex-shrink-0 mt-0.5\" />\n                      <div>\n                        <p className=\"text-sm text-warning font-medium\">Análisis Real del Costo del Crédito</p>\n                        <p className=\"text-xs text-text-secondary mt-1\">\n                          Los bancos anuncian montos que realmente no recibes. Selecciona un escenario de crédito para ver el \n                          <strong> costo real</strong> y los <strong>pagos mensuales</strong> para este terreno.\n                        </p>\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Credit Selector */}\n                  <div>\n                    <h4 className=\"text-xs font-semibold tracking-widest text-cream-muted uppercase mb-3 flex items-center gap-2\">\n                      <Building2 className=\"h-4 w-4\" />\n                      Seleccionar Escenario de Crédito\n                    </h4>\n                    <div className=\"flex flex-wrap gap-2\">\n                      {applicableCredits.length > 0 ? (\n                        applicableCredits.map((credit) => (\n                          <button\n                            key={credit.id}\n                            onClick={() => setSelectedCredit(credit)}\n                            className={`\n                              px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200\n                              ${selectedCredit.id === credit.id\n                                ? 'bg-cream text-void'\n                                : 'bg-surface border border-border text-text-secondary hover:text-text-primary hover:border-border-strong'\n                              }\n                            `}\n                          >\n                            <div className=\"flex flex-col items-start\">\n                              <span>{credit.bank}</span>\n                              <span className=\"text-[10px] opacity-70\">\n                                {credit.annualInterestRate}% • {credit.termYears} yrs\n                              </span>\n                            </div>\n                          </button>\n                        ))\n                      ) : (\n                        SAMPLE_CREDITS.slice(0, 3).map((credit) => (\n                          <button\n                            key={credit.id}\n                            onClick={() => setSelectedCredit(credit)}\n                            className={`\n                              px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200\n                              ${selectedCredit.id === credit.id\n                                ? 'bg-cream text-void'\n                                : 'bg-surface border border-border text-text-secondary hover:text-text-primary hover:border-border-strong'\n                              }\n                            `}\n                          >\n                            <div className=\"flex flex-col items-start\">\n                              <span>{credit.bank}</span>\n                              <span className=\"text-[10px] opacity-70\">\n                                {credit.annualInterestRate}% • {credit.termYears} yrs\n                              </span>\n                            </div>\n                          </button>\n                        ))\n                      )}\n                    </div>\n                  </div>\n\n                  {/* Quick Stats */}\n                  {creditAnalysis && (\n                    <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n                      <div className=\"rounded-xl border border-border bg-surface p-4\">\n                        <p className=\"text-xs text-text-muted uppercase tracking-wider mb-1\">Pago Mensual</p>\n                        <p className=\"font-mono text-lg font-semibold text-info\">\n                          {formatCurrency(creditAnalysis.monthlyPayment)}\n                        </p>\n                      </div>\n                      <div className=\"rounded-xl border border-border bg-surface p-4\">\n                        <p className=\"text-xs text-text-muted uppercase tracking-wider mb-1\">Efectivo Requerido</p>\n                        <p className=\"font-mono text-lg font-semibold text-warning\">\n                          {formatCurrency(creditAnalysis.cashRequired)}\n                        </p>\n                      </div>\n                      <div className=\"rounded-xl border border-border bg-surface p-4\">\n                        <p className=\"text-xs text-text-muted uppercase tracking-wider mb-1\">ROI 5 Años</p>\n                        <p className={`font-mono text-lg font-semibold ${creditAnalysis.roi5Year > 0 ? 'text-success' : 'text-error'}`}>\n                          {creditAnalysis.roi5Year > 0 ? '+' : ''}{formatPercent(creditAnalysis.roi5Year)}\n                        </p>\n                      </div>\n                      <div className=\"rounded-xl border border-border bg-surface p-4\">\n                        <p className=\"text-xs text-text-muted uppercase tracking-wider mb-1\">Puntaje</p>\n                        <div className=\"flex items-center gap-2\">\n                          <p className={`font-mono text-lg font-semibold ${\n                            creditAnalysis.score >= 70 ? 'text-success' : \n                            creditAnalysis.score >= 50 ? 'text-cream' : 'text-warning'\n                          }`}>\n                            {creditAnalysis.score}\n                          </p>\n                          {creditAnalysis.score >= 70 && (\n                            <CheckCircle className=\"h-4 w-4 text-success\" />\n                          )}\n                        </div>\n                      </div>\n                    </div>\n                  )}\n\n                  {/* Charts */}\n                  <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n                    <AmortizationChart credit={selectedCredit} />\n                    <PaymentBreakdownChart credit={selectedCredit} />\n                  </div>\n\n                  {/* Detailed Credit Truth */}\n                  <CreditTruthRevealer credit={selectedCredit} />\n                </div>\n              </section>\n            </>\n          )}\n\n          {/* Documents List */}\n          {(investment as any).documents && (investment as any).documents.length > 0 && (\n            <section className=\"glass-card-elevated\">\n              <div className=\"p-5 border-b border-border\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-2\">\n                    <FileText className=\"h-4 w-4 text-cream-muted\" />\n                    <span className=\"text-xs font-semibold tracking-widest text-cream-muted uppercase\">Documentos</span>\n                  </div>\n                  <span className=\"text-xs text-text-muted\">{(investment as any).documents.length} archivos</span>\n                </div>\n              </div>\n              <div className=\"p-2\">\n                <div className=\"space-y-1\">\n                  {(investment as any).documents.map((doc: any) => (\n                    <div \n                      key={doc.id}\n                      className=\"flex items-center justify-between p-3 rounded-xl hover:bg-surface transition-colors group\"\n                    >\n                      <div className=\"flex items-center gap-3\">\n                        <div className=\"p-2 rounded-lg bg-surface-elevated\">\n                          <FileText className=\"h-4 w-4 text-text-muted\" />\n                        </div>\n                        <div>\n                          <p className=\"text-sm font-medium text-text-primary\">{doc.filename}</p>\n                          <p className=\"text-xs text-text-muted capitalize\">{doc.document_type}</p>\n                        </div>\n                      </div>\n                      <ExternalLink className=\"h-4 w-4 text-text-muted opacity-0 group-hover:opacity-100 transition-opacity\" />\n                    </div>\n                  ))}\n                </div>\n              </div>\n            </section>\n          )}\n        </div>\n\n        {/* Sidebar */}\n        <div className=\"space-y-4 sm:space-y-6\">\n          {/* Upload Card */}\n          <section \n            className={`relative overflow-hidden rounded-2xl border-2 border-dashed p-4 sm:p-5 transition-all duration-200 ${\n              isDragging \n                ? 'border-cream bg-cream/10' \n                : 'border-cream/20 bg-gradient-to-br from-cream/10 to-surface'\n            }`}\n            onDragOver={handleDragOver}\n            onDragLeave={handleDragLeave}\n            onDrop={handleDrop}\n          >\n            <div className=\"relative\">\n              <div className=\"flex items-center gap-2 mb-3\">\n                <Upload className=\"h-4 w-4 text-cream\" />\n                <h3 className=\"font-semibold text-cream text-sm sm:text-base\">Subir Documentos</h3>\n              </div>\n              <p className=\"text-xs text-cream-muted mb-4\">\n                Arrastra archivos aquí o haz click para buscar. El análisis AI comienza automáticamente.\n              </p>\n              <input\n                ref={fileInputRef}\n                id=\"file-upload\"\n                type=\"file\"\n                className=\"hidden\"\n                onChange={handleFileUpload}\n                disabled={isUploading}\n              />\n              <label \n                htmlFor=\"file-upload\"\n                className={`glyph-btn glyph-btn-primary w-full flex items-center justify-center gap-2 py-3 ${isUploading ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer'}`}\n              >\n                <Upload className=\"h-4 w-4\" />\n                {isUploading ? 'Subiendo...' : 'Elegir Archivo'}\n              </label>\n            </div>\n          </section>\n\n          {/* Key Info */}\n          <section className=\"glass-card\">\n            <div className=\"p-4 sm:p-5 border-b border-border\">\n              <span className=\"text-xs font-semibold tracking-widest text-cream-muted uppercase\">Información Clave</span>\n            </div>\n            <div className=\"p-4 sm:p-5 space-y-3 sm:space-y-4\">\n              <div className=\"flex items-center justify-between gap-2\">\n                <span className=\"flex items-center gap-2 text-sm text-text-muted\">\n                  <Tag className=\"h-4 w-4 flex-shrink-0\" />\n                  <span className=\"truncate\">Estado</span>\n                </span>\n                <span className=\"text-sm font-medium text-text-primary capitalize\">{investment.status}</span>\n              </div>\n              <div className=\"flex items-center justify-between gap-2\">\n                <span className=\"flex items-center gap-2 text-sm text-text-muted\">\n                  <Calendar className=\"h-4 w-4 flex-shrink-0\" />\n                  <span className=\"truncate\">Fecha de Compra</span>\n                </span>\n                <span className=\"text-sm font-medium text-text-primary\">\n                  {investment.purchase_date ? formatDate(investment.purchase_date) : '—'}\n                </span>\n              </div>\n              <div className=\"flex items-center justify-between gap-2\">\n                <span className=\"flex items-center gap-2 text-sm text-text-muted\">\n                  <Calendar className=\"h-4 w-4 flex-shrink-0\" />\n                  <span className=\"truncate\">Última Actualización</span>\n                </span>\n                <span className=\"text-sm font-medium text-text-primary\">\n                  {formatDate(investment.updated_at)}\n                </span>\n              </div>\n            </div>\n            \n            {investment.tags?.length > 0 && (\n              <>\n                <div className=\"border-t border-border mx-5\" />\n                <div className=\"p-5\">\n                  <span className=\"text-xs font-semibold tracking-widest text-cream-muted uppercase block mb-3\">Etiquetas</span>\n                  <div className=\"flex flex-wrap gap-2\">\n                    {investment.tags.map((tag: string) => (\n                      <span \n                        key={tag}\n                        className=\"text-xs px-2.5 py-1 bg-surface text-text-secondary rounded-full border border-border\"\n                      >\n                        {tag}\n                      </span>\n                    ))}\n                  </div>\n                </div>\n              </>\n            )}\n          </section>\n\n          {/* Quick Actions */}\n          <section className=\"glass-card\">\n            <div className=\"p-5 border-b border-border\">\n              <span className=\"text-xs font-semibold tracking-widest text-cream-muted uppercase\">Acciones Rápidas</span>\n            </div>\n            <div className=\"p-2\">\n              <Link \n                to=\"/land-analyzer\"\n                className=\"flex items-center justify-between p-3 rounded-xl hover:bg-surface transition-colors group\"\n              >\n                <span className=\"text-sm text-text-secondary group-hover:text-text-primary\">Análisis de Crédito</span>\n                <ChevronRight className=\"h-4 w-4 text-text-muted\" />\n              </Link>\n              <Link \n                to=\"/analysis\"\n                className=\"flex items-center justify-between p-3 rounded-xl hover:bg-surface transition-colors group\"\n              >\n                <span className=\"text-sm text-text-secondary group-hover:text-text-primary\">Ver Análisis AI</span>\n                <ChevronRight className=\"h-4 w-4 text-text-muted\" />\n              </Link>\n            </div>\n          </section>\n        </div>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/hinoki/HinokiDEV/Investments/prism/web/src/pages/Investments.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Filter' is defined but never used.","line":13,"column":37,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":43},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Briefcase' is defined but never used.","line":17,"column":6,"nodeType":"Identifier","messageId":"unusedVar","endLine":17,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Shield' is defined but never used.","line":18,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":18,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Zap' is defined but never used.","line":18,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":18,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Eye' is defined but never used.","line":19,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":6},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Calendar' is defined but never used.","line":19,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ScatterChart' is defined but never used.","line":26,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":26,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Scatter' is defined but never used.","line":26,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":26,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ZAxis' is defined but never used.","line":26,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":26,"endColumn":31},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'formatNumber' is defined but never used.","line":29,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":29,"endColumn":38},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":73,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3145,3148],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3145,3148],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":78,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3446,3449],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3446,3449],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":92,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":92,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4071,4074],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4071,4074],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":113,"column":95,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":113,"endColumn":98,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4993,4996],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4993,4996],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":159,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":159,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7110,7113],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7110,7113],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":161,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":161,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7173,7176],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7173,7176],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":162,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":162,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7266,7269],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7266,7269],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":162,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":162,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7274,7277],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7274,7277],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":193,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":193,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8711,8714],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8711,8714],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'investmentsArray' conditional could make the dependencies of useMemo Hook (at line 291) change on every render. To fix this, wrap the initialization of 'investmentsArray' in its own useMemo() Hook.","line":278,"column":9,"nodeType":"VariableDeclarator","endLine":278,"endColumn":73},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'investmentsArray' conditional could make the dependencies of useMemo Hook (at line 313) change on every render. To fix this, wrap the initialization of 'investmentsArray' in its own useMemo() Hook.","line":278,"column":9,"nodeType":"VariableDeclarator","endLine":278,"endColumn":73},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'investmentsArray' conditional could make the dependencies of useMemo Hook (at line 335) change on every render. To fix this, wrap the initialization of 'investmentsArray' in its own useMemo() Hook.","line":278,"column":9,"nodeType":"VariableDeclarator","endLine":278,"endColumn":73},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'investmentsArray' conditional could make the dependencies of useMemo Hook (at line 352) change on every render. To fix this, wrap the initialization of 'investmentsArray' in its own useMemo() Hook.","line":278,"column":9,"nodeType":"VariableDeclarator","endLine":278,"endColumn":73},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'investmentsArray' conditional could make the dependencies of useMemo Hook (at line 362) change on every render. To fix this, wrap the initialization of 'investmentsArray' in its own useMemo() Hook.","line":278,"column":9,"nodeType":"VariableDeclarator","endLine":278,"endColumn":73},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'investmentsArray' conditional could make the dependencies of useMemo Hook (at line 369) change on every render. To fix this, wrap the initialization of 'investmentsArray' in its own useMemo() Hook.","line":278,"column":9,"nodeType":"VariableDeclarator","endLine":278,"endColumn":73},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'investmentsArray' conditional could make the dependencies of useMemo Hook (at line 374) change on every render. To fix this, wrap the initialization of 'investmentsArray' in its own useMemo() Hook.","line":278,"column":9,"nodeType":"VariableDeclarator","endLine":278,"endColumn":73},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":283,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":283,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12855,12858],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12855,12858],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":283,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":283,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12863,12866],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12863,12866],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":293,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":293,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13421,13424],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13421,13424],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":308,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":308,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14115,14118],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14115,14118],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":319,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":319,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14646,14649],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14646,14649],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":320,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":320,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14688,14691],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14688,14691],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":326,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":326,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14949,14952],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14949,14952],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":327,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":327,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15045,15048],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15045,15048],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":333,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":333,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15372,15375],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15372,15375],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":333,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":333,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15380,15383],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15380,15383],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":340,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":340,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15569,15572],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15569,15572],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":341,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":341,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15634,15637],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15634,15637],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":341,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":341,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15642,15645],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15642,15645],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":344,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":344,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15794,15797],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15794,15797],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":357,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":357,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16227,16230],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16227,16230],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":358,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":358,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16296,16299],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16296,16299],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":367,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":367,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16654,16657],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16654,16657],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":367,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":367,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16664,16667],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16664,16667],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":372,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":372,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16929,16932],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16929,16932],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":372,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":372,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16939,16942],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16939,16942],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":377,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":377,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17157,17160],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17157,17160],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":490,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":490,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23796,23799],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23796,23799],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":499,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":499,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24273,24276],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24273,24276],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":536,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":536,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26727,26730],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26727,26730],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":551,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":551,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27820,27823],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27820,27823],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":695,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":695,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[36709,36712],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[36709,36712],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":746,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":746,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[39843,39846],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[39843,39846],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":36,"fatalErrorCount":0,"warningCount":17,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/*\n===============================================================================\nINVERSIONES PAGE - Maximum Power Investment Dashboard\n===============================================================================\nFull-featured investment overview with portfolio health gauge, ROI heat map,\nwealth timeline, performance waterfall, category allocation, treemap,\nand enriched investment cards.\n*/\nimport { useState, useMemo } from 'react'\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\nimport { Link } from 'react-router-dom'\nimport {\n  Plus, Search, MapPin, DollarSign, Filter,\n  ChevronRight, ArrowUpRight, ArrowDownRight,\n  Grid3X3, List, TrendingUp, TrendingDown,\n  PieChart, BarChart3, Trophy, AlertTriangle,\n  X, Briefcase, Award, Target, Activity,\n  Shield, Zap, Flame, Snowflake, Crown,\n  Eye, Percent, Calendar, Layers\n} from 'lucide-react'\nimport {\n  PieChart as RechartsPie, Pie, Cell,\n  BarChart, Bar, XAxis, YAxis, CartesianGrid,\n  Tooltip as RechartsTooltip, ResponsiveContainer,\n  Treemap, AreaChart, Area, Legend,\n  ScatterChart, Scatter, ZAxis\n} from 'recharts'\nimport { investmentsApi, dashboardApi, analyticsApi } from '../lib/api'\nimport { formatCurrency, formatNumber } from '../lib/utils'\nimport { InvestmentForm, type InvestmentFormData } from '../components/InvestmentForm'\n\n// =============================================================================\n// CONSTANTS\n// =============================================================================\n\nconst categories = [\n  { value: '', label: 'Todas', icon: '🌐' },\n  { value: 'land', label: 'Terrenos', icon: '🏞️' },\n  { value: 'stocks', label: 'Acciones', icon: '📈' },\n  { value: 'gold', label: 'Oro', icon: '🪙' },\n  { value: 'crypto', label: 'Crypto', icon: '₿' },\n  { value: 'real_estate', label: 'Inmuebles', icon: '🏢' },\n  { value: 'bonds', label: 'Bonos', icon: '📜' },\n  { value: 'other', label: 'Otros', icon: '📦' },\n]\n\nconst statusConfig: Record<string, { label: string; className: string }> = {\n  active: { label: 'Activo', className: 'bg-success-dim text-success border-success/20' },\n  sold: { label: 'Vendido', className: 'bg-surface text-text-muted border-border' },\n  pending: { label: 'Pendiente', className: 'bg-warning-dim text-warning border-warning/20' },\n  under_contract: { label: 'En Contrato', className: 'bg-info-dim text-info border-info/20' },\n}\n\nconst categoryIcons: Record<string, string> = {\n  land: '🏞️', stocks: '📈', gold: '🪙', crypto: '₿',\n  real_estate: '🏢', bonds: '📜', other: '📦'\n}\n\nconst categoryLabels: Record<string, string> = {\n  land: 'Terrenos', stocks: 'Acciones', gold: 'Oro', crypto: 'Crypto',\n  real_estate: 'Inmuebles', bonds: 'Bonos', other: 'Otros'\n}\n\nconst CATEGORY_COLORS: Record<string, string> = {\n  land: '#7fb069', stocks: '#6b8cae', gold: '#d4a373', crypto: '#8b7ec8',\n  real_estate: '#e8d5c4', bonds: '#5bbdb4', other: '#a89482',\n}\n\n// =============================================================================\n// UTILITY COMPONENTS\n// =============================================================================\n\nfunction CustomTooltip({ active, payload, label }: any) {\n  if (!active || !payload?.length) return null\n  return (\n    <div className=\"bg-surface-elevated border border-border rounded-xl px-4 py-3 shadow-xl backdrop-blur-xl\">\n      {label && <p className=\"text-xs text-text-muted uppercase tracking-wider mb-1\">{label}</p>}\n      {payload.map((entry: any, i: number) => (\n        <div key={i} className=\"flex items-center gap-2\">\n          <span className=\"w-2 h-2 rounded-full\" style={{ backgroundColor: entry.color || entry.fill }} />\n          <span className=\"text-sm text-text-primary font-medium\">\n            {entry.name}: {typeof entry.value === 'number' && entry.name?.toLowerCase().includes('roi')\n              ? `${entry.value.toFixed(1)}%`\n              : typeof entry.value === 'number' ? formatCurrency(entry.value) : entry.value}\n          </span>\n        </div>\n      ))}\n    </div>\n  )\n}\n\nfunction TreemapContent({ x, y, width, height, name, value, color }: any) {\n  if (width < 50 || height < 30) return null\n  return (\n    <g>\n      <rect x={x} y={y} width={width} height={height} rx={8}\n        fill={color} fillOpacity={0.85} stroke=\"rgba(10,10,10,0.5)\" strokeWidth={2}\n        className=\"transition-all duration-300 hover:fill-opacity-100\" />\n      {width > 70 && height > 50 && (\n        <>\n          <text x={x + width / 2} y={y + height / 2 - 8} textAnchor=\"middle\"\n            fill=\"#0a0a0a\" fontSize={width > 120 ? 13 : 11} fontWeight={700}\n            fontFamily=\"Inter, system-ui, sans-serif\">{name}</text>\n          <text x={x + width / 2} y={y + height / 2 + 12} textAnchor=\"middle\"\n            fill=\"rgba(10,10,10,0.7)\" fontSize={width > 120 ? 11 : 9}\n            fontFamily=\"JetBrains Mono, monospace\">{formatCurrency(value)}</text>\n        </>\n      )}\n    </g>\n  )\n}\n\nfunction renderCustomizedLabel({ cx, cy, midAngle, innerRadius, outerRadius, percent, name }: any) {\n  const RADIAN = Math.PI / 180\n  const radius = innerRadius + (outerRadius - innerRadius) * 1.4\n  const x = cx + radius * Math.cos(-midAngle * RADIAN)\n  const y = cy + radius * Math.sin(-midAngle * RADIAN)\n  if (percent < 0.05) return null\n  return (\n    <text x={x} y={y} fill=\"#f5f2ed\" textAnchor={x > cx ? 'start' : 'end'}\n      dominantBaseline=\"central\" fontSize={11} fontFamily=\"Inter, system-ui, sans-serif\">\n      {`${categoryLabels[name] || name} ${(percent * 100).toFixed(0)}%`}\n    </text>\n  )\n}\n\n// =============================================================================\n// PORTFOLIO HEALTH GAUGE\n// =============================================================================\n\nfunction PortfolioHealthGauge({ score, label }: { score: number; label: string }) {\n  const circumference = 2 * Math.PI * 45\n  const offset = circumference - (score / 100) * circumference\n  const color = score >= 75 ? '#7fb069' : score >= 50 ? '#d4a373' : '#c76b6b'\n\n  return (\n    <div className=\"flex flex-col items-center\">\n      <div className=\"relative w-28 h-28\">\n        <svg viewBox=\"0 0 100 100\" className=\"w-full h-full -rotate-90\">\n          <circle cx=\"50\" cy=\"50\" r=\"45\" fill=\"none\" stroke=\"rgba(232,213,196,0.06)\" strokeWidth=\"8\" />\n          <circle cx=\"50\" cy=\"50\" r=\"45\" fill=\"none\" stroke={color} strokeWidth=\"8\"\n            strokeLinecap=\"round\" strokeDasharray={circumference} strokeDashoffset={offset}\n            className=\"gauge-arc\" />\n        </svg>\n        <div className=\"absolute inset-0 flex flex-col items-center justify-center\">\n          <span className=\"font-mono text-2xl font-bold\" style={{ color }}>{score}</span>\n          <span className=\"text-[9px] text-text-muted uppercase tracking-wider\">/ 100</span>\n        </div>\n      </div>\n      <span className=\"text-xs text-text-muted mt-2 uppercase tracking-wider\">{label}</span>\n    </div>\n  )\n}\n\n// =============================================================================\n// ROI HEAT MAP\n// =============================================================================\n\nfunction RoiHeatMap({ investments }: { investments: any[] }) {\n  const sorted = [...investments]\n    .filter((inv: any) => inv.return_percentage !== undefined && inv.return_percentage !== null)\n    .sort((a: any, b: any) => (b.return_percentage || 0) - (a.return_percentage || 0))\n\n  if (sorted.length === 0) return null\n\n  const getHeatColor = (roi: number) => {\n    if (roi >= 50) return 'bg-emerald-500/80 text-white'\n    if (roi >= 20) return 'bg-emerald-600/60 text-white'\n    if (roi >= 10) return 'bg-emerald-700/40 text-emerald-100'\n    if (roi >= 0) return 'bg-emerald-900/30 text-emerald-200'\n    if (roi >= -10) return 'bg-red-900/30 text-red-200'\n    if (roi >= -20) return 'bg-red-700/40 text-red-100'\n    return 'bg-red-500/60 text-white'\n  }\n\n  return (\n    <section className=\"glass-card-elevated overflow-hidden\">\n      <div className=\"p-5 border-b border-border flex items-center gap-2\">\n        <Flame className=\"h-4 w-4 text-cream-muted\" />\n        <span className=\"text-xs font-semibold tracking-widest text-cream-muted uppercase\">\n          Mapa de Calor ROI\n        </span>\n        <div className=\"ml-auto flex items-center gap-1 text-[9px] text-text-muted\">\n          <Snowflake className=\"h-3 w-3 text-red-400\" />\n          <span>Frío</span>\n          <div className=\"w-16 h-1.5 rounded-full bg-gradient-to-r from-red-500 via-yellow-500 to-emerald-500 mx-1\" />\n          <span>Caliente</span>\n          <Flame className=\"h-3 w-3 text-emerald-400\" />\n        </div>\n      </div>\n      <div className=\"p-4\">\n        <div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-2\">\n          {sorted.map((inv: any, i: number) => (\n            <Link key={inv.id} to={`/investments/${inv.id}`}\n              className={`heat-cell relative rounded-xl p-3 ${getHeatColor(inv.return_percentage || 0)} cursor-pointer group`}\n              style={{ animationDelay: `${i * 40}ms` }}>\n              <div className=\"flex items-center gap-1 mb-1\">\n                <span className=\"text-xs\">{categoryIcons[inv.category] || '📦'}</span>\n                <span className=\"text-[10px] font-semibold truncate\">{inv.name}</span>\n              </div>\n              <div className=\"font-mono text-lg font-bold\">\n                {(inv.return_percentage || 0) >= 0 ? '+' : ''}{(inv.return_percentage || 0).toFixed(1)}%\n              </div>\n              <div className=\"text-[9px] opacity-70 font-mono\">{formatCurrency(inv.current_value || 0)}</div>\n            </Link>\n          ))}\n        </div>\n      </div>\n    </section>\n  )\n}\n\n// =============================================================================\n// ADD INVESTMENT MODAL\n// =============================================================================\n\nfunction AddInvestmentModal({ isOpen, onClose }: { isOpen: boolean; onClose: () => void }) {\n  const queryClient = useQueryClient()\n  const createMutation = useMutation({\n    mutationFn: (data: InvestmentFormData) => investmentsApi.create(data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['investments'] })\n      queryClient.invalidateQueries({ queryKey: ['dashboard-stats'] })\n      queryClient.invalidateQueries({ queryKey: ['category-breakdown'] })\n      queryClient.invalidateQueries({ queryKey: ['portfolio-summary'] })\n      onClose()\n    },\n  })\n  if (!isOpen) return null\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4\">\n      <div className=\"absolute inset-0 bg-void/80 backdrop-blur-sm\" onClick={onClose} />\n      <div className=\"relative w-full max-w-2xl max-h-[90vh] overflow-y-auto bg-surface border border-border rounded-2xl shadow-2xl\">\n        <div className=\"sticky top-0 z-10 bg-surface border-b border-border p-5 flex items-center justify-between rounded-t-2xl\">\n          <div>\n            <h2 className=\"text-lg font-bold text-text-primary\">Nueva Inversión</h2>\n            <p className=\"text-xs text-text-muted mt-0.5\">Agrega un nuevo activo a tu portafolio</p>\n          </div>\n          <button onClick={onClose} className=\"p-2 rounded-lg hover:bg-surface-elevated text-text-muted hover:text-text-primary transition-colors\">\n            <X className=\"h-5 w-5\" />\n          </button>\n        </div>\n        <div className=\"p-5\">\n          <InvestmentForm mode=\"create\" onSubmit={(data) => createMutation.mutate(data)}\n            onCancel={onClose} isSubmitting={createMutation.isPending} />\n        </div>\n      </div>\n    </div>\n  )\n}\n\n// =============================================================================\n// MAIN INVESTMENTS PAGE\n// =============================================================================\n\nexport default function Investments() {\n  const [search, setSearch] = useState('')\n  const [category, setCategory] = useState('')\n  const [viewMode, setViewMode] = useState<'list' | 'grid'>('list')\n  const [showAddModal, setShowAddModal] = useState(false)\n  const [sortBy, setSortBy] = useState<'value' | 'return' | 'name'>('value')\n  const [sortDir, setSortDir] = useState<'asc' | 'desc'>('desc')\n\n  // Data queries\n  const { data: investments, isLoading: investmentsLoading } = useQuery({\n    queryKey: ['investments'], queryFn: () => investmentsApi.list(),\n  })\n  const { data: stats } = useQuery({\n    queryKey: ['dashboard-stats'], queryFn: dashboardApi.getStats,\n  })\n  const { data: breakdownData } = useQuery({\n    queryKey: ['category-breakdown'], queryFn: dashboardApi.getCategoryBreakdown,\n  })\n  const { data: portfolioData } = useQuery({\n    queryKey: ['portfolio-summary'], queryFn: () => analyticsApi.getPortfolioSummary(),\n  })\n\n  const investmentsArray = Array.isArray(investments) ? investments : []\n\n  // Sort & filter\n  const sortedInvestments = useMemo(() => {\n    const arr = [...investmentsArray]\n    arr.sort((a: any, b: any) => {\n      let aVal: number, bVal: number\n      if (sortBy === 'value') { aVal = a.current_value || 0; bVal = b.current_value || 0 }\n      else if (sortBy === 'return') { aVal = a.return_percentage || 0; bVal = b.return_percentage || 0 }\n      else { return sortDir === 'asc' ? (a.name || '').localeCompare(b.name || '') : (b.name || '').localeCompare(a.name || '') }\n      return sortDir === 'asc' ? aVal - bVal : bVal - aVal\n    })\n    return arr\n  }, [investmentsArray, sortBy, sortDir])\n\n  const filteredInvestments = sortedInvestments.filter((inv: any) => {\n    const matchesSearch = inv.name?.toLowerCase().includes(search.toLowerCase()) || inv.city?.toLowerCase().includes(search.toLowerCase())\n    const matchesCategory = !category || inv.category === category\n    return matchesSearch && matchesCategory\n  })\n\n  // Computed metrics\n  const totalValue = stats?.total_value || 0\n  const totalInvested = stats?.total_invested || 0\n  const totalReturn = stats?.total_return || 0\n  const totalReturnPct = stats?.total_return_pct || 0\n  const totalCount = investmentsArray.length\n\n  // Portfolio health score (diversification + return + count)\n  const healthScore = useMemo(() => {\n    const uniqueCategories = new Set(investmentsArray.map((i: any) => i.category)).size\n    const diversification = Math.min(uniqueCategories / 5 * 40, 40)\n    const returnScore = Math.min(Math.max(totalReturnPct + 10, 0) / 30 * 35, 35)\n    const countScore = Math.min(totalCount / 10 * 25, 25)\n    return Math.round(diversification + returnScore + countScore)\n  }, [investmentsArray, totalReturnPct, totalCount])\n\n  // Category breakdown for pie chart\n  const categoryPieData = useMemo(() => {\n    if (!breakdownData?.breakdown) return []\n    return breakdownData.breakdown\n      .filter((b: any) => b.total_value > 0)\n      .map((b: any) => ({ name: b.category, value: b.total_value, count: b.count, fill: CATEGORY_COLORS[b.category] || '#a89482' }))\n  }, [breakdownData])\n\n  // Performance bar chart\n  const performanceBarData = useMemo(() => {\n    return investmentsArray\n      .filter((inv: any) => inv.return_percentage !== undefined && inv.return_percentage !== null)\n      .map((inv: any) => ({\n        name: inv.name?.length > 18 ? inv.name.substring(0, 18) + '…' : inv.name,\n        fullName: inv.name, roi: inv.return_percentage || 0,\n        value: inv.current_value || 0, invested: inv.purchase_price || 0,\n        fill: (inv.return_percentage || 0) >= 0 ? '#7fb069' : '#c76b6b',\n      }))\n      .sort((a: any, b: any) => b.roi - a.roi)\n      .slice(0, 12)\n  }, [investmentsArray])\n\n  // Wealth timeline\n  const wealthTimeline = useMemo(() => {\n    const timeline = investmentsArray\n      .filter((inv: any) => inv.purchase_date && inv.purchase_price)\n      .sort((a: any, b: any) => new Date(a.purchase_date).getTime() - new Date(b.purchase_date).getTime())\n\n    let cumInvested = 0, cumValue = 0\n    return timeline.map((inv: any) => {\n      cumInvested += inv.purchase_price || 0\n      cumValue += inv.current_value || 0\n      return {\n        date: new Date(inv.purchase_date).toLocaleDateString('es-CL', { month: 'short', year: '2-digit' }),\n        invertido: cumInvested, valor: cumValue, name: inv.name,\n      }\n    })\n  }, [investmentsArray])\n\n  // Treemap data\n  const flatTreemapData = useMemo(() => {\n    return investmentsArray\n      .filter((inv: any) => inv.current_value && inv.current_value > 0)\n      .map((inv: any) => ({\n        name: inv.name?.length > 20 ? inv.name.substring(0, 20) + '…' : inv.name,\n        value: inv.current_value, color: CATEGORY_COLORS[inv.category] || '#a89482',\n      }))\n  }, [investmentsArray])\n\n  // Top & worst\n  const topPerformer = useMemo(() => {\n    if (!investmentsArray.length) return null\n    return investmentsArray.reduce((best: any, inv: any) =>\n      (inv.return_percentage || 0) > (best.return_percentage || 0) ? inv : best, investmentsArray[0])\n  }, [investmentsArray])\n  const worstPerformer = useMemo(() => {\n    if (!investmentsArray.length) return null\n    return investmentsArray.reduce((worst: any, inv: any) =>\n      (inv.return_percentage || 0) < (worst.return_percentage || 0) ? inv : worst, investmentsArray[0])\n  }, [investmentsArray])\n\n  // Active vs passive income\n  const activeCount = investmentsArray.filter((i: any) => i.status === 'active').length\n  const portfolio = portfolioData?.data\n\n  const toggleSort = (field: 'value' | 'return' | 'name') => {\n    if (sortBy === field) { setSortDir(d => d === 'asc' ? 'desc' : 'asc') }\n    else { setSortBy(field); setSortDir('desc') }\n  }\n\n  return (\n    <div className=\"space-y-6 fade-in\">\n\n      {/* ================================================================= */}\n      {/* WEALTH PULSE HERO                                                 */}\n      {/* ================================================================= */}\n      <div className=\"relative overflow-hidden rounded-3xl border border-border bg-gradient-to-br from-surface-elevated via-surface to-void p-6 sm:p-8 wealth-pulse\">\n        <div className=\"absolute inset-0 bg-glyph-pattern bg-glyph opacity-30\" />\n        <div className=\"absolute -right-20 -top-20 w-64 h-64 bg-cream/5 rounded-full blur-3xl\" />\n        <div className=\"absolute -left-10 -bottom-10 w-48 h-48 bg-cream/3 rounded-full blur-2xl\" />\n        <div className=\"absolute right-10 bottom-10 w-32 h-32 bg-success/3 rounded-full blur-2xl\" />\n\n        <div className=\"relative\">\n          <div className=\"flex flex-col lg:flex-row lg:items-start lg:justify-between gap-6\">\n            {/* Left side: metrics */}\n            <div className=\"flex-1\">\n              <div className=\"flex items-center gap-2 mb-1\">\n                <Crown className=\"h-5 w-5 text-cream\" />\n                <h1 className=\"text-xl sm:text-2xl font-bold text-text-primary tracking-tight\">\n                  Patrimonio de Inversiones\n                </h1>\n              </div>\n              <p className=\"text-sm text-text-muted mb-5\">\n                {totalCount} activo{totalCount !== 1 ? 's' : ''} · {activeCount} activo{activeCount !== 1 ? 's' : ''} en portafolio\n              </p>\n\n              {/* Big number */}\n              <div className=\"mb-6\">\n                <span className=\"text-3xs font-semibold tracking-widest text-cream-muted uppercase\">Valor Total Neto</span>\n                <p className=\"font-mono text-4xl sm:text-5xl font-bold number-shimmer tracking-tight mt-1\">\n                  {formatCurrency(totalValue)}\n                </p>\n              </div>\n\n              {/* Metrics row */}\n              <div className=\"grid grid-cols-2 sm:grid-cols-3 gap-3\">\n                <div className=\"rounded-xl border border-border bg-surface/60 p-3\">\n                  <div className=\"flex items-center gap-1.5 mb-1\">\n                    <Target className=\"h-3 w-3 text-text-muted\" />\n                    <span className=\"text-[10px] font-semibold tracking-widest text-text-muted uppercase\">Invertido</span>\n                  </div>\n                  <p className=\"font-mono text-lg font-bold text-text-primary\">{formatCurrency(totalInvested)}</p>\n                </div>\n\n                <div className={`rounded-xl border p-3 ${totalReturn >= 0 ? 'border-success/15 bg-success/5' : 'border-error/15 bg-error/5'}`}>\n                  <div className=\"flex items-center gap-1.5 mb-1\">\n                    {totalReturn >= 0 ? <TrendingUp className=\"h-3 w-3 text-success\" /> : <TrendingDown className=\"h-3 w-3 text-error\" />}\n                    <span className=\"text-[10px] font-semibold tracking-widest text-text-muted uppercase\">Ganancia</span>\n                  </div>\n                  <p className={`font-mono text-lg font-bold ${totalReturn >= 0 ? 'text-success' : 'text-error'}`}>\n                    {totalReturn >= 0 ? '+' : ''}{formatCurrency(totalReturn)}\n                  </p>\n                </div>\n\n                <div className={`rounded-xl border p-3 ${totalReturnPct >= 0 ? 'border-success/15 bg-success/5' : 'border-error/15 bg-error/5'}`}>\n                  <div className=\"flex items-center gap-1.5 mb-1\">\n                    <Percent className=\"h-3 w-3 text-text-muted\" />\n                    <span className=\"text-[10px] font-semibold tracking-widest text-text-muted uppercase\">ROI</span>\n                  </div>\n                  <p className={`font-mono text-lg font-bold ${totalReturnPct >= 0 ? 'text-success' : 'text-error'}`}>\n                    {totalReturnPct >= 0 ? '+' : ''}{totalReturnPct.toFixed(2)}%\n                  </p>\n                </div>\n              </div>\n            </div>\n\n            {/* Right side: health gauge + add button */}\n            <div className=\"flex flex-col items-center gap-4\">\n              <PortfolioHealthGauge score={healthScore} label=\"Salud del Portafolio\" />\n              <button onClick={() => setShowAddModal(true)}\n                className=\"glyph-btn glyph-btn-primary flex items-center gap-2 whitespace-nowrap\">\n                <Plus className=\"h-4 w-4\" /> Nueva Inversión\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* ================================================================= */}\n      {/* ROI HEAT MAP                                                      */}\n      {/* ================================================================= */}\n      {investmentsArray.length > 0 && <RoiHeatMap investments={investmentsArray} />}\n\n      {/* ================================================================= */}\n      {/* CHARTS ROW 1: Allocation + Performance                           */}\n      {/* ================================================================= */}\n      {investmentsArray.length > 0 && (\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n          {/* Category Allocation Donut */}\n          {categoryPieData.length > 0 && (\n            <section className=\"glass-card-elevated overflow-hidden\">\n              <div className=\"p-5 border-b border-border flex items-center gap-2\">\n                <PieChart className=\"h-4 w-4 text-cream-muted\" />\n                <span className=\"text-xs font-semibold tracking-widest text-cream-muted uppercase\">\n                  Distribución por Categoría\n                </span>\n              </div>\n              <div className=\"p-4\">\n                <div className=\"flex flex-col md:flex-row items-center gap-4\">\n                  <div className=\"w-full md:w-1/2\" style={{ height: 260 }}>\n                    <ResponsiveContainer width=\"100%\" height=\"100%\">\n                      <RechartsPie>\n                        <Pie data={categoryPieData} cx=\"50%\" cy=\"50%\" innerRadius={55} outerRadius={95}\n                          paddingAngle={3} dataKey=\"value\" nameKey=\"name\" label={renderCustomizedLabel}\n                          labelLine={false} animationBegin={0} animationDuration={1200} animationEasing=\"ease-out\">\n                          {categoryPieData.map((entry: any, i: number) => (\n                            <Cell key={i} fill={entry.fill} stroke=\"rgba(10,10,10,0.5)\" strokeWidth={2} />\n                          ))}\n                        </Pie>\n                        <RechartsTooltip content={<CustomTooltip />} />\n                      </RechartsPie>\n                    </ResponsiveContainer>\n                  </div>\n                  <div className=\"w-full md:w-1/2 space-y-2\">\n                    {categoryPieData.map((entry: any, i: number) => (\n                      <div key={i} className=\"flex items-center justify-between p-2.5 rounded-lg hover:bg-surface/50 transition-colors group cursor-default\">\n                        <div className=\"flex items-center gap-2.5\">\n                          <span className=\"w-3 h-3 rounded-full flex-shrink-0\" style={{ backgroundColor: entry.fill }} />\n                          <span className=\"text-sm text-text-secondary group-hover:text-text-primary transition-colors\">\n                            {categoryIcons[entry.name]} {categoryLabels[entry.name] || entry.name}\n                          </span>\n                        </div>\n                        <div className=\"text-right\">\n                          <span className=\"text-sm font-mono text-cream font-medium\">{formatCurrency(entry.value)}</span>\n                          <span className=\"text-xs text-text-muted ml-2\">({entry.count})</span>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              </div>\n            </section>\n          )}\n\n          {/* Performance Waterfall */}\n          {performanceBarData.length > 0 && (\n            <section className=\"glass-card-elevated overflow-hidden\">\n              <div className=\"p-5 border-b border-border flex items-center gap-2\">\n                <BarChart3 className=\"h-4 w-4 text-cream-muted\" />\n                <span className=\"text-xs font-semibold tracking-widest text-cream-muted uppercase\">\n                  Rendimiento por Inversión (ROI%)\n                </span>\n              </div>\n              <div className=\"p-4\" style={{ height: 300 }}>\n                <ResponsiveContainer width=\"100%\" height=\"100%\">\n                  <BarChart data={performanceBarData} layout=\"vertical\" margin={{ top: 5, right: 20, bottom: 5, left: 5 }}>\n                    <CartesianGrid horizontal={false} stroke=\"rgba(232, 213, 196, 0.06)\" />\n                    <XAxis type=\"number\" tick={{ fill: '#8a8279', fontSize: 11, fontFamily: 'JetBrains Mono' }}\n                      axisLine={{ stroke: 'rgba(232, 213, 196, 0.1)' }} tickFormatter={(v: number) => `${v.toFixed(0)}%`} />\n                    <YAxis type=\"category\" dataKey=\"name\" tick={{ fill: '#8a8279', fontSize: 11, fontFamily: 'Inter' }}\n                      axisLine={false} tickLine={false} width={130} />\n                    <RechartsTooltip content={({ active, payload }: any) => {\n                      if (!active || !payload?.length) return null\n                      const d = payload[0].payload\n                      return (\n                        <div className=\"bg-surface-elevated border border-border rounded-xl px-4 py-3 shadow-xl\">\n                          <p className=\"text-sm font-semibold text-text-primary mb-1\">{d.fullName}</p>\n                          <p className=\"text-xs text-text-secondary\">\n                            ROI: <span className={`font-mono font-semibold ${d.roi >= 0 ? 'text-success' : 'text-error'}`}>\n                              {d.roi >= 0 ? '+' : ''}{d.roi.toFixed(2)}%</span>\n                          </p>\n                          <p className=\"text-xs text-text-secondary\">Valor: <span className=\"font-mono text-cream\">{formatCurrency(d.value)}</span></p>\n                        </div>\n                      )\n                    }} />\n                    <Bar dataKey=\"roi\" name=\"ROI\" radius={[0, 6, 6, 0]} animationDuration={1200} animationEasing=\"ease-out\">\n                      {performanceBarData.map((entry: any, i: number) => (\n                        <Cell key={i} fill={entry.fill} fillOpacity={0.85} />\n                      ))}\n                    </Bar>\n                  </BarChart>\n                </ResponsiveContainer>\n              </div>\n            </section>\n          )}\n        </div>\n      )}\n\n      {/* ================================================================= */}\n      {/* CHARTS ROW 2: Wealth Timeline + Treemap                          */}\n      {/* ================================================================= */}\n      {investmentsArray.length > 0 && (\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n          {/* Wealth Timeline */}\n          {wealthTimeline.length > 1 && (\n            <section className=\"lg:col-span-2 glass-card-elevated overflow-hidden\">\n              <div className=\"p-5 border-b border-border flex items-center gap-2\">\n                <Activity className=\"h-4 w-4 text-cream-muted\" />\n                <span className=\"text-xs font-semibold tracking-widest text-cream-muted uppercase\">\n                  Evolución del Patrimonio\n                </span>\n              </div>\n              <div className=\"p-4\" style={{ height: 280 }}>\n                <ResponsiveContainer width=\"100%\" height=\"100%\">\n                  <AreaChart data={wealthTimeline} margin={{ top: 5, right: 20, bottom: 5, left: 5 }}>\n                    <defs>\n                      <linearGradient id=\"colorValor\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                        <stop offset=\"5%\" stopColor=\"#e8d5c4\" stopOpacity={0.3} />\n                        <stop offset=\"95%\" stopColor=\"#e8d5c4\" stopOpacity={0.02} />\n                      </linearGradient>\n                      <linearGradient id=\"colorInvertido\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                        <stop offset=\"5%\" stopColor=\"#6b8cae\" stopOpacity={0.2} />\n                        <stop offset=\"95%\" stopColor=\"#6b8cae\" stopOpacity={0.02} />\n                      </linearGradient>\n                    </defs>\n                    <CartesianGrid strokeDasharray=\"3 3\" stroke=\"rgba(232,213,196,0.06)\" />\n                    <XAxis dataKey=\"date\" tick={{ fill: '#8a8279', fontSize: 10 }} axisLine={false} tickLine={false} />\n                    <YAxis tick={{ fill: '#8a8279', fontSize: 10, fontFamily: 'JetBrains Mono' }}\n                      axisLine={false} tickLine={false} tickFormatter={(v: number) => `$${(v / 1e6).toFixed(1)}M`} />\n                    <RechartsTooltip content={<CustomTooltip />} />\n                    <Area type=\"monotone\" dataKey=\"invertido\" name=\"Invertido\" stroke=\"#6b8cae\" fill=\"url(#colorInvertido)\"\n                      strokeWidth={2} animationDuration={1500} />\n                    <Area type=\"monotone\" dataKey=\"valor\" name=\"Valor Actual\" stroke=\"#e8d5c4\" fill=\"url(#colorValor)\"\n                      strokeWidth={2} animationDuration={1500} />\n                    <Legend wrapperStyle={{ fontSize: 11, color: '#8a8279' }} />\n                  </AreaChart>\n                </ResponsiveContainer>\n              </div>\n            </section>\n          )}\n\n          {/* Top & Worst + CAGR */}\n          <section className=\"glass-card-elevated overflow-hidden\">\n            <div className=\"p-5 border-b border-border flex items-center gap-2\">\n              <Trophy className=\"h-4 w-4 text-cream-muted\" />\n              <span className=\"text-xs font-semibold tracking-widest text-cream-muted uppercase\">Destacados</span>\n            </div>\n            <div className=\"p-4 space-y-4\">\n              {topPerformer && (\n                <Link to={`/investments/${topPerformer.id}`}\n                  className=\"block p-4 rounded-xl border border-success/15 bg-success/5 hover:border-success/25 transition-all duration-200 group\">\n                  <div className=\"flex items-center gap-2 mb-2\">\n                    <Award className=\"h-4 w-4 text-success\" />\n                    <span className=\"text-2xs font-semibold tracking-widest text-success uppercase\">Mejor Rendimiento</span>\n                  </div>\n                  <p className=\"text-sm font-semibold text-text-primary group-hover:text-cream transition-colors truncate\">\n                    {categoryIcons[topPerformer.category]} {topPerformer.name}\n                  </p>\n                  <div className=\"flex items-center justify-between mt-2\">\n                    <span className=\"font-mono text-lg font-bold text-success\">\n                      {topPerformer.return_percentage !== undefined ? `${topPerformer.return_percentage >= 0 ? '+' : ''}${topPerformer.return_percentage.toFixed(1)}%` : '—'}\n                    </span>\n                    <span className=\"font-mono text-sm text-cream\">{topPerformer.current_value ? formatCurrency(topPerformer.current_value) : '—'}</span>\n                  </div>\n                </Link>\n              )}\n              {worstPerformer && worstPerformer.id !== topPerformer?.id && (\n                <Link to={`/investments/${worstPerformer.id}`}\n                  className=\"block p-4 rounded-xl border border-border bg-surface/40 hover:border-border-strong transition-all duration-200 group\">\n                  <div className=\"flex items-center gap-2 mb-2\">\n                    <AlertTriangle className=\"h-4 w-4 text-warning\" />\n                    <span className=\"text-2xs font-semibold tracking-widest text-text-muted uppercase\">Menor Rendimiento</span>\n                  </div>\n                  <p className=\"text-sm font-semibold text-text-primary group-hover:text-cream transition-colors truncate\">\n                    {categoryIcons[worstPerformer.category]} {worstPerformer.name}\n                  </p>\n                  <div className=\"flex items-center justify-between mt-2\">\n                    <span className={`font-mono text-lg font-bold ${(worstPerformer.return_percentage || 0) >= 0 ? 'text-success' : 'text-error'}`}>\n                      {worstPerformer.return_percentage !== undefined ? `${worstPerformer.return_percentage >= 0 ? '+' : ''}${worstPerformer.return_percentage.toFixed(1)}%` : '—'}\n                    </span>\n                    <span className=\"font-mono text-sm text-cream\">{worstPerformer.current_value ? formatCurrency(worstPerformer.current_value) : '—'}</span>\n                  </div>\n                </Link>\n              )}\n              {portfolio && (\n                <div className=\"p-4 rounded-xl border border-border bg-surface/40\">\n                  <div className=\"flex items-center gap-2 mb-3\">\n                    <Activity className=\"h-4 w-4 text-info\" />\n                    <span className=\"text-2xs font-semibold tracking-widest text-text-muted uppercase\">CAGR Ponderado</span>\n                  </div>\n                  <p className=\"font-mono text-2xl font-bold text-cream\">\n                    {portfolio.summary.weighted_cagr !== null ? `${portfolio.summary.weighted_cagr.toFixed(2)}%` : 'N/A'}\n                  </p>\n                  <p className=\"text-xs text-text-muted mt-1\">Tasa de crecimiento anual compuesta</p>\n                </div>\n              )}\n            </div>\n          </section>\n        </div>\n      )}\n\n      {/* Treemap */}\n      {flatTreemapData.length > 0 && (\n        <section className=\"glass-card-elevated overflow-hidden\">\n          <div className=\"p-5 border-b border-border flex items-center gap-2\">\n            <Layers className=\"h-4 w-4 text-cream-muted\" />\n            <span className=\"text-xs font-semibold tracking-widest text-cream-muted uppercase\">\n              Mapa de Valor del Portafolio\n            </span>\n          </div>\n          <div className=\"p-4\" style={{ height: 260 }}>\n            <ResponsiveContainer width=\"100%\" height=\"100%\">\n              <Treemap data={flatTreemapData} dataKey=\"value\" nameKey=\"name\"\n                aspectRatio={4 / 3} animationDuration={800} content={<TreemapContent />} />\n            </ResponsiveContainer>\n          </div>\n        </section>\n      )}\n\n      {/* ================================================================= */}\n      {/* FILTERS & SEARCH                                                 */}\n      {/* ================================================================= */}\n      <div className=\"space-y-4\">\n        <div className=\"flex flex-wrap gap-2\">\n          {categories.map((c) => (\n            <button key={c.value} onClick={() => setCategory(c.value)}\n              className={`flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm font-medium transition-all duration-200 ${category === c.value\n                ? 'bg-cream text-void shadow-glow' : 'bg-surface border border-border text-text-secondary hover:text-text-primary hover:border-border-strong'}`}>\n              <span>{c.icon}</span><span>{c.label}</span>\n              {c.value && (<span className={`text-xs ${category === c.value ? 'text-void/60' : 'text-text-muted'}`}>\n                {investmentsArray.filter((inv: any) => inv.category === c.value).length}</span>)}\n            </button>\n          ))}\n        </div>\n\n        <div className=\"glass-card p-4\">\n          <div className=\"flex flex-col sm:flex-row gap-4\">\n            <div className=\"flex-1 relative\">\n              <Search className=\"absolute left-4 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted\" />\n              <input type=\"text\" placeholder=\"Buscar inversiones...\" value={search}\n                onChange={(e) => setSearch(e.target.value)} className=\"input-field pl-11\" />\n            </div>\n            <div className=\"flex items-center gap-3\">\n              <div className=\"flex items-center gap-1 text-xs\">\n                <span className=\"text-text-muted mr-1\">Ordenar:</span>\n                {([{ key: 'value' as const, label: 'Valor' }, { key: 'return' as const, label: 'ROI' }, { key: 'name' as const, label: 'Nombre' }] as const).map(s => (\n                  <button key={s.key} onClick={() => toggleSort(s.key)}\n                    className={`px-2 py-1 rounded-md transition-colors ${sortBy === s.key ? 'bg-cream/10 text-cream' : 'text-text-muted hover:text-text-primary'}`}>\n                    {s.label}{sortBy === s.key && <span className=\"ml-0.5\">{sortDir === 'desc' ? '↓' : '↑'}</span>}\n                  </button>\n                ))}\n              </div>\n              <div className=\"flex items-center bg-surface rounded-lg p-1 border border-border\">\n                <button onClick={() => setViewMode('list')} className={`p-2 rounded-md transition-colors ${viewMode === 'list' ? 'bg-cream/10 text-cream' : 'text-text-muted hover:text-text-primary'}`}>\n                  <List className=\"h-4 w-4\" /></button>\n                <button onClick={() => setViewMode('grid')} className={`p-2 rounded-md transition-colors ${viewMode === 'grid' ? 'bg-cream/10 text-cream' : 'text-text-muted hover:text-text-primary'}`}>\n                  <Grid3X3 className=\"h-4 w-4\" /></button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Results Count */}\n      <div className=\"flex items-center justify-between text-xs text-text-muted\">\n        <span>{filteredInvestments?.length || 0} inversión{filteredInvestments?.length !== 1 ? 'es' : ''}</span>\n        {(search || category) && (\n          <button onClick={() => { setSearch(''); setCategory('') }} className=\"text-cream-muted hover:text-cream transition-colors\">\n            Limpiar filtros\n          </button>)}\n      </div>\n\n      {/* ================================================================= */}\n      {/* INVESTMENT LIST / GRID                                            */}\n      {/* ================================================================= */}\n      {investmentsLoading ? (\n        <div className=\"space-y-3\">\n          {[...Array(3)].map((_, i) => (<div key={i} className=\"h-32 sm:h-28 bg-surface rounded-2xl animate-pulse\" />))}\n        </div>\n      ) : filteredInvestments?.length ? (\n        <div className={viewMode === 'grid' ? 'grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4' : 'space-y-3'}>\n          {filteredInvestments.map((investment: any, index: number) => (\n            <Link key={investment.id} to={`/investments/${investment.id}`}\n              className=\"group relative overflow-hidden rounded-2xl border border-border bg-surface p-4 sm:p-5 transition-all duration-300 hover:border-border-strong hover:-translate-y-0.5 card-hover\"\n              style={{ animationDelay: `${index * 30}ms` }}>\n              <div className=\"absolute inset-0 bg-gradient-to-br from-cream/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity\" />\n              {investment.return_percentage !== undefined && (\n                <div className=\"absolute left-0 top-0 bottom-0 w-1 rounded-l-2xl\"\n                  style={{ backgroundColor: investment.return_percentage >= 0 ? '#7fb069' : '#c76b6b', opacity: 0.6 }} />\n              )}\n              <div className=\"relative\">\n                <div className=\"flex items-start justify-between gap-3 sm:gap-4\">\n                  <div className=\"flex-1 min-w-0\">\n                    <div className=\"flex items-center gap-2 flex-wrap mb-2\">\n                      <span className=\"text-lg\">{categoryIcons[investment.category] || '📦'}</span>\n                      <h3 className=\"text-sm sm:text-base font-semibold text-text-primary group-hover:text-cream transition-colors truncate\">\n                        {investment.name}\n                      </h3>\n                    </div>\n                    <div className=\"flex items-center gap-2 flex-wrap\">\n                      <span className={`text-[10px] font-medium tracking-wider uppercase px-2 py-1 rounded-full border ${statusConfig[investment.status]?.className || statusConfig.active.className}`}>\n                        {statusConfig[investment.status]?.label || investment.status}\n                      </span>\n                      {investment.city && (\n                        <span className=\"flex items-center gap-1 text-xs text-text-muted\">\n                          <MapPin className=\"h-3 w-3\" />\n                          <span className=\"truncate max-w-[100px] sm:max-w-none\">{investment.city}</span>\n                        </span>)}\n                    </div>\n                    <div className=\"flex items-center gap-3 sm:gap-4 mt-3 text-xs text-text-muted\">\n                      {investment.land_area_hectares && <span className=\"font-mono\">{investment.land_area_hectares} ha</span>}\n                      {investment.document_count !== undefined && <span>{investment.document_count} docs</span>}\n                      {investment.purchase_price && <span className=\"font-mono text-text-muted\">Compra: {formatCurrency(investment.purchase_price)}</span>}\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-2 sm:gap-3 flex-shrink-0\">\n                    <div className=\"text-right\">\n                      <p className=\"font-mono text-base sm:text-lg font-semibold text-cream\">\n                        {investment.current_value ? formatCurrency(investment.current_value) : '—'}\n                      </p>\n                      {investment.return_percentage !== undefined && (\n                        <p className={`text-xs font-mono flex items-center justify-end gap-1 ${investment.return_percentage >= 0 ? 'text-success' : 'text-error'}`}>\n                          {investment.return_percentage >= 0 ? <ArrowUpRight className=\"h-3 w-3\" /> : <ArrowDownRight className=\"h-3 w-3\" />}\n                          {investment.return_percentage >= 0 ? '+' : ''}{investment.return_percentage.toFixed(1)}%\n                        </p>)}\n                    </div>\n                    <ChevronRight className=\"h-5 w-5 text-text-muted group-hover:text-cream transition-colors flex-shrink-0\" />\n                  </div>\n                </div>\n              </div>\n            </Link>\n          ))}\n        </div>\n      ) : (\n        <div className=\"text-center py-16 border border-dashed border-border rounded-3xl\">\n          <div className=\"w-16 h-16 mx-auto mb-4 rounded-2xl bg-surface flex items-center justify-center\">\n            <DollarSign className=\"h-8 w-8 text-text-muted\" />\n          </div>\n          <h3 className=\"text-lg font-medium text-text-primary mb-1\">\n            {search || category ? 'No se encontraron coincidencias' : 'Aún no hay inversiones'}\n          </h3>\n          <p className=\"text-sm text-text-muted mb-6\">\n            {search || category ? 'Intenta ajustar tu búsqueda o filtros' : 'Comienza agregando tu primera inversión'}\n          </p>\n          {!(search || category) && (\n            <button onClick={() => setShowAddModal(true)} className=\"glyph-btn glyph-btn-primary\">\n              <Plus className=\"h-4 w-4\" /> Agregar Inversión\n            </button>)}\n        </div>\n      )}\n\n      <AddInvestmentModal isOpen={showAddModal} onClose={() => setShowAddModal(false)} />\n    </div>\n  )\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/hinoki/HinokiDEV/Investments/prism/web/src/pages/LandAnalyzer.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":90,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":90,"endColumn":37},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":116,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":116,"endColumn":36},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":620,"column":91,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":620,"endColumn":94,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23078,23081],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23078,23081],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":745,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":745,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29579,29582],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29579,29582],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useMemo } from 'react'\nimport { Outlet } from 'react-router-dom'\nimport {\n  Calculator,\n  TrendingUp,\n  Plus,\n  Download,\n  Building2,\n  Trees,\n  ChevronDown,\n  Filter,\n  CheckCircle,\n  ArrowUpRight,\n  ArrowDownRight,\n  AlertTriangle\n} from 'lucide-react'\nimport {\n  SAMPLE_CREDITS,\n  SAMPLE_LANDS,\n  CreditScenario,\n  LandOpportunity,\n  LandCreditCombo,\n  analyzeLandCreditCombo,\n  compareScenarios,\n  calculateEffectiveCredit\n} from '../lib/landCredit'\nimport { formatCurrency } from '../lib/utils'\nimport {\n  CreditTruthRevealer,\n  LandCreditComboCard,\n  ComparisonTable,\n  LandCard,\n  CreditCard,\n  AdvancedMetricsDashboard,\n  MarketDataPanel\n} from '../components/CreditAnalysis'\nimport { HelpTooltip, LabelWithTooltip, INVESTMENT_TOOLTIPS } from '../components/HelpTooltip'\n\n// Money Card Component - New Design\nfunction MoneyCard({\n  title,\n  amount,\n  subtitle,\n  trend,\n  trendValue,\n  highlight = false,\n  currency = 'CLP'\n}: {\n  title: string\n  amount: number\n  subtitle?: string\n  trend?: 'up' | 'down' | 'neutral'\n  trendValue?: string\n  highlight?: boolean\n  currency?: string\n}) {\n  const TrendIcon = trend === 'up' ? ArrowUpRight : trend === 'down' ? ArrowDownRight : null\n  const trendColor = trend === 'up' ? 'text-success' : trend === 'down' ? 'text-error' : 'text-text-muted'\n  \n  return (\n    <div className={`rounded-2xl border p-5 transition-all duration-300 card-hover ${\n      highlight \n        ? 'bg-cream/5 border-cream/20' \n        : 'bg-surface border-border'\n    }`}>\n      <p className=\"text-xs font-semibold tracking-widest text-cream-muted uppercase mb-2\">{title}</p>\n      <p className={`font-mono text-2xl font-semibold ${highlight ? 'text-cream' : 'text-text-primary'}`}>\n        {currency === '%' ? `${amount.toFixed(1)}%` : formatCurrency(amount)}\n      </p>\n      {subtitle && (\n        <p className=\"text-xs text-text-muted mt-1\">{subtitle}</p>\n      )}\n      {trend && TrendIcon && trendValue && (\n        <div className={`flex items-center gap-1 mt-2 text-xs ${trendColor}`}>\n          <TrendIcon className=\"h-3 w-3\" />\n          <span>{trendValue}</span>\n        </div>\n      )}\n    </div>\n  )\n}\n\n// ============================================================================\n// SHARED STATE HOOK\n// ============================================================================\n\nlet sharedSelectedLand: LandOpportunity | null = null\nlet sharedSelectedCredit: CreditScenario | null = null\n\nexport function useLandAnalyzerState() {\n  const [selectedLand, setSelectedLand] = useState<LandOpportunity | null>(sharedSelectedLand)\n  const [selectedCredit, setSelectedCredit] = useState<CreditScenario | null>(sharedSelectedCredit)\n  \n  const updateSelectedLand = (land: LandOpportunity | null) => {\n    sharedSelectedLand = land\n    setSelectedLand(land)\n  }\n  \n  const updateSelectedCredit = (credit: CreditScenario | null) => {\n    sharedSelectedCredit = credit\n    setSelectedCredit(credit)\n  }\n  \n  return {\n    selectedLand,\n    selectedCredit,\n    setSelectedLand: updateSelectedLand,\n    setSelectedCredit: updateSelectedCredit\n  }\n}\n\n// ============================================================================\n// DATA HOOK\n// ============================================================================\n\nexport function useLandAnalyzerData() {\n  const allLands = useMemo(() => [...SAMPLE_LANDS], [])\n  const allCredits = useMemo(() => [...SAMPLE_CREDITS], [])\n\n  const allCombos = useMemo(() => {\n    const combos: LandCreditCombo[] = []\n    for (const land of allLands) {\n      for (const credit of allCredits) {\n        combos.push({\n          land,\n          credit,\n          analysis: analyzeLandCreditCombo(land, credit)\n        })\n      }\n    }\n    return combos\n  }, [allLands, allCredits])\n\n  const comparison = useMemo(() => compareScenarios(allCombos), [allCombos])\n\n  return { allLands, allCredits, allCombos, comparison }\n}\n\n// ============================================================================\n// OVERVIEW VIEW\n// ============================================================================\n\nexport function OverviewView() {\n  const { allCombos, comparison } = useLandAnalyzerData()\n  const topScored = allCombos.slice().sort((a, b) => b.analysis.score - a.analysis.score).slice(0, 5)\n  \n  return (\n    <div className=\"space-y-6\">\n      {/* Summary Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n        <MoneyCard\n          title=\"Mejor ROI 5 Años\"\n          amount={comparison.bestByROI?.analysis.roi5Year || 0}\n          trend=\"up\"\n          trendValue={comparison.bestByROI ? comparison.bestByROI.land.name : 'N/A'}\n          currency=\"%\"\n        />\n        <MoneyCard\n          title=\"Menor Pago Mensual\"\n          amount={comparison.bestByMonthlyPayment?.analysis.monthlyPayment || 0}\n          subtitle=\"Mejor flujo de caja\"\n        />\n        <MoneyCard\n          title=\"Menos Efectivo Requerido\"\n          amount={comparison.bestByCashRequired?.analysis.cashRequired || 0}\n          subtitle=\"Menor barrera de entrada\"\n        />\n        <MoneyCard\n          title=\"Mejor Puntaje\"\n          amount={comparison.bestOverall?.analysis.score || 0}\n          highlight\n          trend=\"up\"\n          trendValue={comparison.bestOverall ? comparison.bestOverall.land.name : 'N/A'}\n          currency=\"pts\"\n        />\n      </div>\n\n      {/* Best Option Detail */}\n      {comparison.bestOverall && (\n        <div className=\"relative overflow-hidden rounded-2xl border border-success/20 bg-success-dim p-6\">\n          <div className=\"flex items-center gap-2 mb-4\">\n            <CheckCircle className=\"h-6 w-6 text-success\" />\n            <h2 className=\"text-xl font-bold text-success\">Mejor Oportunidad Detectada</h2>\n          </div>\n          <LandCreditComboCard combo={comparison.bestOverall} isBest />\n        </div>\n      )}\n\n      {/* Top 5 Rankings */}\n      <div>\n        <h3 className=\"text-sm font-semibold tracking-widest text-cream-muted uppercase mb-4 flex items-center gap-2\">\n          <TrendingUp className=\"h-4 w-4\" />\n          Top 5 Oportunidades\n        </h3>\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4\">\n          {topScored.map((combo, index) => (\n            <LandCreditComboCard \n              key={`${combo.land.id}-${combo.credit.id}`} \n              combo={combo}\n              className={index === 0 ? 'ring-2 ring-success/50' : ''}\n            />\n          ))}\n        </div>\n      </div>\n    </div>\n  )\n}\n\n// ============================================================================\n// COMPARE VIEW\n// ============================================================================\n\nexport function CompareView() {\n  const { comparison } = useLandAnalyzerData()\n  \n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <h2 className=\"text-lg font-bold text-text-primary\">Comparación de Todas las Combinaciones</h2>\n        <div className=\"flex gap-2\">\n          <button className=\"glyph-btn glyph-btn-ghost\">\n            <Filter className=\"h-4 w-4\" />\n            Filtrar\n          </button>\n          <button className=\"glyph-btn glyph-btn-ghost\">\n            <Download className=\"h-4 w-4\" />\n            Exportar CSV\n          </button>\n        </div>\n      </div>\n\n      {/* Winners */}\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n        {comparison.bestByROI && (\n          <div className=\"rounded-2xl border border-success/20 bg-success-dim p-4\">\n            <p className=\"text-xs font-semibold tracking-widest text-success uppercase mb-2\">Mejor ROI</p>\n            <LandCreditComboCard combo={comparison.bestByROI} />\n          </div>\n        )}\n        {comparison.bestByMonthlyPayment && (\n          <div className=\"rounded-2xl border border-info/20 bg-info-dim p-4\">\n            <p className=\"text-xs font-semibold tracking-widest text-info uppercase mb-2\">Menor Pago</p>\n            <LandCreditComboCard combo={comparison.bestByMonthlyPayment} />\n          </div>\n        )}\n        {comparison.bestByCashRequired && (\n          <div className=\"rounded-2xl border border-cream/20 bg-cream/5 p-4\">\n            <p className=\"text-xs font-semibold tracking-widest text-cream uppercase mb-2\">Menos Efectivo</p>\n            <LandCreditComboCard combo={comparison.bestByCashRequired} />\n          </div>\n        )}\n      </div>\n\n      {/* Full Comparison Table */}\n      <ComparisonTable combos={comparison.scenarios} />\n    </div>\n  )\n}\n\n// ============================================================================\n// LANDS VIEW\n// ============================================================================\n\nexport function LandsView() {\n  const { allLands } = useLandAnalyzerData()\n  const { selectedLand, setSelectedLand } = useLandAnalyzerState()\n  \n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-lg font-bold text-text-primary\">Terrenos Disponibles</h2>\n          <p className=\"text-sm text-text-muted mt-1\">{allLands.length} oportunidades analizadas</p>\n        </div>\n        <button className=\"glyph-btn glyph-btn-primary\">\n          <Plus className=\"h-4 w-4\" />\n          Agregar Terreno\n        </button>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4\">\n        {allLands.map((land) => (\n          <LandCard\n            key={land.id}\n            land={land}\n            isSelected={selectedLand?.id === land.id}\n            onClick={() => setSelectedLand(land)}\n          />\n        ))}\n      </div>\n\n      {selectedLand && (\n        <div className=\"glass-card-elevated p-6 mt-6\">\n          <h3 className=\"text-lg font-bold text-text-primary mb-4\">Detalles del Terreno</h3>\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n            <div className=\"p-4 rounded-xl bg-surface\">\n              <p className=\"text-xs text-text-muted uppercase mb-1\">Precio</p>\n              <p className=\"font-mono text-lg font-semibold text-text-primary\">{formatCurrency(selectedLand.askingPrice)}</p>\n            </div>\n            <div className=\"p-4 rounded-xl bg-surface\">\n              <p className=\"text-xs text-text-muted uppercase mb-1\">Valor Tasación</p>\n              <p className=\"font-mono text-lg font-semibold text-cream\">{formatCurrency(selectedLand.appraisalValue)}</p>\n              <p className=\"text-xs text-text-muted mt-1\">{selectedLand.belowAppraisalBy}% diferencia</p>\n            </div>\n            <div className=\"p-4 rounded-xl bg-surface\">\n              <p className=\"text-xs text-text-muted uppercase mb-1\">Precio/m²</p>\n              <p className=\"font-mono text-lg font-semibold text-text-primary\">{formatCurrency(selectedLand.pricePerSquareMeter)}/m²</p>\n            </div>\n            <div className=\"p-4 rounded-xl bg-surface\">\n              <p className=\"text-xs text-text-muted uppercase mb-1\">Apreciación Esperada</p>\n              <p className=\"font-mono text-lg font-semibold text-success\">{selectedLand.expectedAppreciationAnnual}%/año</p>\n            </div>\n          </div>\n          {selectedLand.notes && (\n            <div className=\"mt-4 p-4 rounded-xl bg-surface\">\n              <h4 className=\"text-xs font-semibold tracking-widest text-cream-muted uppercase mb-2\">Notas</h4>\n              <p className=\"text-sm text-text-secondary\">{selectedLand.notes}</p>\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  )\n}\n\n// ============================================================================\n// CREDITS VIEW\n// ============================================================================\n\nexport function CreditsView() {\n  const { allCredits } = useLandAnalyzerData()\n  const { selectedCredit, setSelectedCredit } = useLandAnalyzerState()\n  \n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-lg font-bold text-text-primary\">Créditos Hipotecarios</h2>\n          <p className=\"text-sm text-text-muted mt-1\">{allCredits.length} créditos analizados</p>\n        </div>\n        <button className=\"glyph-btn glyph-btn-primary\">\n          <Plus className=\"h-4 w-4\" />\n          Agregar Crédito\n        </button>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4\">\n        {allCredits.map((credit) => (\n          <CreditCard\n            key={credit.id}\n            credit={credit}\n            isSelected={selectedCredit?.id === credit.id}\n            onClick={() => setSelectedCredit(credit)}\n          />\n        ))}\n      </div>\n\n      {selectedCredit && (\n        <div className=\"mt-6\">\n          <CreditTruthRevealer credit={selectedCredit} />\n        </div>\n      )}\n    </div>\n  )\n}\n\n// ============================================================================\n// ANALYSIS VIEW\n// ============================================================================\n\nexport function AnalysisView() {\n  const { allLands, allCredits } = useLandAnalyzerData()\n  const { selectedLand, selectedCredit, setSelectedLand, setSelectedCredit } = useLandAnalyzerState()\n\n  const currentCombo = useMemo(() => {\n    if (!selectedLand || !selectedCredit) return null\n    return {\n      land: selectedLand,\n      credit: selectedCredit,\n      analysis: analyzeLandCreditCombo(selectedLand, selectedCredit)\n    }\n  }, [selectedLand, selectedCredit])\n\n  const land = selectedLand || allLands[0]\n  const credit = selectedCredit || allCredits[0]\n  const combo = currentCombo || {\n    land,\n    credit,\n    analysis: analyzeLandCreditCombo(land, credit)\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        {/* Left Panel - Selection */}\n        <div className=\"space-y-6\">\n          {/* Land Selection */}\n          <div className=\"glass-card p-4\">\n            <h3 className=\"text-xs font-semibold tracking-widest text-cream-muted uppercase mb-3 flex items-center gap-2\">\n              <Trees className=\"h-4 w-4\" />\n              Seleccionar Terreno\n            </h3>\n            <div className=\"space-y-2 max-h-60 overflow-y-auto\">\n              {allLands.map((l) => (\n                <button\n                  key={l.id}\n                  onClick={() => setSelectedLand(l)}\n                  className={`w-full text-left p-3 rounded-lg text-sm transition-colors ${\n                    land.id === l.id\n                      ? 'bg-cream/10 border border-cream/20'\n                      : 'bg-surface border border-border hover:border-border-strong'\n                  }`}\n                >\n                  <p className=\"font-medium text-text-primary truncate\">{l.name}</p>\n                  <p className=\"text-xs text-text-muted\">{formatCurrency(l.askingPrice)} • {l.location.commune}</p>\n                </button>\n              ))}\n            </div>\n          </div>\n\n          {/* Credit Selection */}\n          <div className=\"glass-card p-4\">\n            <h3 className=\"text-xs font-semibold tracking-widest text-cream-muted uppercase mb-3 flex items-center gap-2\">\n              <Building2 className=\"h-4 w-4\" />\n              Seleccionar Crédito\n            </h3>\n            <div className=\"space-y-2 max-h-60 overflow-y-auto\">\n              {allCredits.map((c) => (\n                <button\n                  key={c.id}\n                  onClick={() => setSelectedCredit(c)}\n                  className={`w-full text-left p-3 rounded-lg text-sm transition-colors ${\n                    credit.id === c.id\n                      ? 'bg-cream/10 border border-cream/20'\n                      : 'bg-surface border border-border hover:border-border-strong'\n                  }`}\n                >\n                  <p className=\"font-medium text-text-primary\">{c.bank}</p>\n                  <p className=\"text-xs text-text-muted\">{c.annualInterestRate}% • {c.termYears} años {c.isDFL2 && '• DFL2'}</p>\n                </button>\n              ))}\n            </div>\n          </div>\n\n          {/* Market Data */}\n          <MarketDataPanel />\n        </div>\n\n        {/* Right Panel - Analysis */}\n        <div className=\"lg:col-span-2\">\n          <AdvancedMetricsDashboard combo={combo} />\n        </div>\n      </div>\n    </div>\n  )\n}\n\n// ============================================================================\n// CALCULATOR VIEW\n// ============================================================================\n\nexport function CalculatorView() {\n  const [customLand, setCustomLand] = useState<Partial<LandOpportunity>>({\n    askingPrice: 25000000,\n    landAreaSquareMeters: 1000,\n    appraisalValue: 30000000,\n    expectedAppreciationAnnual: 7,\n    zoning: 'residential',\n    hasBasicServices: true,\n    hasRoadAccess: true,\n  })\n  \n  const [customCredit, setCustomCredit] = useState<Partial<CreditScenario>>({\n    advertisedCreditAmount: 30000000,\n    requiredDownPayment: 6000000,\n    annualInterestRate: 4.19,\n    termYears: 20,\n    notaryFees: 100000,\n    registrationFees: 180000,\n    appraisalFee: 100000,\n    insuranceFees: 180000,\n    stampTax: 48000,\n    otherFees: 50000,\n    isDFL2: true,\n  })\n\n  const customAnalysis = useMemo(() => {\n    if (!customLand.askingPrice || !customCredit.advertisedCreditAmount) return null\n    \n    const land: LandOpportunity = {\n      id: 'custom',\n      name: 'Terreno Personalizado',\n      location: { region: 'Custom', city: 'Custom', commune: 'Custom' },\n      askingPrice: customLand.askingPrice,\n      landAreaSquareMeters: customLand.landAreaSquareMeters || 1000,\n      pricePerSquareMeter: (customLand.askingPrice || 0) / (customLand.landAreaSquareMeters || 1000),\n      appraisalValue: customLand.appraisalValue || customLand.askingPrice,\n      belowAppraisalBy: customLand.appraisalValue \n        ? ((customLand.appraisalValue - customLand.askingPrice) / customLand.appraisalValue) * 100\n        : 0,\n      zoning: customLand.zoning || 'residential',\n      hasBasicServices: customLand.hasBasicServices || false,\n      hasRoadAccess: customLand.hasRoadAccess || false,\n      topography: 'flat',\n      expectedAppreciationAnnual: customLand.expectedAppreciationAnnual || 7,\n      status: 'analyzing',\n      listingDate: new Date().toISOString(),\n      notes: ''\n    }\n    \n    const credit: CreditScenario = {\n      id: 'custom',\n      name: 'Crédito Personalizado',\n      bank: 'Personalizado',\n      advertisedCreditAmount: customCredit.advertisedCreditAmount,\n      requiredDownPayment: customCredit.requiredDownPayment || 0,\n      effectiveCreditAmount: calculateEffectiveCredit(\n        customCredit.advertisedCreditAmount,\n        customCredit.requiredDownPayment || 0\n      ),\n      annualInterestRate: customCredit.annualInterestRate || 4.19,\n      termYears: customCredit.termYears || 20,\n      notaryFees: customCredit.notaryFees || 100000,\n      registrationFees: customCredit.registrationFees || 180000,\n      appraisalFee: customCredit.appraisalFee || 100000,\n      insuranceFees: customCredit.insuranceFees || 180000,\n      stampTax: customCredit.stampTax || 48000,\n      otherFees: customCredit.otherFees || 50000,\n      ufValueAtPurchase: 39740,\n      currency: 'CLP',\n      isDFL2: customCredit.isDFL2 ?? true,\n      requiredMonthlyIncome: 1800000,\n      maxPaymentToIncomeRatio: 0.25\n    }\n    \n    return { land, credit, analysis: analyzeLandCreditCombo(land, credit) }\n  }, [customLand, customCredit])\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"rounded-2xl border border-info/20 bg-info-dim p-5\">\n        <h3 className=\"font-semibold text-info flex items-center gap-2\">\n          <Calculator className=\"h-5 w-5\" />\n          Custom Calculator\n        </h3>\n        <p className=\"text-sm text-text-secondary mt-1\">\n          Enter your own data to analyze any land and credit combination.\n        </p>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n        {/* Land Form */}\n        <div className=\"glass-card-elevated p-6\">\n          <h3 className=\"text-lg font-bold mb-4 flex items-center gap-2 text-text-primary\">\n            <Trees className=\"h-5 w-5 text-success\" />\n            Datos del Terreno\n          </h3>\n          <div className=\"space-y-4\">\n            <div>\n              <LabelWithTooltip\n                label=\"Sale Price (CLP)\"\n                tooltipContent={INVESTMENT_TOOLTIPS.askingPrice.content}\n                tooltipExample={INVESTMENT_TOOLTIPS.askingPrice.example}\n              />\n              <input\n                type=\"number\"\n                value={customLand.askingPrice}\n                onChange={(e) => setCustomLand({ ...customLand, askingPrice: Number(e.target.value) })}\n                className=\"input-field mt-2\"\n              />\n            </div>\n            <div>\n              <LabelWithTooltip\n                label=\"Area (m²)\"\n                tooltipContent=\"El tamaño del terreno en metros cuadrados. Se usa para calcular el precio por m² y comparar oportunidades.\"\n                tooltipExample=\"1,000 m² es un terreno pequeño (1/10 hectárea). 5,000 m² es un terreno estándar para una casa grande.\"\n              />\n              <input\n                type=\"number\"\n                value={customLand.landAreaSquareMeters}\n                onChange={(e) => setCustomLand({ ...customLand, landAreaSquareMeters: Number(e.target.value) })}\n                className=\"input-field mt-2\"\n              />\n            </div>\n            <div>\n              <LabelWithTooltip\n                label=\"Appraisal Value (CLP)\"\n                tooltipContent={INVESTMENT_TOOLTIPS.appraisalValue.content}\n                tooltipExample={INVESTMENT_TOOLTIPS.appraisalValue.example}\n              />\n              <input\n                type=\"number\"\n                value={customLand.appraisalValue}\n                onChange={(e) => setCustomLand({ ...customLand, appraisalValue: Number(e.target.value) })}\n                className=\"input-field mt-2\"\n              />\n            </div>\n            <div>\n              <LabelWithTooltip\n                label=\"Expected Appreciation (%/year)\"\n                tooltipContent={INVESTMENT_TOOLTIPS.expectedAppreciation.content}\n                tooltipExample={INVESTMENT_TOOLTIPS.expectedAppreciation.example}\n              />\n              <input\n                type=\"number\"\n                step=\"0.1\"\n                value={customLand.expectedAppreciationAnnual}\n                onChange={(e) => setCustomLand({ ...customLand, expectedAppreciationAnnual: Number(e.target.value) })}\n                className=\"input-field mt-2\"\n              />\n            </div>\n            <div>\n              <LabelWithTooltip\n                label=\"Zoning\"\n                tooltipContent={INVESTMENT_TOOLTIPS.zoningType.content}\n                tooltipExample={INVESTMENT_TOOLTIPS.zoningType.example}\n              />\n              <select\n                value={customLand.zoning}\n                onChange={(e) => setCustomLand({ ...customLand, zoning: e.target.value as any })}\n                className=\"input-field mt-2\"\n              >\n                <option value=\"residential\">Residential</option>\n                <option value=\"commercial\">Commercial</option>\n                <option value=\"industrial\">Industrial</option>\n                <option value=\"agricultural\">Agricultural</option>\n                <option value=\"mixed\">Mixed</option>\n              </select>\n            </div>\n          </div>\n        </div>\n\n        {/* Credit Form */}\n        <div className=\"glass-card-elevated p-6\">\n          <h3 className=\"text-lg font-bold mb-4 flex items-center gap-2 text-text-primary\">\n            <Building2 className=\"h-5 w-5 text-info\" />\n            Datos del Crédito\n          </h3>\n          <div className=\"space-y-4\">\n            <div className=\"p-4 rounded-xl border border-warning/20 bg-warning-dim\">\n              <LabelWithTooltip\n                label='\"Advertised\" Amount (CLP)'\n                tooltipTitle=\"Advertised Amount\"\n                tooltipContent=\"El monto que el banco publicita en sus avisos. NO es lo que realmente recibes. Siempre es mayor que el efectivo real.\"\n                tooltipExample='Banco dice \"Crédito hipotecario $100 millones\" pero luego te cobran fees y exigen pie.'\n              />\n              <input\n                type=\"number\"\n                value={customCredit.advertisedCreditAmount}\n                onChange={(e) => setCustomCredit({ ...customCredit, advertisedCreditAmount: Number(e.target.value) })}\n                className=\"input-field border-warning/30 mt-2\"\n              />\n              <p className=\"text-xs text-warning mt-1\">What the bank advertises</p>\n            </div>\n            <div className=\"p-4 rounded-xl border border-error/20 bg-error-dim\">\n              <LabelWithTooltip\n                label=\"Required Down Payment (CLP)\"\n                tooltipTitle=\"Down Payment (Pie)\"\n                tooltipContent={INVESTMENT_TOOLTIPS.downPayment.content}\n                tooltipExample={INVESTMENT_TOOLTIPS.downPayment.example}\n              />\n              <input\n                type=\"number\"\n                value={customCredit.requiredDownPayment}\n                onChange={(e) => setCustomCredit({ ...customCredit, requiredDownPayment: Number(e.target.value) })}\n                className=\"input-field border-error/30 mt-2\"\n              />\n              <p className=\"text-xs text-error mt-1\">What you MUST pay in cash</p>\n            </div>\n            <div>\n              <LabelWithTooltip\n                label=\"Annual Interest Rate (%)\"\n                tooltipTitle=\"Interest Rate\"\n                tooltipContent={INVESTMENT_TOOLTIPS.interestRate.content}\n                tooltipExample={INVESTMENT_TOOLTIPS.interestRate.example}\n              />\n              <input\n                type=\"number\"\n                step=\"0.1\"\n                value={customCredit.annualInterestRate}\n                onChange={(e) => setCustomCredit({ ...customCredit, annualInterestRate: Number(e.target.value) })}\n                className=\"input-field mt-2\"\n              />\n            </div>\n            <div>\n              <LabelWithTooltip\n                label=\"Term (years)\"\n                tooltipTitle=\"Loan Term\"\n                tooltipContent={INVESTMENT_TOOLTIPS.termYears.content}\n                tooltipExample={INVESTMENT_TOOLTIPS.termYears.example}\n              />\n              <input\n                type=\"number\"\n                value={customCredit.termYears}\n                onChange={(e) => setCustomCredit({ ...customCredit, termYears: Number(e.target.value) })}\n                className=\"input-field mt-2\"\n              />\n            </div>\n            <div className=\"flex items-center gap-2 p-3 rounded-lg bg-success-dim border border-success/20\">\n              <input\n                type=\"checkbox\"\n                id=\"isDFL2\"\n                checked={customCredit.isDFL2}\n                onChange={(e) => setCustomCredit({ ...customCredit, isDFL2: e.target.checked })}\n                className=\"w-4 h-4 rounded border-border\"\n              />\n              <label htmlFor=\"isDFL2\" className=\"text-sm text-success font-medium cursor-pointer flex items-center gap-2\">\n                Aplica beneficio DFL2 (ahorro 0.6% en impuesto al mutuo)\n                <HelpTooltip\n                  title=\"DFL2 Benefit\"\n                  content={INVESTMENT_TOOLTIPS.dfl2.content}\n                  example={INVESTMENT_TOOLTIPS.dfl2.example}\n                  size=\"sm\"\n                />\n              </label>\n            </div>\n\n            <details className=\"group\">\n              <summary className=\"cursor-pointer text-sm text-text-muted hover:text-text-primary flex items-center gap-1 transition-colors\">\n                <ChevronDown className=\"h-4 w-4 group-open:rotate-180 transition-transform\" />\n                Gastos Operacionales Detallados\n                <HelpTooltip\n                  title=\"Operational Expenses\"\n                  content={INVESTMENT_TOOLTIPS.operationalExpenses.content}\n                  example={INVESTMENT_TOOLTIPS.operationalExpenses.example}\n                  size=\"sm\"\n                />\n              </summary>\n              <div className=\"mt-3 space-y-3\">\n                {[\n                  { key: 'notaryFees', label: 'Gastos Notariales', hint: '~UF 2.5', tooltip: INVESTMENT_TOOLTIPS.notaryFees },\n                  { key: 'registrationFees', label: 'Inscripción CBR', hint: '~UF 2.5', tooltip: INVESTMENT_TOOLTIPS.registrationFees },\n                  { key: 'appraisalFee', label: 'Tasación', hint: '~UF 2.5', tooltip: INVESTMENT_TOOLTIPS.appraisalFee },\n                  { key: 'insuranceFees', label: 'Seguros', hint: 'Desgravamen + Incendio', tooltip: INVESTMENT_TOOLTIPS.insuranceFees },\n                  { key: 'stampTax', label: `Impuesto al Mutuo (${customCredit.isDFL2 ? '0.2%' : '0.8%'})`, hint: customCredit.isDFL2 ? 'Ahorro con DFL2' : 'Normal', tooltip: INVESTMENT_TOOLTIPS.stampTax },\n                  { key: 'otherFees', label: 'Otros gastos', hint: 'Gestión, etc.' },\n                ].map(({ key, label, hint, tooltip }) => {\n                  const numValue = customCredit[key as keyof typeof customCredit]\n                  return (\n                    <div key={key}>\n                      {tooltip ? (\n                        <LabelWithTooltip\n                          label={label}\n                          tooltipContent={tooltip.content}\n                          tooltipExample={(tooltip as any).example}\n                        />\n                      ) : (\n                        <label className=\"block text-xs text-text-muted mb-1\">\n                          {label}\n                          <span className=\"text-text-muted/60 ml-1\">({hint})</span>\n                        </label>\n                      )}\n                      <input\n                        type=\"number\"\n                        value={typeof numValue === 'number' ? numValue : 0}\n                        onChange={(e) => setCustomCredit({ ...customCredit, [key]: Number(e.target.value) })}\n                        className=\"input-field mt-1\"\n                      />\n                    </div>\n                  )\n                })}\n              </div>\n            </details>\n          </div>\n        </div>\n      </div>\n\n      {/* Results */}\n      {customAnalysis && (\n        <div className=\"space-y-6\">\n          <div className=\"glass-card-elevated p-6\">\n            <h3 className=\"text-xl font-bold text-text-primary mb-4\">Resultado del Análisis</h3>\n            <LandCreditComboCard combo={customAnalysis} />\n          </div>\n          \n          {/* Advanced Metrics */}\n          <AdvancedMetricsDashboard combo={customAnalysis} />\n          \n          {customAnalysis.analysis.score >= 70 && (\n            <div className=\"bg-success-dim border border-success/20 rounded-xl p-4 flex items-center gap-3\">\n              <CheckCircle className=\"h-6 w-6 text-success\" />\n              <div>\n                <p className=\"font-semibold text-success\">¡Excelente oportunidad!</p>\n                <p className=\"text-sm text-text-secondary\">\n                  Esta combinación ofrece buenos retornos con riesgo calculado.\n                </p>\n              </div>\n            </div>\n          )}\n          \n          {customAnalysis.analysis.score < 50 && (\n            <div className=\"bg-warning-dim border border-warning/20 rounded-xl p-4 flex items-center gap-3\">\n              <AlertTriangle className=\"h-6 w-6 text-warning\" />\n              <div>\n                <p className=\"font-semibold text-warning\">Revisar con precaución</p>\n                <p className=\"text-sm text-text-secondary\">\n                  Esta combinación presenta indicadores de riesgo. Considera alternativas.\n                </p>\n              </div>\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  )\n}\n\n// ============================================================================\n// MAIN LAND ANALYZER COMPONENT (Layout Wrapper)\n// ============================================================================\n\nexport default function LandAnalyzer() {\n  return (\n    <div className=\"fade-in\">\n      <Outlet />\n    </div>\n  )\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/hinoki/HinokiDEV/Investments/prism/web/src/vite-env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/hinoki/HinokiDEV/Investments/prism/web/vite.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/hinoki/HinokiDEV/Investments/prism/web/vitest.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]}]
